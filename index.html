<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Fun English - Há»c vui má»—i ngÃ y!</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦‰</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Nunito', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .app-container { max-width: 500px; margin: 0 auto; min-height: 100vh; }
    
    /* Backgrounds for different themes */
    .bg-sunny { background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 100%); }
    .bg-night { background: linear-gradient(180deg, #2C3E50 0%, #4A569D 100%); }
    .bg-park { background: linear-gradient(180deg, #87CEEB 0%, #90EE90 100%); }
    .bg-home { background: linear-gradient(180deg, #FFB6C1 0%, #FFECD2 100%); }
    .bg-school { background: linear-gradient(180deg, #87CEEB 0%, #DDA0DD 100%); }
    .bg-fun { background: linear-gradient(180deg, #667eea 0%, #764ba2 100%); }
    
    .screen { display: none; min-height: 100vh; padding: 20px; }
    .screen.active { display: block; }
    
    /* Sound toggle */
    .sound-toggle {
      position: fixed; top: 15px; right: 15px; width: 45px; height: 45px;
      border-radius: 50%; border: none; background: rgba(255,255,255,0.9);
      font-size: 1.3rem; cursor: pointer; z-index: 100;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    
    /* HOME SCREEN */
    .home-content { text-align: center; padding-top: 30px; }
    .mascot-large { font-size: 100px; animation: bounce 2s ease infinite; }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    .app-title {
      font-size: 2.2rem; font-weight: 800; color: white;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2); margin: 15px 0 5px;
    }
    .app-tagline { color: rgba(255,255,255,0.9); font-size: 1.1rem; margin-bottom: 30px; }
    
    .topic-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    .topic-card {
      background: white; border-radius: 20px; padding: 20px 15px;
      text-align: center; cursor: pointer; transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border: 3px solid transparent;
    }
    .topic-card:hover { transform: translateY(-5px); }
    .topic-card:active { transform: scale(0.95); }
    .topic-card .topic-icon { font-size: 45px; margin-bottom: 8px; }
    .topic-card .topic-name { font-size: 1rem; font-weight: 700; color: #333; }
    .topic-card.daily { border-color: #4CAF50; }
    .topic-card.yesterday { border-color: #FF9800; }
    .topic-card.stories { border-color: #E91E63; }
    .topic-card.games { border-color: #9C27B0; }
    
    .streak-banner {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #5D4037; padding: 12px 20px; border-radius: 15px;
      margin-top: 25px; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    
    /* STORY SCREEN */
    .story-scene {
      background: white; border-radius: 25px; padding: 25px;
      margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      min-height: 400px; position: relative;
    }
    .scene-image {
      font-size: 80px; text-align: center; margin-bottom: 20px;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .scene-text {
      font-size: 1.4rem; text-align: center; color: #333;
      line-height: 1.6; margin-bottom: 25px;
    }
    .scene-text .highlight {
      background: linear-gradient(180deg, transparent 60%, #FFEB3B 60%);
      padding: 0 5px; font-weight: 700;
    }
    .scene-text .highlight-green {
      background: linear-gradient(180deg, transparent 60%, #A5D6A7 60%);
      padding: 0 5px; font-weight: 700;
    }
    .scene-text .highlight-orange {
      background: linear-gradient(180deg, transparent 60%, #FFCC80 60%);
      padding: 0 5px; font-weight: 700;
    }
    
    .scene-question {
      background: #FFF9C4; padding: 15px 20px; border-radius: 15px;
      text-align: center; font-size: 1.2rem; color: #5D4037;
      margin-bottom: 20px;
    }
    
    .choice-buttons { display: flex; flex-direction: column; gap: 12px; }
    .choice-btn {
      padding: 18px 25px; font-size: 1.2rem; font-weight: 600;
      border: 3px solid #E0E0E0; border-radius: 15px; background: white;
      cursor: pointer; font-family: 'Nunito', sans-serif; transition: all 0.2s;
      text-align: left;
    }
    .choice-btn:hover { border-color: #2196F3; background: #E3F2FD; }
    .choice-btn.correct {
      border-color: #4CAF50; background: #E8F5E9;
      animation: pulse 0.5s ease;
    }
    .choice-btn.wrong {
      border-color: #F44336; background: #FFEBEE;
      animation: shake 0.5s ease;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .feedback-box {
      margin-top: 20px; padding: 20px; border-radius: 15px;
      text-align: center; animation: fadeIn 0.3s ease;
    }
    .feedback-box.correct { background: #E8F5E9; }
    .feedback-box.wrong { background: #FFF3E0; }
    .feedback-emoji { font-size: 50px; margin-bottom: 10px; }
    .feedback-text { font-size: 1.1rem; color: #333; margin-bottom: 15px; }
    .feedback-tip {
      background: white; padding: 12px 15px; border-radius: 10px;
      font-size: 1rem; color: #666; margin-bottom: 15px;
    }
    
    .next-btn {
      width: 100%; padding: 15px; font-size: 1.2rem; font-weight: 700;
      border: none; border-radius: 50px; cursor: pointer;
      font-family: 'Nunito', sans-serif; transition: all 0.2s;
      background: linear-gradient(135deg, #667eea, #764ba2); color: white;
    }
    .next-btn:hover { transform: translateY(-2px); }
    
    /* Progress */
    .progress-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 15px;
    }
    .back-btn {
      background: rgba(255,255,255,0.9); border: none; padding: 10px 18px;
      border-radius: 25px; font-weight: 700; cursor: pointer;
      font-family: 'Nunito', sans-serif; color: #333;
    }
    .progress-dots { display: flex; gap: 8px; }
    .dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: rgba(255,255,255,0.4);
    }
    .dot.active { background: white; }
    .dot.done { background: #4CAF50; }
    .star-count {
      background: rgba(255,255,255,0.9); padding: 8px 15px;
      border-radius: 20px; font-weight: 700; color: #FF9800;
    }
    
    /* RESULT SCREEN */
    .result-content { text-align: center; padding-top: 40px; }
    .result-card {
      background: white; border-radius: 25px; padding: 35px 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    .result-emoji { font-size: 80px; margin-bottom: 15px; }
    .result-title { font-size: 1.8rem; font-weight: 800; color: #333; margin-bottom: 10px; }
    .result-stars { font-size: 45px; margin: 15px 0; }
    .result-message { font-size: 1.1rem; color: #666; margin-bottom: 25px; }
    .result-buttons { display: flex; flex-direction: column; gap: 12px; }
    .result-btn {
      padding: 15px 25px; font-size: 1.1rem; font-weight: 700;
      border: none; border-radius: 50px; cursor: pointer;
      font-family: 'Nunito', sans-serif;
    }
    .result-btn.primary {
      background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white;
    }
    .result-btn.secondary {
      background: #F5F5F5; color: #333;
    }
    
    /* LEARN SCREEN - Visual Patterns */
    .pattern-card {
      background: white; border-radius: 20px; padding: 25px;
      margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .pattern-title {
      display: flex; align-items: center; gap: 10px;
      font-size: 1.3rem; font-weight: 700; color: #333; margin-bottom: 20px;
    }
    .pattern-title .icon { font-size: 30px; }
    
    .example-row {
      display: flex; align-items: center; gap: 15px;
      padding: 15px; margin-bottom: 10px; border-radius: 12px;
      background: #F5F5F5;
    }
    .example-row .emoji { font-size: 35px; }
    .example-row .sentence { font-size: 1.1rem; color: #333; }
    .example-row .sentence strong { color: #4CAF50; }
    .example-row .sentence .past { color: #FF9800; }
    
    .tip-bubble {
      background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
      padding: 15px 20px; border-radius: 15px;
      display: flex; align-items: flex-start; gap: 12px;
      margin-top: 15px;
    }
    .tip-bubble .bulb { font-size: 25px; }
    .tip-bubble .tip-text { font-size: 1rem; color: #1565C0; }
    
    /* Visual comparison */
    .compare-box {
      display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
      margin: 20px 0;
    }
    .compare-side {
      padding: 20px 15px; border-radius: 15px; text-align: center;
    }
    .compare-side.now { background: #E8F5E9; }
    .compare-side.past { background: #FFF3E0; }
    .compare-side .label {
      font-weight: 700; margin-bottom: 10px; font-size: 1rem;
    }
    .compare-side.now .label { color: #2E7D32; }
    .compare-side.past .label { color: #E65100; }
    .compare-side .time-words {
      display: flex; flex-wrap: wrap; gap: 6px; justify-content: center;
      margin-bottom: 12px;
    }
    .time-word {
      background: white; padding: 5px 12px; border-radius: 20px;
      font-size: 0.85rem; font-weight: 600;
    }
    .compare-side.now .time-word { color: #4CAF50; }
    .compare-side.past .time-word { color: #FF9800; }
    .compare-side .example {
      background: white; padding: 10px; border-radius: 10px;
      font-size: 0.95rem; color: #333;
    }
    
    /* Word cards for irregular verbs */
    .word-pairs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .word-pair {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      background: #F5F5F5; padding: 12px; border-radius: 12px;
    }
    .word-pair .now { color: #4CAF50; font-weight: 700; }
    .word-pair .arrow { color: #999; }
    .word-pair .past { color: #FF9800; font-weight: 700; }
    .word-pair .meaning { color: #999; font-size: 0.85rem; }
    
    /* Matching game */
    .match-instruction {
      text-align: center; color: white; font-size: 1.1rem;
      margin-bottom: 20px; padding: 15px;
      background: rgba(255,255,255,0.2); border-radius: 15px;
    }
    .match-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    }
    .match-card {
      padding: 18px 10px; border-radius: 15px; font-size: 1.1rem;
      font-weight: 700; cursor: pointer; text-align: center;
      font-family: 'Nunito', sans-serif; border: none;
      transition: all 0.2s;
    }
    .match-card.type-now { background: #E8F5E9; color: #2E7D32; }
    .match-card.type-past { background: #FFF3E0; color: #E65100; }
    .match-card.selected { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .match-card.matched { opacity: 0.5; cursor: default; }
    
    /* STUDY SCREEN STYLES */
    .study-header {
      text-align: center; padding: 15px 0; margin-bottom: 15px;
    }
    .study-title {
      font-size: 1.8rem; font-weight: 800; color: white;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
    }
    .study-subtitle { color: rgba(255,255,255,0.9); margin-top: 5px; }
    
    .group-selector {
      display: flex; flex-wrap: wrap; gap: 8px;
      justify-content: center; margin-bottom: 20px;
    }
    .group-btn {
      padding: 8px 16px; border-radius: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.15);
      color: white; font-weight: 600; cursor: pointer;
      font-family: 'Nunito', sans-serif; font-size: 0.85rem;
      transition: all 0.2s;
    }
    .group-btn:hover { background: rgba(255,255,255,0.25); }
    .group-btn.active {
      background: white; color: #667eea;
      border-color: white;
    }
    
    .verb-group-card {
      background: white; border-radius: 20px;
      margin-bottom: 15px; overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .verb-group-header {
      padding: 15px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; cursor: pointer;
      display: flex; justify-content: space-between; align-items: center;
    }
    .verb-group-header.expanded { border-radius: 0; }
    .verb-group-title {
      font-weight: 700; font-size: 1.1rem;
      display: flex; align-items: center; gap: 10px;
    }
    .verb-group-count {
      background: rgba(255,255,255,0.2);
      padding: 4px 12px; border-radius: 15px;
      font-size: 0.85rem;
    }
    .verb-group-arrow {
      transition: transform 0.3s;
      font-size: 1.2rem;
    }
    .verb-group-arrow.rotated { transform: rotate(180deg); }
    
    .verb-group-content {
      max-height: 0; overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .verb-group-content.expanded {
      max-height: 2000px;
    }
    
    .verb-table {
      width: 100%; border-collapse: collapse;
    }
    .verb-table th {
      padding: 12px 10px;
      background: #f8f9fa;
      font-weight: 700; font-size: 0.85rem;
      color: #666; text-align: center;
      border-bottom: 2px solid #eee;
      position: sticky; top: 0;
    }
    .verb-table th:first-child { text-align: left; padding-left: 20px; }
    .verb-table td {
      padding: 12px 10px;
      border-bottom: 1px solid #f0f0f0;
      text-align: center; font-size: 0.95rem;
    }
    .verb-table td:first-child {
      text-align: left; padding-left: 20px;
      font-weight: 600; color: #4CAF50;
    }
    .verb-table td:nth-child(2) { color: #FF9800; font-weight: 600; }
    .verb-table td:nth-child(3) { color: #9C27B0; font-weight: 600; }
    .verb-table td:last-child { color: #666; font-size: 0.85rem; }
    
    .verb-table tr:hover { background: #f8f9fa; }
    .verb-table tr.mastered { background: #E8F5E9; }
    .verb-table tr.mastered td:first-child::before {
      content: 'âœ“ '; color: #4CAF50;
    }
    
    .study-tip-box {
      background: linear-gradient(135deg, #FFF9C4 0%, #FFECB3 100%);
      padding: 15px 20px; border-radius: 15px;
      margin-bottom: 20px;
      display: flex; align-items: flex-start; gap: 12px;
    }
    .study-tip-icon { font-size: 30px; }
    .study-tip-text { color: #5D4037; font-size: 0.95rem; line-height: 1.5; }
    
    .study-modes {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
      margin-bottom: 20px;
    }
    .study-mode-btn {
      padding: 15px; border-radius: 15px;
      border: none; cursor: pointer;
      font-family: 'Nunito', sans-serif;
      font-weight: 700; font-size: 1rem;
      display: flex; flex-direction: column;
      align-items: center; gap: 5px;
      transition: all 0.2s;
    }
    .study-mode-btn:hover { transform: translateY(-3px); }
    .study-mode-btn .icon { font-size: 30px; }
    .study-mode-btn.quiz { background: #E3F2FD; color: #1565C0; }
    .study-mode-btn.practice { background: #E8F5E9; color: #2E7D32; }
    .study-mode-btn.speed { background: #FFF3E0; color: #E65100; }
    .study-mode-btn.memory { background: #F3E5F5; color: #7B1FA2; }
    
    /* Quick Quiz Modal */
    .quiz-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center;
      z-index: 1000; padding: 20px;
    }
    .quiz-modal {
      background: white; border-radius: 25px;
      padding: 30px; max-width: 400px; width: 100%;
      text-align: center;
      animation: modalIn 0.3s ease;
    }
    @keyframes modalIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .quiz-question { font-size: 1.1rem; color: #333; margin-bottom: 10px; }
    .quiz-verb {
      font-size: 2.5rem; font-weight: 800;
      color: #4CAF50; margin: 20px 0;
    }
    .quiz-input {
      width: 100%; padding: 15px 20px;
      font-size: 1.3rem; font-family: 'Nunito', sans-serif;
      border: 3px solid #E0E0E0; border-radius: 15px;
      text-align: center; font-weight: 700;
      outline: none; transition: border-color 0.2s;
    }
    .quiz-input:focus { border-color: #667eea; }
    .quiz-input.correct { border-color: #4CAF50; background: #E8F5E9; }
    .quiz-input.wrong { border-color: #F44336; background: #FFEBEE; }
    .quiz-hint {
      margin-top: 10px; color: #999; font-size: 0.9rem;
    }
    .quiz-progress {
      display: flex; justify-content: center; gap: 8px;
      margin-top: 20px;
    }
    .quiz-dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: #E0E0E0;
    }
    .quiz-dot.done { background: #4CAF50; }
    .quiz-dot.wrong-dot { background: #F44336; }
    .quiz-dot.current { background: #667eea; transform: scale(1.2); }
    
    /* Speed Challenge */
    .speed-timer {
      font-size: 3rem; font-weight: 800;
      color: white; text-align: center;
      margin: 20px 0;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
    }
    .speed-timer.warning { color: #FFEB3B; animation: pulse 0.5s infinite; }
    .speed-timer.danger { color: #F44336; animation: shake 0.3s infinite; }
    
    .speed-score {
      background: rgba(255,255,255,0.2);
      padding: 10px 20px; border-radius: 15px;
      color: white; font-weight: 700;
      text-align: center; margin-bottom: 20px;
    }
    
    /* Memory Game */
    .memory-grid {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 10px; margin: 20px 0;
    }
    .memory-card {
      aspect-ratio: 1; border-radius: 12px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 1rem; font-weight: 700;
      color: white; transition: all 0.3s;
      position: relative;
    }
    .memory-card.flipped {
      background: white; color: #333;
    }
    .memory-card.matched {
      background: #4CAF50; color: white;
      animation: pulse 0.5s;
    }
    .memory-card .card-back {
      font-size: 1.5rem;
    }
    
    /* Pattern highlight colors */
    .pattern-important { background: linear-gradient(135deg, #E91E63, #F48FB1); }
    .pattern-perception { background: linear-gradient(135deg, #9C27B0, #CE93D8); }
    .pattern-no-change { background: linear-gradient(135deg, #607D8B, #90A4AE); }
    .pattern-vowel { background: linear-gradient(135deg, #2196F3, #90CAF9); }
    .pattern-drink { background: linear-gradient(135deg, #00BCD4, #80DEEA); }
    .pattern-ow-ew { background: linear-gradient(135deg, #4CAF50, #A5D6A7); }
    .pattern-ought { background: linear-gradient(135deg, #FF9800, #FFCC80); }
    .pattern-stand { background: linear-gradient(135deg, #795548, #BCAAA4); }
    .pattern-ee { background: linear-gradient(135deg, #3F51B5, #9FA8DA); }
    .pattern-d-t { background: linear-gradient(135deg, #009688, #80CBC4); }
    .pattern-t { background: linear-gradient(135deg, #FF5722, #FFAB91); }
    .pattern-misc { background: linear-gradient(135deg, #673AB7, #B39DDB); }
    
    /* Easy Match Game */
    .easy-match-container {
      background: white; border-radius: 20px;
      padding: 20px; margin-top: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .easy-match-header {
      text-align: center; margin-bottom: 20px;
    }
    .easy-match-title {
      font-size: 1.3rem; font-weight: 700; color: #333;
      margin-bottom: 5px;
    }
    .easy-match-hint {
      color: #666; font-size: 0.95rem;
    }
    .easy-match-columns {
      display: flex; gap: 15px;
    }
    .easy-match-column {
      flex: 1; display: flex; flex-direction: column; gap: 10px;
    }
    .easy-match-label {
      text-align: center; font-weight: 700; padding: 8px;
      border-radius: 10px; font-size: 0.9rem;
    }
    .easy-match-label.base { background: #E8F5E9; color: #2E7D32; }
    .easy-match-label.past { background: #FFF3E0; color: #E65100; }
    
    .easy-match-card {
      padding: 15px 12px; border-radius: 12px;
      text-align: center; cursor: pointer;
      transition: all 0.2s; border: 3px solid transparent;
      font-family: 'Nunito', sans-serif; font-weight: 600;
    }
    .easy-match-card.base-card {
      background: #E8F5E9; color: #2E7D32;
    }
    .easy-match-card.past-card {
      background: #FFF3E0; color: #E65100;
    }
    .easy-match-card:hover:not(.matched):not(.disabled) {
      transform: scale(1.03);
    }
    .easy-match-card.selected {
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102,126,234,0.4);
      transform: scale(1.05);
    }
    .easy-match-card.matched {
      opacity: 0.4; cursor: default;
      text-decoration: line-through;
    }
    .easy-match-card.correct-flash {
      animation: correctFlash 0.5s ease;
      background: #4CAF50 !important;
      color: white !important;
      border-color: #4CAF50;
    }
    .easy-match-card.wrong-flash {
      animation: wrongFlash 0.5s ease;
      border-color: #F44336;
    }
    @keyframes correctFlash {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    @keyframes wrongFlash {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }
    .easy-match-card .verb-text {
      font-size: 1.2rem; margin-bottom: 3px;
    }
    .easy-match-card .verb-meaning {
      font-size: 0.75rem; opacity: 0.8; font-weight: 400;
    }
    .easy-match-score {
      text-align: center; margin-top: 20px;
      padding: 15px; background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
      border-radius: 12px;
    }
    .easy-match-progress {
      display: flex; justify-content: center; gap: 6px;
      margin-bottom: 10px;
    }
    .easy-match-dot {
      width: 24px; height: 24px; border-radius: 50%;
      background: #E0E0E0; display: flex;
      align-items: center; justify-content: center;
      font-size: 0.7rem;
    }
    .easy-match-dot.done {
      background: #4CAF50; color: white;
    }
    .easy-match-level-select {
      display: flex; flex-direction: column; gap: 12px;
      margin-top: 15px;
    }
    .easy-match-level {
      display: flex; align-items: center; gap: 15px;
      background: white; padding: 18px 20px; border-radius: 15px;
      cursor: pointer; transition: all 0.2s;
      border: 3px solid transparent;
    }
    .easy-match-level:hover { transform: translateY(-2px); }
    .easy-match-level.easy { border-color: #4CAF50; }
    .easy-match-level.medium { border-color: #FF9800; }
    .easy-match-level.hard { border-color: #E91E63; }
    .easy-match-level .level-icon { font-size: 2rem; }
    .easy-match-level .level-info { flex: 1; }
    .easy-match-level .level-name { font-weight: 700; color: #333; }
    .easy-match-level .level-desc { font-size: 0.85rem; color: #666; }
    
    /* Triple Match Game */
    .triple-match-container {
      background: white; border-radius: 20px;
      padding: 15px; margin-top: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .triple-columns {
      display: flex; gap: 8px;
    }
    .triple-column {
      flex: 1; display: flex; flex-direction: column; gap: 8px;
    }
    .triple-label {
      text-align: center; font-weight: 700; padding: 6px 4px;
      border-radius: 10px; font-size: 0.6rem;
      line-height: 1.2;
    }
    .triple-label.inf { background: #E3F2FD; color: #1565C0; }
    .triple-label.past { background: #FFF3E0; color: #E65100; }
    .triple-label.pp { background: #F3E5F5; color: #7B1FA2; }
    
    .triple-card {
      padding: 12px 6px; border-radius: 10px;
      text-align: center; cursor: pointer;
      transition: all 0.2s; border: 3px solid transparent;
      font-family: 'Nunito', sans-serif; font-weight: 600;
      font-size: 0.9rem;
    }
    .triple-card.inf-card { background: #E3F2FD; color: #1565C0; }
    .triple-card.past-card { background: #FFF3E0; color: #E65100; }
    .triple-card.pp-card { background: #F3E5F5; color: #7B1FA2; }
    
    .triple-card:hover:not(.matched) { transform: scale(1.03); }
    .triple-card.selected {
      border-color: #333;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
      transform: scale(1.05);
    }
    .triple-card.locked {
      border-color: #4CAF50;
      background: #C8E6C9 !important;
      color: #2E7D32 !important;
    }
    .triple-card.matched {
      opacity: 0.35; cursor: default;
      text-decoration: line-through;
    }
    .triple-card.correct-flash {
      animation: tripleCorrect 0.6s ease;
      background: #4CAF50 !important;
      color: white !important;
    }
    @keyframes tripleCorrect {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .triple-card .card-meaning {
      font-size: 0.65rem; font-weight: 400;
      opacity: 0.8; margin-top: 2px;
    }
    .triple-hint-bar {
      background: linear-gradient(135deg, #FFF9C4, #FFECB3);
      padding: 12px 15px; border-radius: 12px;
      margin-bottom: 12px; text-align: center;
      font-size: 0.9rem; color: #5D4037;
    }
    .triple-hint-bar .step {
      display: inline-block; padding: 3px 10px;
      border-radius: 15px; margin: 0 3px;
      font-weight: 700;
    }
    .triple-hint-bar .step.active { background: #4CAF50; color: white; }
    .triple-hint-bar .step.done { background: #81C784; color: white; }
    .triple-hint-bar .step.waiting { background: #E0E0E0; color: #999; }
    .triple-score-bar {
      display: flex; justify-content: space-between;
      align-items: center; margin-top: 15px;
      padding: 12px 15px; background: #F5F5F5;
      border-radius: 12px;
    }
    .triple-progress-dots {
      display: flex; gap: 5px;
    }
    .triple-dot {
      width: 22px; height: 22px; border-radius: 50%;
      background: #E0E0E0; display: flex;
      align-items: center; justify-content: center;
      font-size: 0.65rem; font-weight: 700;
    }
    .triple-dot.done { background: #4CAF50; color: white; }
    
    /* Sentence Quiz */
    .sentence-quiz-card {
      background: white; border-radius: 20px;
      padding: 25px 20px; margin-top: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .sentence-quiz-signal {
      text-align: center; margin-bottom: 15px;
    }
    .signal-badge {
      display: inline-block; padding: 8px 20px;
      border-radius: 20px; font-weight: 700;
      font-size: 1.1rem;
    }
    .signal-badge.present {
      background: #E8F5E9; color: #2E7D32;
    }
    .signal-badge.past {
      background: #FFF3E0; color: #E65100;
    }
    .sentence-quiz-sentence {
      font-size: 1.3rem; text-align: center;
      padding: 20px; margin: 15px 0;
      background: #F5F5F5; border-radius: 15px;
      line-height: 1.6;
    }
    .sentence-quiz-sentence .blank {
      display: inline-block; min-width: 80px;
      border-bottom: 3px solid #667eea;
      margin: 0 5px; color: #667eea;
      font-weight: 700;
    }
    .sentence-quiz-meaning {
      text-align: center; color: #666;
      font-size: 0.95rem; margin-bottom: 20px;
    }
    .sentence-quiz-choices {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .sentence-choice-btn {
      padding: 12px 10px; border-radius: 12px;
      border: 3px solid #E0E0E0;
      background: white; cursor: pointer;
      font-family: 'Nunito', sans-serif;
      font-size: 1.05rem; font-weight: 700;
      transition: all 0.2s;
    }
    .sentence-choice-btn:hover {
      border-color: #667eea; background: #F5F5FF;
    }
    .sentence-choice-btn.correct {
      border-color: #4CAF50; background: #E8F5E9;
      color: #2E7D32;
    }
    .sentence-choice-btn.wrong {
      border-color: #F44336; background: #FFEBEE;
      color: #C62828;
    }
    .sentence-choice-btn.show-correct {
      border-color: #4CAF50; background: #E8F5E9;
      color: #2E7D32;
    }
    .sentence-choice-btn .choice-label {
      font-size: 0.7rem; color: #999;
      margin-bottom: 2px; font-weight: 400;
    }
    .sentence-feedback {
      margin-top: 20px; padding: 15px;
      border-radius: 12px; text-align: center;
    }
    .sentence-feedback.correct { background: #E8F5E9; }
    .sentence-feedback.wrong { background: #FFF3E0; }
    .sentence-feedback .emoji { font-size: 2.5rem; margin-bottom: 8px; }
    .sentence-feedback .message { font-weight: 700; margin-bottom: 5px; }
    .sentence-feedback .explanation {
      font-size: 0.9rem; color: #666;
      margin-bottom: 15px;
    }
    
    .match-score {
      text-align: center; margin-top: 20px;
      background: white; padding: 15px; border-radius: 15px;
      font-size: 1.2rem; font-weight: 700;
    }
    
    /* Flashcards */
    .flashcard-container { perspective: 1000px; margin: 20px 0; }
    .flashcard {
      width: 100%; height: 200px; cursor: pointer;
      position: relative; transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    .flashcard.flipped { transform: rotateY(180deg); }
    .flashcard-face {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden; border-radius: 20px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 20px;
    }
    .flashcard-front { background: linear-gradient(135deg, #E8F5E9, #C8E6C9); }
    .flashcard-back {
      background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
      transform: rotateY(180deg);
    }
    .flashcard-word { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
    .flashcard-front .flashcard-word { color: #2E7D32; }
    .flashcard-back .flashcard-word { color: #E65100; }
    .flashcard-label { font-size: 1rem; color: #666; }
    .flashcard-meaning { font-size: 1.1rem; color: #666; margin-top: 10px; }
    .flashcard-hint { font-size: 0.9rem; color: #999; margin-top: 15px; }
    
    .flashcard-nav {
      display: flex; justify-content: center; gap: 15px; margin-top: 20px;
    }
    .flashcard-btn {
      padding: 12px 25px; border-radius: 25px; font-weight: 700;
      cursor: pointer; font-family: 'Nunito', sans-serif; border: none;
      background: white; color: #333;
    }
    .flashcard-btn:hover { background: #F5F5F5; }
    
    /* Confetti */
    .confetti-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1000;
    }
    .confetti {
      position: absolute; width: 10px; height: 10px;
      animation: confettiFall 3s linear forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    /* Responsive */
    @media (max-width: 400px) {
      .app-title { font-size: 1.8rem; }
      .scene-text { font-size: 1.2rem; }
      .choice-btn { font-size: 1rem; padding: 15px 20px; }
    }
    
    /* Level Select */
    .level-content { text-align: center; padding-top: 30px; }
    .level-title { font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 10px; }
    .level-subtitle { color: rgba(255,255,255,0.8); margin-bottom: 25px; }
    .level-cards { display: flex; flex-direction: column; gap: 15px; padding: 0 10px; }
    .level-card {
      background: white; border-radius: 20px; padding: 20px;
      display: flex; align-items: center; gap: 15px;
      cursor: pointer; transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border: 3px solid transparent;
    }
    .level-card:hover { transform: translateY(-3px); }
    .level-card:active { transform: scale(0.98); }
    .level-card.easy { border-color: #4CAF50; }
    .level-card.medium { border-color: #FF9800; }
    .level-card.hard { border-color: #E91E63; }
    .level-card .level-icon { font-size: 40px; }
    .level-card .level-info { text-align: left; flex: 1; }
    .level-card .level-name { font-size: 1.2rem; font-weight: 700; color: #333; }
    .level-card .level-desc { font-size: 0.9rem; color: #666; }
    .level-card .level-time { 
      background: #f5f5f5; padding: 5px 12px; border-radius: 15px;
      font-size: 0.85rem; color: #888; font-weight: 600;
    }
    .level-card.easy .level-name { color: #2E7D32; }
    .level-card.medium .level-name { color: #E65100; }
    .level-card.hard .level-name { color: #C2185B; }
  </style>
</head>
<body>
  <div class="app-container bg-fun" id="appContainer">
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>
    <div id="confettiContainer" class="confetti-container"></div>
    
    <!-- HOME SCREEN -->
    <div id="homeScreen" class="screen active">
      <div class="home-content">
        <div class="mascot-large">ğŸ¦‰</div>
        <h1 class="app-title">Fun English!</h1>
        <p class="app-tagline">Há»c tiáº¿ng Anh vui váº» má»—i ngÃ y</p>
        
        <div class="topic-grid">
          <div class="topic-card daily" onclick="showLevelSelect('daily')">
            <div class="topic-icon">â˜€ï¸</div>
            <div class="topic-name">Every Day</div>
          </div>
          <div class="topic-card yesterday" onclick="showLevelSelect('yesterday')">
            <div class="topic-icon">ğŸŒ™</div>
            <div class="topic-name">Yesterday</div>
          </div>
          <div class="topic-card stories" onclick="showLevelSelect('stories')">
            <div class="topic-icon">ğŸ“–</div>
            <div class="topic-name">Mix Stories</div>
          </div>
          <div class="topic-card" onclick="showLearnScreen()" style="border-color:#4CAF50">
            <div class="topic-icon">ğŸ“š</div>
            <div class="topic-name">Há»c kiáº¿n thá»©c</div>
          </div>
          <div class="topic-card games" onclick="startTopic('games')">
            <div class="topic-icon">ğŸ®</div>
            <div class="topic-name">Word Games</div>
          </div>
        </div>
        
        <div class="streak-banner" id="streakBanner">
          <span>ğŸ”¥</span>
          <span id="streakText">Báº¯t Ä‘áº§u há»c nÃ o!</span>
        </div>
      </div>
    </div>
    
    <!-- LEVEL SELECT SCREEN -->
    <div id="levelScreen" class="screen"></div>
    
    <!-- STORY SCREEN -->
    <div id="storyScreen" class="screen"></div>
    
    <!-- RESULT SCREEN -->
    <div id="resultScreen" class="screen"></div>
    
    <!-- LEARN SCREEN -->
    <div id="learnScreen" class="screen"></div>
    
    <!-- GAME SCREEN -->
    <div id="gameScreen" class="screen"></div>
  </div>

<script>
// ============ DATA - Cambridge Style ============
// ============ DATA - Cambridge Style (Expanded with All Signal Words) ============
var STORIES = {
  daily: [
    // ===== EVERY DAY =====
    {
      bg: 'bg-sunny',
      scenes: [
        { image: 'ğŸŒ…ğŸ‘§', text: 'Lily <span class="highlight-green">wakes up</span> at 7 <span class="highlight">every day</span>.', question: 'Every day, Lily ___ up at 7.', choices: ['wakes â˜€ï¸', 'woke ğŸŒ™'], correct: 0, feedback: 'Yes! every day â†’ wakes', tip: 'â˜€ï¸ every day = má»—i ngÃ y' },
        { image: 'ğŸš«ğŸ¬', text: 'She <span class="highlight-green">doesn\'t eat</span> candy <span class="highlight">every day</span>.', question: 'She ___ eat candy every day.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! every day â†’ doesn\'t', tip: 'ğŸš« every day â†’ doesn\'t' },
        { image: 'â“ğŸ«', text: '"<span class="highlight-green">Does she go</span> to school <span class="highlight">every day</span>?"', question: '___ she go to school every day?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! every day â†’ Does', tip: 'â“ every day â†’ Does...?' },
        { image: 'ğŸğŸ‘¦', text: 'Tom <span class="highlight-green">eats</span> an apple <span class="highlight">every day</span>.', question: 'Tom ___ an apple every day.', choices: ['eats â˜€ï¸', 'ate ğŸŒ™'], correct: 0, feedback: 'Wonderful! every day â†’ eats', tip: 'â˜€ï¸ every day â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ”', text: 'He <span class="highlight-green">doesn\'t eat</span> fast food <span class="highlight">every day</span>.', question: 'He doesn\'t ___ fast food every day.', choices: ['eat ğŸš«', 'eats ğŸš«'], correct: 0, feedback: 'Excellent! doesn\'t + eat (gá»‘c)', tip: 'âš ï¸ doesn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ¥›', text: '"<span class="highlight-green">Do you drink</span> milk <span class="highlight">every day</span>?"', question: '___ you drink milk every day?', choices: ['Do â“', 'Does â“'], correct: 0, feedback: 'Great! you â†’ Do', tip: 'â“ Do + you...?' }
      ]
    },
    // ===== EVERY MORNING =====
    {
      bg: 'bg-sunny',
      scenes: [
        { image: 'ğŸ¦·ğŸ‘§', text: 'Lily <span class="highlight-green">brushes</span> her teeth <span class="highlight">every morning</span>.', question: 'Lily ___ her teeth every morning.', choices: ['brushes â˜€ï¸', 'brushed ğŸŒ™'], correct: 0, feedback: 'Yes! every morning â†’ brushes', tip: 'â˜€ï¸ every morning = má»—i sÃ¡ng' },
        { image: 'ğŸš«â˜•', text: 'She <span class="highlight-green">doesn\'t drink</span> coffee <span class="highlight">every morning</span>.', question: 'She ___ drink coffee every morning.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! every morning â†’ doesn\'t', tip: 'ğŸš« every morning â†’ doesn\'t' },
        { image: 'â“ğŸ³', text: '"<span class="highlight-green">Does Mom cook</span> breakfast <span class="highlight">every morning</span>?"', question: '___ Mom cook every morning?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! Mom (she) â†’ Does', tip: 'â“ every morning â†’ Does...?' },
        { image: 'ğŸƒğŸ‘¦', text: 'Tom <span class="highlight-green">runs</span> in the park <span class="highlight">every morning</span>.', question: 'Tom ___ in the park every morning.', choices: ['runs â˜€ï¸', 'ran ğŸŒ™'], correct: 0, feedback: 'Wonderful! every morning â†’ runs', tip: 'â˜€ï¸ every morning â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ“º', text: 'He <span class="highlight-green">doesn\'t watch</span> TV <span class="highlight">every morning</span>.', question: 'He doesn\'t ___ TV every morning.', choices: ['watch ğŸš«', 'watches ğŸš«'], correct: 0, feedback: 'Excellent! doesn\'t + watch (gá»‘c)', tip: 'âš ï¸ doesn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸšŒ', text: '"<span class="highlight-green">Do they take</span> the bus <span class="highlight">every morning</span>?"', question: '___ they take the bus every morning?', choices: ['Do â“', 'Does â“'], correct: 0, feedback: 'Great! they â†’ Do', tip: 'â“ Do + they...?' }
      ]
    },
    // ===== EVERY NIGHT =====
    {
      bg: 'bg-night',
      scenes: [
        { image: 'ğŸ“–ğŸ‘§', text: 'Lily <span class="highlight-green">reads</span> books <span class="highlight">every night</span>.', question: 'Lily ___ books every night.', choices: ['reads â˜€ï¸', 'read ğŸŒ™'], correct: 0, feedback: 'Yes! every night â†’ reads', tip: 'â˜€ï¸ every night = má»—i tá»‘i' },
        { image: 'ğŸš«ğŸ®', text: 'She <span class="highlight-green">doesn\'t play</span> games <span class="highlight">every night</span>.', question: 'She ___ play games every night.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! every night â†’ doesn\'t', tip: 'ğŸš« every night â†’ doesn\'t' },
        { image: 'â“ğŸ˜´', text: '"<span class="highlight-green">Does she sleep</span> early <span class="highlight">every night</span>?"', question: '___ she sleep early every night?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! she â†’ Does', tip: 'â“ every night â†’ Does...?' },
        { image: 'ğŸ“ºğŸ‘¨â€ğŸ‘©â€ğŸ‘§', text: 'The family <span class="highlight-green">watches</span> TV <span class="highlight">every night</span>.', question: 'The family ___ TV every night.', choices: ['watches â˜€ï¸', 'watched ğŸŒ™'], correct: 0, feedback: 'Wonderful! every night â†’ watches', tip: 'â˜€ï¸ every night â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ•', text: 'They <span class="highlight-green">don\'t eat</span> pizza <span class="highlight">every night</span>.', question: 'They ___ eat pizza every night.', choices: ['don\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Excellent! they â†’ don\'t', tip: 'ğŸš« They + don\'t' },
        { image: 'â“ğŸµ', text: '"<span class="highlight-green">Do you listen</span> to music <span class="highlight">every night</span>?"', question: '___ you listen to music every night?', choices: ['Do â“', 'Did â“'], correct: 0, feedback: 'Great! you â†’ Do', tip: 'â“ every night â†’ Do...?' }
      ]
    },
    // ===== EVERY WEEK =====
    {
      bg: 'bg-park',
      scenes: [
        { image: 'âš½ğŸ‘¦', text: 'Tom <span class="highlight-green">plays</span> football <span class="highlight">every week</span>.', question: 'Tom ___ football every week.', choices: ['plays â˜€ï¸', 'played ğŸŒ™'], correct: 0, feedback: 'Yes! every week â†’ plays', tip: 'â˜€ï¸ every week = má»—i tuáº§n' },
        { image: 'ğŸš«ğŸŠ', text: 'He <span class="highlight-green">doesn\'t swim</span> <span class="highlight">every week</span>.', question: 'He ___ swim every week.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! every week â†’ doesn\'t', tip: 'ğŸš« every week â†’ doesn\'t' },
        { image: 'â“ğŸ¾', text: '"<span class="highlight-green">Does he play</span> tennis <span class="highlight">every week</span>?"', question: '___ he play tennis every week?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! he â†’ Does', tip: 'â“ every week â†’ Does...?' },
        { image: 'ğŸ›’ğŸ‘©', text: 'Mom <span class="highlight-green">goes</span> shopping <span class="highlight">every week</span>.', question: 'Mom ___ shopping every week.', choices: ['goes â˜€ï¸', 'went ğŸŒ™'], correct: 0, feedback: 'Wonderful! every week â†’ goes', tip: 'â˜€ï¸ every week â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ°', text: 'She <span class="highlight-green">doesn\'t buy</span> cake <span class="highlight">every week</span>.', question: 'She doesn\'t ___ cake every week.', choices: ['buy ğŸš«', 'buys ğŸš«'], correct: 0, feedback: 'Excellent! doesn\'t + buy (gá»‘c)', tip: 'âš ï¸ doesn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ ', text: '"<span class="highlight-green">Do they clean</span> the house <span class="highlight">every week</span>?"', question: '___ they clean the house every week?', choices: ['Do â“', 'Does â“'], correct: 0, feedback: 'Great! they â†’ Do', tip: 'â“ Do + they...?' }
      ]
    },
    // ===== ALWAYS =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸğŸ‘§', text: 'Lily <span class="highlight">always</span> <span class="highlight-green">eats</span> fruit.', question: 'Lily always ___ fruit.', choices: ['eats â˜€ï¸', 'ate ğŸŒ™'], correct: 0, feedback: 'Yes! always â†’ eats', tip: 'â˜€ï¸ always = luÃ´n luÃ´n' },
        { image: 'ğŸš«ğŸ­', text: 'She <span class="highlight">always</span> <span class="highlight-green">doesn\'t forget</span> homework.', question: 'She always ___ forget homework.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! always â†’ doesn\'t', tip: 'ğŸš« always â†’ doesn\'t' },
        { image: 'â“ğŸ“š', text: '"<span class="highlight-green">Does she always study</span> hard?"', question: '___ she always study hard?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! always â†’ Does', tip: 'â“ always â†’ Does...?' },
        { image: 'ğŸ˜ŠğŸ‘¦', text: 'Tom is <span class="highlight">always</span> <span class="highlight-green">happy</span>.', question: 'Tom is always ___.', choices: ['happy â˜€ï¸', 'was happy ğŸŒ™'], correct: 0, feedback: 'Wonderful! always â†’ is', tip: 'â˜€ï¸ always â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ˜ ', text: 'He <span class="highlight">always</span> <span class="highlight-green">doesn\'t get</span> angry.', question: 'He always ___ get angry.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Excellent! always â†’ doesn\'t', tip: 'ğŸš« always â†’ doesn\'t' },
        { image: 'â“ğŸ™‹', text: '"<span class="highlight-green">Do you always help</span> your friends?"', question: '___ you always help your friends?', choices: ['Do â“', 'Did â“'], correct: 0, feedback: 'Great! you â†’ Do', tip: 'â“ always â†’ Do...?' }
      ]
    },
    // ===== USUALLY =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸš¶ğŸ‘§', text: 'Lily <span class="highlight">usually</span> <span class="highlight-green">walks</span> to school.', question: 'Lily usually ___ to school.', choices: ['walks â˜€ï¸', 'walked ğŸŒ™'], correct: 0, feedback: 'Yes! usually â†’ walks', tip: 'â˜€ï¸ usually = thÆ°á»ng thÆ°á»ng' },
        { image: 'ğŸš«ğŸšŒ', text: 'She <span class="highlight">usually</span> <span class="highlight-green">doesn\'t take</span> the bus.', question: 'She usually ___ take the bus.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! usually â†’ doesn\'t', tip: 'ğŸš« usually â†’ doesn\'t' },
        { image: 'â“ğŸƒ', text: '"<span class="highlight-green">Does she usually run</span> in the morning?"', question: '___ she usually run in the morning?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! usually â†’ Does', tip: 'â“ usually â†’ Does...?' },
        { image: 'ğŸšğŸ‘¨', text: 'Dad <span class="highlight">usually</span> <span class="highlight-green">cooks</span> dinner.', question: 'Dad usually ___ dinner.', choices: ['cooks â˜€ï¸', 'cooked ğŸŒ™'], correct: 0, feedback: 'Wonderful! usually â†’ cooks', tip: 'â˜€ï¸ usually â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸœ', text: 'He <span class="highlight">usually</span> <span class="highlight-green">doesn\'t make</span> noodles.', question: 'He usually doesn\'t ___ noodles.', choices: ['make ğŸš«', 'makes ğŸš«'], correct: 0, feedback: 'Excellent! doesn\'t + make (gá»‘c)', tip: 'âš ï¸ doesn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ³', text: '"<span class="highlight-green">Do they usually eat</span> together?"', question: '___ they usually eat together?', choices: ['Do â“', 'Does â“'], correct: 0, feedback: 'Great! they â†’ Do', tip: 'â“ usually â†’ Do...?' }
      ]
    },
    // ===== OFTEN =====
    {
      bg: 'bg-park',
      scenes: [
        { image: 'ğŸ®ğŸ‘§', text: 'Lily <span class="highlight">often</span> <span class="highlight-green">plays</span> games.', question: 'Lily often ___ games.', choices: ['plays â˜€ï¸', 'played ğŸŒ™'], correct: 0, feedback: 'Yes! often â†’ plays', tip: 'â˜€ï¸ often = thÆ°á»ng xuyÃªn' },
        { image: 'ğŸš«ğŸ˜¢', text: 'She <span class="highlight">often</span> <span class="highlight-green">doesn\'t cry</span>.', question: 'She often ___ cry.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! often â†’ doesn\'t', tip: 'ğŸš« often â†’ doesn\'t' },
        { image: 'â“ğŸ¨', text: '"<span class="highlight-green">Does she often draw</span> pictures?"', question: '___ she often draw pictures?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! often â†’ Does', tip: 'â“ often â†’ Does...?' },
        { image: 'ğŸ“–ğŸ‘¦', text: 'Tom <span class="highlight">often</span> <span class="highlight-green">reads</span> comics.', question: 'Tom often ___ comics.', choices: ['reads â˜€ï¸', 'read ğŸŒ™'], correct: 0, feedback: 'Wonderful! often â†’ reads', tip: 'â˜€ï¸ often â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ“š', text: 'He <span class="highlight">often</span> <span class="highlight-green">doesn\'t read</span> textbooks.', question: 'He often doesn\'t ___ textbooks.', choices: ['read ğŸš«', 'reads ğŸš«'], correct: 0, feedback: 'Excellent! doesn\'t + read (gá»‘c)', tip: 'âš ï¸ doesn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ¬', text: '"<span class="highlight-green">Do you often watch</span> movies?"', question: '___ you often watch movies?', choices: ['Do â“', 'Did â“'], correct: 0, feedback: 'Great! you â†’ Do', tip: 'â“ often â†’ Do...?' }
      ]
    },
    // ===== SOMETIMES =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸ¦ğŸ‘§', text: 'Lily <span class="highlight">sometimes</span> <span class="highlight-green">eats</span> ice cream.', question: 'Lily sometimes ___ ice cream.', choices: ['eats â˜€ï¸', 'ate ğŸŒ™'], correct: 0, feedback: 'Yes! sometimes â†’ eats', tip: 'â˜€ï¸ sometimes = Ä‘Ã´i khi' },
        { image: 'ğŸš«ğŸ«', text: 'She <span class="highlight">sometimes</span> <span class="highlight-green">doesn\'t eat</span> chocolate.', question: 'She sometimes ___ eat chocolate.', choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'], correct: 0, feedback: 'Great! sometimes â†’ doesn\'t', tip: 'ğŸš« sometimes â†’ doesn\'t' },
        { image: 'â“ğŸ‚', text: '"<span class="highlight-green">Does she sometimes bake</span> cakes?"', question: '___ she sometimes bake cakes?', choices: ['Does â“', 'Did â“'], correct: 0, feedback: 'Perfect! sometimes â†’ Does', tip: 'â“ sometimes â†’ Does...?' },
        { image: 'ğŸ¸ğŸ‘¦', text: 'Tom <span class="highlight">sometimes</span> <span class="highlight-green">plays</span> guitar.', question: 'Tom sometimes ___ guitar.', choices: ['plays â˜€ï¸', 'played ğŸŒ™'], correct: 0, feedback: 'Wonderful! sometimes â†’ plays', tip: 'â˜€ï¸ sometimes â†’ hiá»‡n táº¡i' },
        { image: 'ğŸš«ğŸ¹', text: 'He <span class="highlight">sometimes</span> <span class="highlight-green">doesn\'t practice</span> piano.', question: 'He sometimes doesn\'t ___ piano.', choices: ['practice ğŸš«', 'practices ğŸš«'], correct: 0, feedback: 'Excellent! doesn\'t + practice (gá»‘c)', tip: 'âš ï¸ doesn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ¤', text: '"<span class="highlight-green">Do they sometimes sing</span> songs?"', question: '___ they sometimes sing songs?', choices: ['Do â“', 'Does â“'], correct: 0, feedback: 'Great! they â†’ Do', tip: 'â“ sometimes â†’ Do...?' }
      ]
    }
  ],
  yesterday: [
    // ===== YESTERDAY =====
    {
      bg: 'bg-night',
      scenes: [
        { image: 'ğŸŒ™ğŸ‘§', text: 'Lily <span class="highlight-orange">woke up</span> late <span class="highlight-orange">yesterday</span>.', question: 'Yesterday, Lily ___ up late.', choices: ['woke ğŸŒ™', 'wakes â˜€ï¸'], correct: 0, feedback: 'Yes! yesterday â†’ woke', tip: 'ğŸŒ™ yesterday = hÃ´m qua' },
        { image: 'ğŸš«ğŸ«', text: 'She <span class="highlight-orange">didn\'t go</span> to school <span class="highlight-orange">yesterday</span>.', question: 'Yesterday, she ___ go to school.', choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'], correct: 0, feedback: 'Great! yesterday â†’ didn\'t', tip: 'ğŸš« yesterday â†’ didn\'t' },
        { image: 'â“ğŸ›ï¸', text: '"<span class="highlight-orange">Did she sleep</span> well <span class="highlight-orange">yesterday</span>?"', question: '___ she sleep well yesterday?', choices: ['Did â“', 'Does â“'], correct: 0, feedback: 'Perfect! yesterday â†’ Did', tip: 'â“ yesterday â†’ Did...?' },
        { image: 'ğŸ•ğŸ‘¦', text: 'Tom <span class="highlight-orange">ate</span> pizza <span class="highlight-orange">yesterday</span>.', question: 'Yesterday, Tom ___ pizza.', choices: ['ate ğŸŒ™', 'eats â˜€ï¸'], correct: 0, feedback: 'Wonderful! yesterday â†’ ate', tip: 'ğŸŒ™ yesterday â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ¥—', text: 'He <span class="highlight-orange">didn\'t eat</span> salad <span class="highlight-orange">yesterday</span>.', question: 'Yesterday, he didn\'t ___ salad.', choices: ['eat ğŸš«', 'ate ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + eat (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ®', text: '"<span class="highlight-orange">Did you play</span> games <span class="highlight-orange">yesterday</span>?"', question: 'Did you ___ games yesterday?', choices: ['play â“', 'played â“'], correct: 0, feedback: 'Great! Did + play (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    },
    // ===== LAST NIGHT =====
    {
      bg: 'bg-night',
      scenes: [
        { image: 'ğŸ“ºğŸ‘¨â€ğŸ‘©â€ğŸ‘§', text: 'We <span class="highlight-orange">watched</span> a movie <span class="highlight-orange">last night</span>.', question: 'Last night, we ___ a movie.', choices: ['watched ğŸŒ™', 'watch â˜€ï¸'], correct: 0, feedback: 'Yes! last night â†’ watched', tip: 'ğŸŒ™ last night = tá»‘i qua' },
        { image: 'ğŸš«ğŸ“–', text: 'Lily <span class="highlight-orange">didn\'t read</span> books <span class="highlight-orange">last night</span>.', question: 'Last night, Lily ___ read books.', choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'], correct: 0, feedback: 'Great! last night â†’ didn\'t', tip: 'ğŸš« last night â†’ didn\'t' },
        { image: 'â“ğŸ˜´', text: '"<span class="highlight-orange">Did you sleep</span> early <span class="highlight-orange">last night</span>?"', question: '___ you sleep early last night?', choices: ['Did â“', 'Do â“'], correct: 0, feedback: 'Perfect! last night â†’ Did', tip: 'â“ last night â†’ Did...?' },
        { image: 'ğŸğŸ‘¨', text: 'Dad <span class="highlight-orange">cooked</span> pasta <span class="highlight-orange">last night</span>.', question: 'Last night, Dad ___ pasta.', choices: ['cooked ğŸŒ™', 'cooks â˜€ï¸'], correct: 0, feedback: 'Wonderful! last night â†’ cooked', tip: 'ğŸŒ™ last night â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ°', text: 'We <span class="highlight-orange">didn\'t have</span> dessert <span class="highlight-orange">last night</span>.', question: 'Last night, we didn\'t ___ dessert.', choices: ['have ğŸš«', 'had ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + have (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸµ', text: '"<span class="highlight-orange">Did they listen</span> to music <span class="highlight-orange">last night</span>?"', question: 'Did they ___ to music last night?', choices: ['listen â“', 'listened â“'], correct: 0, feedback: 'Great! Did + listen (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    },
    // ===== LAST WEEK =====
    {
      bg: 'bg-school',
      scenes: [
        { image: 'ğŸ“ğŸ‘§', text: 'Lily <span class="highlight-orange">had</span> a test <span class="highlight-orange">last week</span>.', question: 'Last week, Lily ___ a test.', choices: ['had ğŸŒ™', 'has â˜€ï¸'], correct: 0, feedback: 'Yes! last week â†’ had', tip: 'ğŸŒ™ last week = tuáº§n trÆ°á»›c' },
        { image: 'ğŸš«ğŸ˜°', text: 'She <span class="highlight-orange">didn\'t fail</span> <span class="highlight-orange">last week</span>.', question: 'Last week, she ___ fail.', choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'], correct: 0, feedback: 'Great! last week â†’ didn\'t', tip: 'ğŸš« last week â†’ didn\'t' },
        { image: 'â“ğŸ’¯', text: '"<span class="highlight-orange">Did she get</span> 100 points <span class="highlight-orange">last week</span>?"', question: '___ she get 100 points last week?', choices: ['Did â“', 'Does â“'], correct: 0, feedback: 'Perfect! last week â†’ Did', tip: 'â“ last week â†’ Did...?' },
        { image: 'ğŸ†ğŸ‘¦', text: 'Tom <span class="highlight-orange">won</span> a prize <span class="highlight-orange">last week</span>.', question: 'Last week, Tom ___ a prize.', choices: ['won ğŸŒ™', 'wins â˜€ï¸'], correct: 0, feedback: 'Wonderful! last week â†’ won', tip: 'ğŸŒ™ last week â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ®', text: 'He <span class="highlight-orange">didn\'t play</span> games <span class="highlight-orange">last week</span>.', question: 'Last week, he didn\'t ___ games.', choices: ['play ğŸš«', 'played ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + play (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ“š', text: '"<span class="highlight-orange">Did they study</span> hard <span class="highlight-orange">last week</span>?"', question: 'Did they ___ hard last week?', choices: ['study â“', 'studied â“'], correct: 0, feedback: 'Great! Did + study (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    },
    // ===== LAST MONTH =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸ‚ğŸ‘§', text: 'Lily <span class="highlight-orange">celebrated</span> her birthday <span class="highlight-orange">last month</span>.', question: 'Last month, Lily ___ her birthday.', choices: ['celebrated ğŸŒ™', 'celebrates â˜€ï¸'], correct: 0, feedback: 'Yes! last month â†’ celebrated', tip: 'ğŸŒ™ last month = thÃ¡ng trÆ°á»›c' },
        { image: 'ğŸš«ğŸ', text: 'She <span class="highlight-orange">didn\'t get</span> a bike <span class="highlight-orange">last month</span>.', question: 'Last month, she ___ get a bike.', choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'], correct: 0, feedback: 'Great! last month â†’ didn\'t', tip: 'ğŸš« last month â†’ didn\'t' },
        { image: 'â“ğŸ‰', text: '"<span class="highlight-orange">Did friends come</span> to the party <span class="highlight-orange">last month</span>?"', question: '___ friends come to the party last month?', choices: ['Did â“', 'Do â“'], correct: 0, feedback: 'Perfect! last month â†’ Did', tip: 'â“ last month â†’ Did...?' },
        { image: 'ğŸ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', text: 'We <span class="highlight-orange">moved</span> to a new house <span class="highlight-orange">last month</span>.', question: 'Last month, we ___ to a new house.', choices: ['moved ğŸŒ™', 'move â˜€ï¸'], correct: 0, feedback: 'Wonderful! last month â†’ moved', tip: 'ğŸŒ™ last month â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ•', text: 'We <span class="highlight-orange">didn\'t buy</span> a dog <span class="highlight-orange">last month</span>.', question: 'Last month, we didn\'t ___ a dog.', choices: ['buy ğŸš«', 'bought ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + buy (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸŒ³', text: '"<span class="highlight-orange">Did they plant</span> trees <span class="highlight-orange">last month</span>?"', question: 'Did they ___ trees last month?', choices: ['plant â“', 'planted â“'], correct: 0, feedback: 'Great! Did + plant (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    },
    // ===== LAST YEAR =====
    {
      bg: 'bg-park',
      scenes: [
        { image: 'âœˆï¸ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', text: 'We <span class="highlight-orange">went</span> to Japan <span class="highlight-orange">last year</span>.', question: 'Last year, we ___ to Japan.', choices: ['went ğŸŒ™', 'go â˜€ï¸'], correct: 0, feedback: 'Yes! last year â†’ went', tip: 'ğŸŒ™ last year = nÄƒm ngoÃ¡i' },
        { image: 'ğŸš«ğŸ”ï¸', text: 'We <span class="highlight-orange">didn\'t climb</span> a mountain <span class="highlight-orange">last year</span>.', question: 'Last year, we ___ climb a mountain.', choices: ['didn\'t ğŸš«', 'don\'t ğŸš«'], correct: 0, feedback: 'Great! last year â†’ didn\'t', tip: 'ğŸš« last year â†’ didn\'t' },
        { image: 'â“ğŸŒŠ', text: '"<span class="highlight-orange">Did you swim</span> in the sea <span class="highlight-orange">last year</span>?"', question: '___ you swim in the sea last year?', choices: ['Did â“', 'Do â“'], correct: 0, feedback: 'Perfect! last year â†’ Did', tip: 'â“ last year â†’ Did...?' },
        { image: 'ğŸ“ğŸ‘§', text: 'Lily <span class="highlight-orange">finished</span> grade 2 <span class="highlight-orange">last year</span>.', question: 'Last year, Lily ___ grade 2.', choices: ['finished ğŸŒ™', 'finishes â˜€ï¸'], correct: 0, feedback: 'Wonderful! last year â†’ finished', tip: 'ğŸŒ™ last year â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ†', text: 'Tom <span class="highlight-orange">didn\'t win</span> any prize <span class="highlight-orange">last year</span>.', question: 'Last year, Tom didn\'t ___ any prize.', choices: ['win ğŸš«', 'won ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + win (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ„', text: '"<span class="highlight-orange">Did they visit</span> grandma <span class="highlight-orange">last year</span>?"', question: 'Did they ___ grandma last year?', choices: ['visit â“', 'visited â“'], correct: 0, feedback: 'Great! Did + visit (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    },
    // ===== ...AGO =====
    {
      bg: 'bg-school',
      scenes: [
        { image: 'ğŸ’ğŸ‘§', text: 'Lily <span class="highlight-orange">started</span> school <span class="highlight-orange">2 years ago</span>.', question: '2 years ago, Lily ___ school.', choices: ['started ğŸŒ™', 'starts â˜€ï¸'], correct: 0, feedback: 'Yes! ...ago â†’ started', tip: 'ğŸŒ™ ...ago = cÃ¡ch Ä‘Ã¢y...' },
        { image: 'ğŸš«ğŸ˜¢', text: 'She <span class="highlight-orange">didn\'t cry</span> <span class="highlight-orange">2 years ago</span>.', question: '2 years ago, she ___ cry.', choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'], correct: 0, feedback: 'Great! ...ago â†’ didn\'t', tip: 'ğŸš« ...ago â†’ didn\'t' },
        { image: 'â“ğŸ‘«', text: '"<span class="highlight-orange">Did she make</span> friends <span class="highlight-orange">2 years ago</span>?"', question: '___ she make friends 2 years ago?', choices: ['Did â“', 'Does â“'], correct: 0, feedback: 'Perfect! ...ago â†’ Did', tip: 'â“ ...ago â†’ Did...?' },
        { image: 'ğŸ•ğŸ‘¦', text: 'Tom <span class="highlight-orange">got</span> a dog <span class="highlight-orange">3 months ago</span>.', question: '3 months ago, Tom ___ a dog.', choices: ['got ğŸŒ™', 'gets â˜€ï¸'], correct: 0, feedback: 'Wonderful! ...ago â†’ got', tip: 'ğŸŒ™ ...ago â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ±', text: 'He <span class="highlight-orange">didn\'t get</span> a cat <span class="highlight-orange">3 months ago</span>.', question: '3 months ago, he didn\'t ___ a cat.', choices: ['get ğŸš«', 'got ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + get (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸ ', text: '"<span class="highlight-orange">Did they move</span> <span class="highlight-orange">5 years ago</span>?"', question: 'Did they ___ 5 years ago?', choices: ['move â“', 'moved â“'], correct: 0, feedback: 'Great! Did + move (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    },
    // ===== IN 2023 =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸ‘¶', text: 'My sister <span class="highlight-orange">was born</span> <span class="highlight-orange">in 2020</span>.', question: 'In 2020, my sister ___ born.', choices: ['was ğŸŒ™', 'is â˜€ï¸'], correct: 0, feedback: 'Yes! in 2020 â†’ was', tip: 'ğŸŒ™ in + nÄƒm = quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ«', text: 'I <span class="highlight-orange">didn\'t go</span> to school <span class="highlight-orange">in 2020</span>.', question: 'In 2020, I ___ go to school.', choices: ['didn\'t ğŸš«', 'don\'t ğŸš«'], correct: 0, feedback: 'Great! in 2020 â†’ didn\'t', tip: 'ğŸš« in + nÄƒm â†’ didn\'t' },
        { image: 'â“ğŸ ', text: '"<span class="highlight-orange">Did you stay</span> home <span class="highlight-orange">in 2020</span>?"', question: '___ you stay home in 2020?', choices: ['Did â“', 'Do â“'], correct: 0, feedback: 'Perfect! in 2020 â†’ Did', tip: 'â“ in + nÄƒm â†’ Did...?' },
        { image: 'ğŸ®ğŸ‘¦', text: 'Tom <span class="highlight-orange">got</span> a new game <span class="highlight-orange">in 2023</span>.', question: 'In 2023, Tom ___ a new game.', choices: ['got ğŸŒ™', 'gets â˜€ï¸'], correct: 0, feedback: 'Wonderful! in 2023 â†’ got', tip: 'ğŸŒ™ in + nÄƒm â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ“±', text: 'He <span class="highlight-orange">didn\'t have</span> a phone <span class="highlight-orange">in 2021</span>.', question: 'In 2021, he didn\'t ___ a phone.', choices: ['have ğŸš«', 'had ğŸš«'], correct: 0, feedback: 'Excellent! didn\'t + have (gá»‘c)', tip: 'âš ï¸ didn\'t + Ä‘á»™ng tá»« Gá»C' },
        { image: 'â“ğŸŒ', text: '"<span class="highlight-orange">Did they travel</span> <span class="highlight-orange">in 2022</span>?"', question: 'Did they ___ in 2022?', choices: ['travel â“', 'traveled â“'], correct: 0, feedback: 'Great! Did + travel (gá»‘c)', tip: 'âš ï¸ Did + Ä‘á»™ng tá»« Gá»C' }
      ]
    }
  ],
  stories: [
    // ===== MIX: Every day vs Yesterday =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'â˜€ï¸ğŸ³', text: '<span class="highlight">Every day</span>, Lily <span class="highlight-green">eats</span> breakfast.', question: 'every day â†’ Lily ___ breakfast.', choices: ['eats â˜€ï¸', 'ate ğŸŒ™'], correct: 0, feedback: 'Yes! every day â†’ eats', tip: 'â˜€ï¸ every day â†’ hiá»‡n táº¡i' },
        { image: 'ğŸŒ™ğŸ¥', text: '<span class="highlight-orange">Yesterday</span>, she <span class="highlight-orange">ate</span> pancakes.', question: 'yesterday â†’ she ___ pancakes.', choices: ['ate ğŸŒ™', 'eats â˜€ï¸'], correct: 0, feedback: 'Great! yesterday â†’ ate', tip: 'ğŸŒ™ yesterday â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'She <span class="highlight-green">doesn\'t drink</span> coffee <span class="highlight">every morning</span>.', question: 'every morning â†’ she ___ drink coffee.', choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! every morning â†’ doesn\'t', tip: 'â˜€ï¸ every morning â†’ doesn\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'She <span class="highlight-orange">didn\'t drink</span> milk <span class="highlight-orange">last night</span>.', question: 'last night â†’ she ___ drink milk.', choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! last night â†’ didn\'t', tip: 'ğŸŒ™ last night â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Does</span> she go to school <span class="highlight">every day</span>?"', question: 'every day â†’ ___ she go to school?', choices: ['Does â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! every day â†’ Does', tip: 'â˜€ï¸ every day â†’ Does...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> she go to school <span class="highlight-orange">yesterday</span>?"', question: 'yesterday â†’ ___ she go to school?', choices: ['Did ğŸŒ™', 'Does â˜€ï¸'], correct: 0, feedback: 'Great! yesterday â†’ Did', tip: 'ğŸŒ™ yesterday â†’ Did...?' }
      ]
    },
    // ===== MIX: Always/Usually vs Last week =====
    {
      bg: 'bg-park',
      scenes: [
        { image: 'â˜€ï¸âš½', text: 'Tom <span class="highlight">always</span> <span class="highlight-green">plays</span> football.', question: 'always â†’ Tom ___ football.', choices: ['plays â˜€ï¸', 'played ğŸŒ™'], correct: 0, feedback: 'Yes! always â†’ plays', tip: 'â˜€ï¸ always â†’ hiá»‡n táº¡i' },
        { image: 'ğŸŒ™âš½', text: 'He <span class="highlight-orange">played</span> in a match <span class="highlight-orange">last Saturday</span>.', question: 'last Saturday â†’ he ___ in a match.', choices: ['played ğŸŒ™', 'plays â˜€ï¸'], correct: 0, feedback: 'Great! last Saturday â†’ played', tip: 'ğŸŒ™ last Saturday â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'He <span class="highlight">usually</span> <span class="highlight-green">doesn\'t lose</span>.', question: 'usually â†’ he ___ lose.', choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! usually â†’ doesn\'t', tip: 'â˜€ï¸ usually â†’ doesn\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'But he <span class="highlight-orange">didn\'t win</span> <span class="highlight-orange">last week</span>.', question: 'last week â†’ he ___ win.', choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! last week â†’ didn\'t', tip: 'ğŸŒ™ last week â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Does</span> he <span class="highlight">often</span> score goals?"', question: 'often â†’ ___ he score goals?', choices: ['Does â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! often â†’ Does', tip: 'â˜€ï¸ often â†’ Does...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> he score <span class="highlight-orange">last month</span>?"', question: 'last month â†’ ___ he score?', choices: ['Did ğŸŒ™', 'Does â˜€ï¸'], correct: 0, feedback: 'Great! last month â†’ Did', tip: 'ğŸŒ™ last month â†’ Did...?' }
      ]
    },
    // ===== MIX: Sometimes vs ...ago =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'â˜€ï¸ğŸ®', text: 'Lily <span class="highlight">sometimes</span> <span class="highlight-green">plays</span> video games.', question: 'sometimes â†’ Lily ___ video games.', choices: ['plays â˜€ï¸', 'played ğŸŒ™'], correct: 0, feedback: 'Yes! sometimes â†’ plays', tip: 'â˜€ï¸ sometimes â†’ hiá»‡n táº¡i' },
        { image: 'ğŸŒ™ğŸ®', text: 'She <span class="highlight-orange">played</span> a new game <span class="highlight-orange">2 days ago</span>.', question: '2 days ago â†’ she ___ a new game.', choices: ['played ğŸŒ™', 'plays â˜€ï¸'], correct: 0, feedback: 'Great! ...ago â†’ played', tip: 'ğŸŒ™ ...ago â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'She <span class="highlight">sometimes</span> <span class="highlight-green">doesn\'t do</span> homework on time.', question: 'sometimes â†’ she ___ do homework on time.', choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! sometimes â†’ doesn\'t', tip: 'â˜€ï¸ sometimes â†’ doesn\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'She <span class="highlight-orange">didn\'t finish</span> her project <span class="highlight-orange">a week ago</span>.', question: 'a week ago â†’ she ___ finish her project.', choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! ...ago â†’ didn\'t', tip: 'ğŸŒ™ ...ago â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Does</span> she <span class="highlight">often</span> help Mom?"', question: 'often â†’ ___ she help Mom?', choices: ['Does â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! often â†’ Does', tip: 'â˜€ï¸ often â†’ Does...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> she help <span class="highlight-orange">in 2023</span>?"', question: 'in 2023 â†’ ___ she help?', choices: ['Did ğŸŒ™', 'Does â˜€ï¸'], correct: 0, feedback: 'Great! in 2023 â†’ Did', tip: 'ğŸŒ™ in 2023 â†’ Did...?' }
      ]
    },
    // ===== MIX: Every week vs Last year =====
    {
      bg: 'bg-park',
      scenes: [
        { image: 'â˜€ï¸ğŸŠ', text: 'We <span class="highlight-green">go</span> swimming <span class="highlight">every week</span>.', question: 'every week â†’ we ___ swimming.', choices: ['go â˜€ï¸', 'went ğŸŒ™'], correct: 0, feedback: 'Yes! every week â†’ go', tip: 'â˜€ï¸ every week â†’ hiá»‡n táº¡i' },
        { image: 'ğŸŒ™ğŸŠ', text: 'We <span class="highlight-orange">went</span> to the beach <span class="highlight-orange">last year</span>.', question: 'last year â†’ we ___ to the beach.', choices: ['went ğŸŒ™', 'go â˜€ï¸'], correct: 0, feedback: 'Great! last year â†’ went', tip: 'ğŸŒ™ last year â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'We <span class="highlight-green">don\'t swim</span> in winter <span class="highlight">every year</span>.', question: 'every year â†’ we ___ swim in winter.', choices: ['don\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! every year â†’ don\'t', tip: 'â˜€ï¸ every year â†’ don\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'We <span class="highlight-orange">didn\'t travel</span> <span class="highlight-orange">last summer</span>.', question: 'last summer â†’ we ___ travel.', choices: ['didn\'t ğŸŒ™', 'don\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! last summer â†’ didn\'t', tip: 'ğŸŒ™ last summer â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Do</span> you <span class="highlight">usually</span> go on vacation?"', question: 'usually â†’ ___ you go on vacation?', choices: ['Do â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! usually â†’ Do', tip: 'â˜€ï¸ usually â†’ Do...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> you visit grandma <span class="highlight-orange">last holiday</span>?"', question: 'last holiday â†’ ___ you visit grandma?', choices: ['Did ğŸŒ™', 'Do â˜€ï¸'], correct: 0, feedback: 'Great! last holiday â†’ Did', tip: 'ğŸŒ™ last holiday â†’ Did...?' }
      ]
    },
    // ===== MIX: All signals - Animals =====
    {
      bg: 'bg-park',
      scenes: [
        { image: 'ğŸ•â˜€ï¸', text: 'Dogs <span class="highlight">always</span> <span class="highlight-green">love</span> bones.', question: 'always â†’ dogs ___ bones.', choices: ['love â˜€ï¸', 'loved ğŸŒ™'], correct: 0, feedback: 'Yes! always â†’ love', tip: 'â˜€ï¸ always â†’ hiá»‡n táº¡i' },
        { image: 'ğŸ•ğŸŒ™', text: 'My dog <span class="highlight-orange">ate</span> a big bone <span class="highlight-orange">yesterday</span>.', question: 'yesterday â†’ my dog ___ a big bone.', choices: ['ate ğŸŒ™', 'eats â˜€ï¸'], correct: 0, feedback: 'Great! yesterday â†’ ate', tip: 'ğŸŒ™ yesterday â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«ğŸ±â˜€ï¸', text: 'Cats <span class="highlight-green">don\'t like</span> water.', question: 'Cats ___ like water. (fact)', choices: ['don\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! Fact â†’ don\'t', tip: 'â˜€ï¸ Sá»± tháº­t â†’ don\'t' },
        { image: 'ğŸš«ğŸ±ğŸŒ™', text: 'My cat <span class="highlight-orange">didn\'t eat</span> fish <span class="highlight-orange">last night</span>.', question: 'last night â†’ my cat ___ eat fish.', choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! last night â†’ didn\'t', tip: 'ğŸŒ™ last night â†’ didn\'t' },
        { image: 'â“ğŸ¦â˜€ï¸', text: '"<span class="highlight-green">Do</span> birds <span class="highlight">usually</span> fly south in winter?"', question: 'usually â†’ ___ birds fly south?', choices: ['Do â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! usually â†’ Do', tip: 'â˜€ï¸ usually â†’ Do...?' },
        { image: 'â“ğŸ¦ğŸŒ™', text: '"<span class="highlight-orange">Did</span> you see birds <span class="highlight-orange">3 days ago</span>?"', question: '3 days ago â†’ ___ you see birds?', choices: ['Did ğŸŒ™', 'Do â˜€ï¸'], correct: 0, feedback: 'Great! ...ago â†’ Did', tip: 'ğŸŒ™ ...ago â†’ Did...?' }
      ]
    },
    // ===== MIX: All signals - School =====
    {
      bg: 'bg-school',
      scenes: [
        { image: 'ğŸ«â˜€ï¸', text: 'We <span class="highlight-green">go</span> to school <span class="highlight">every day</span>.', question: 'every day â†’ we ___ to school.', choices: ['go â˜€ï¸', 'went ğŸŒ™'], correct: 0, feedback: 'Yes! every day â†’ go', tip: 'â˜€ï¸ every day â†’ hiá»‡n táº¡i' },
        { image: 'ğŸ«ğŸŒ™', text: 'We <span class="highlight-orange">had</span> a field trip <span class="highlight-orange">last Friday</span>.', question: 'last Friday â†’ we ___ a field trip.', choices: ['had ğŸŒ™', 'have â˜€ï¸'], correct: 0, feedback: 'Great! last Friday â†’ had', tip: 'ğŸŒ™ last Friday â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'We <span class="highlight-green">don\'t have</span> school on Sunday.', question: 'We ___ have school on Sunday.', choices: ['don\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! Fact â†’ don\'t', tip: 'â˜€ï¸ Quy táº¯c â†’ don\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'We <span class="highlight-orange">didn\'t have</span> homework <span class="highlight-orange">yesterday</span>.', question: 'yesterday â†’ we ___ have homework.', choices: ['didn\'t ğŸŒ™', 'don\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! yesterday â†’ didn\'t', tip: 'ğŸŒ™ yesterday â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Does</span> the teacher <span class="highlight">always</span> give tests?"', question: 'always â†’ ___ the teacher give tests?', choices: ['Does â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! always â†’ Does', tip: 'â˜€ï¸ always â†’ Does...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> you pass the test <span class="highlight-orange">last month</span>?"', question: 'last month â†’ ___ you pass the test?', choices: ['Did ğŸŒ™', 'Does â˜€ï¸'], correct: 0, feedback: 'Great! last month â†’ Did', tip: 'ğŸŒ™ last month â†’ Did...?' }
      ]
    },
    // ===== MIX: All signals - Food =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸâ˜€ï¸', text: 'I <span class="highlight">usually</span> <span class="highlight-green">eat</span> fruit for breakfast.', question: 'usually â†’ I ___ fruit for breakfast.', choices: ['eat â˜€ï¸', 'ate ğŸŒ™'], correct: 0, feedback: 'Yes! usually â†’ eat', tip: 'â˜€ï¸ usually â†’ hiá»‡n táº¡i' },
        { image: 'ğŸ•ğŸŒ™', text: 'I <span class="highlight-orange">ate</span> pizza <span class="highlight-orange">last weekend</span>.', question: 'last weekend â†’ I ___ pizza.', choices: ['ate ğŸŒ™', 'eat â˜€ï¸'], correct: 0, feedback: 'Great! last weekend â†’ ate', tip: 'ğŸŒ™ last weekend â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'I <span class="highlight-green">don\'t eat</span> spicy food <span class="highlight">every day</span>.', question: 'every day â†’ I ___ eat spicy food.', choices: ['don\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! every day â†’ don\'t', tip: 'â˜€ï¸ every day â†’ don\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'I <span class="highlight-orange">didn\'t eat</span> breakfast <span class="highlight-orange">yesterday</span>.', question: 'yesterday â†’ I ___ eat breakfast.', choices: ['didn\'t ğŸŒ™', 'don\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! yesterday â†’ didn\'t', tip: 'ğŸŒ™ yesterday â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Do</span> you <span class="highlight">sometimes</span> eat ice cream?"', question: 'sometimes â†’ ___ you eat ice cream?', choices: ['Do â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! sometimes â†’ Do', tip: 'â˜€ï¸ sometimes â†’ Do...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> you try the new restaurant <span class="highlight-orange">2 weeks ago</span>?"', question: '2 weeks ago â†’ ___ you try the new restaurant?', choices: ['Did ğŸŒ™', 'Do â˜€ï¸'], correct: 0, feedback: 'Great! ...ago â†’ Did', tip: 'ğŸŒ™ ...ago â†’ Did...?' }
      ]
    },
    // ===== MIX: All signals - Family =====
    {
      bg: 'bg-home',
      scenes: [
        { image: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â˜€ï¸', text: 'My family <span class="highlight">often</span> <span class="highlight-green">eats</span> dinner together.', question: 'often â†’ my family ___ dinner together.', choices: ['eats â˜€ï¸', 'ate ğŸŒ™'], correct: 0, feedback: 'Yes! often â†’ eats', tip: 'â˜€ï¸ often â†’ hiá»‡n táº¡i' },
        { image: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ğŸŒ™', text: 'We <span class="highlight-orange">went</span> to a restaurant <span class="highlight-orange">last Sunday</span>.', question: 'last Sunday â†’ we ___ to a restaurant.', choices: ['went ğŸŒ™', 'go â˜€ï¸'], correct: 0, feedback: 'Great! last Sunday â†’ went', tip: 'ğŸŒ™ last Sunday â†’ quÃ¡ khá»©' },
        { image: 'ğŸš«â˜€ï¸', text: 'Dad <span class="highlight-green">doesn\'t work</span> on weekends.', question: 'Dad ___ work on weekends.', choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'], correct: 0, feedback: 'Perfect! Fact â†’ doesn\'t', tip: 'â˜€ï¸ Quy táº¯c â†’ doesn\'t' },
        { image: 'ğŸš«ğŸŒ™', text: 'Mom <span class="highlight-orange">didn\'t cook</span> <span class="highlight-orange">last night</span>.', question: 'last night â†’ Mom ___ cook.', choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'], correct: 0, feedback: 'Wonderful! last night â†’ didn\'t', tip: 'ğŸŒ™ last night â†’ didn\'t' },
        { image: 'â“â˜€ï¸', text: '"<span class="highlight-green">Does</span> your sister <span class="highlight">always</span> help with chores?"', question: 'always â†’ ___ your sister help with chores?', choices: ['Does â˜€ï¸', 'Did ğŸŒ™'], correct: 0, feedback: 'Excellent! always â†’ Does', tip: 'â˜€ï¸ always â†’ Does...?' },
        { image: 'â“ğŸŒ™', text: '"<span class="highlight-orange">Did</span> grandma visit <span class="highlight-orange">last month</span>?"', question: 'last month â†’ ___ grandma visit?', choices: ['Did ğŸŒ™', 'Does â˜€ï¸'], correct: 0, feedback: 'Great! last month â†’ Did', tip: 'ğŸŒ™ last month â†’ Did...?' }
      ]
    }
  ]
};
var WORD_GAMES = {
  matching: [
    { now: 'go', past: 'went', meaning: 'Ä‘i' },
    { now: 'eat', past: 'ate', meaning: 'Äƒn' },
    { now: 'see', past: 'saw', meaning: 'tháº¥y' },
    { now: 'have', past: 'had', meaning: 'cÃ³' },
    { now: 'make', past: 'made', meaning: 'lÃ m' },
    { now: 'come', past: 'came', meaning: 'Ä‘áº¿n' },
    { now: 'take', past: 'took', meaning: 'láº¥y' },
    { now: 'give', past: 'gave', meaning: 'cho' },
    { now: 'run', past: 'ran', meaning: 'cháº¡y' },
    { now: 'swim', past: 'swam', meaning: 'bÆ¡i' },
    { now: 'drink', past: 'drank', meaning: 'uá»‘ng' },
    { now: 'sing', past: 'sang', meaning: 'hÃ¡t' },
    { now: 'sleep', past: 'slept', meaning: 'ngá»§' },
    { now: 'write', past: 'wrote', meaning: 'viáº¿t' },
    { now: 'read', past: 'read', meaning: 'Ä‘á»c' },
    { now: 'buy', past: 'bought', meaning: 'mua' },
    { now: 'get', past: 'got', meaning: 'Ä‘Æ°á»£c' },
    { now: 'sit', past: 'sat', meaning: 'ngá»“i' },
    { now: 'stand', past: 'stood', meaning: 'Ä‘á»©ng' },
    { now: 'fly', past: 'flew', meaning: 'bay' },
    { now: 'do', past: 'did', meaning: 'lÃ m' },
    { now: 'say', past: 'said', meaning: 'nÃ³i' },
    { now: 'tell', past: 'told', meaning: 'ká»ƒ' },
    { now: 'think', past: 'thought', meaning: 'nghÄ©' },
    { now: 'know', past: 'knew', meaning: 'biáº¿t' },
    { now: 'put', past: 'put', meaning: 'Ä‘áº·t' },
    { now: 'cut', past: 'cut', meaning: 'cáº¯t' },
    { now: 'draw', past: 'drew', meaning: 'váº½' },
    { now: 'grow', past: 'grew', meaning: 'lá»›n lÃªn' },
    { now: 'throw', past: 'threw', meaning: 'nÃ©m' },
    { now: 'catch', past: 'caught', meaning: 'báº¯t' },
    { now: 'teach', past: 'taught', meaning: 'dáº¡y' },
    { now: 'bring', past: 'brought', meaning: 'mang' },
    { now: 'find', past: 'found', meaning: 'tÃ¬m tháº¥y' },
    { now: 'feel', past: 'felt', meaning: 'cáº£m tháº¥y' },
    { now: 'leave', past: 'left', meaning: 'rá»i Ä‘i' },
    { now: 'meet', past: 'met', meaning: 'gáº·p' },
    { now: 'send', past: 'sent', meaning: 'gá»­i' },
    { now: 'build', past: 'built', meaning: 'xÃ¢y' },
    { now: 'wear', past: 'wore', meaning: 'máº·c' }
  ]
};

// ============ STATE ============
var soundEnabled = true;
var currentTopic = '';
var currentStory = 0;
var currentScene = 0;
var stars = 0;
var totalQuestions = 0;
var correctAnswers = 0;
var questionsPerRound = 6; // Sá»‘ cÃ¢u má»—i lÆ°á»£t
var allQuestions = []; // Máº£ng chá»©a cÃ¢u há»i Ä‘Ã£ trá»™n
var currentQuestionIndex = 0;

// Matching game state
var matchCards = [];
var selectedCard = null;
var matchedPairs = [];

// Flashcard state
var flashcardIndex = 0;
var isFlipped = false;

// ============ LEVEL SELECT ============
function showLevelSelect(topic) {
  playSound('click');
  currentTopic = topic;
  
  var topicName = topic === 'daily' ? 'â˜€ï¸ Every Day' : 
                  topic === 'yesterday' ? 'ğŸŒ™ Yesterday' : 'ğŸ“– Mix Stories';
  
  var html = '<div class="level-content">' +
    '<button class="back-btn" onclick="goHome()" style="position:absolute;top:20px;left:20px">â† Home</button>' +
    '<div style="font-size:60px;margin-bottom:15px">' + 
    (topic === 'daily' ? 'â˜€ï¸' : topic === 'yesterday' ? 'ğŸŒ™' : 'ğŸ“–') + '</div>' +
    '<div class="level-title">' + topicName + '</div>' +
    '<div class="level-subtitle">Chá»n sá»‘ cÃ¢u há»i con muá»‘n lÃ m:</div>' +
    
    '<div class="level-cards">' +
    '<div class="level-card easy" onclick="startWithLevel(5)">' +
    '<div class="level-icon">ğŸŒ±</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Nhanh</div>' +
    '<div class="level-desc">Luyá»‡n táº­p nháº¹ nhÃ ng</div>' +
    '</div>' +
    '<div class="level-time">5 cÃ¢u â€¢ 3 phÃºt</div>' +
    '</div>' +
    
    '<div class="level-card medium" onclick="startWithLevel(8)">' +
    '<div class="level-icon">ğŸŒ¿</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Vá»«a pháº£i</div>' +
    '<div class="level-desc">Ã”n táº­p cÆ¡ báº£n</div>' +
    '</div>' +
    '<div class="level-time">8 cÃ¢u â€¢ 5 phÃºt</div>' +
    '</div>' +
    
    '<div class="level-card hard" onclick="startWithLevel(10)">' +
    '<div class="level-icon">ğŸŒ³</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Thá»­ thÃ¡ch</div>' +
    '<div class="level-desc">Kiá»ƒm tra kiáº¿n thá»©c</div>' +
    '</div>' +
    '<div class="level-time">10 cÃ¢u â€¢ 8 phÃºt</div>' +
    '</div>' +
    
    '<div class="level-card" onclick="startWithLevel(15)" style="border-color:#9C27B0">' +
    '<div class="level-icon">ğŸ†</div>' +
    '<div class="level-info">' +
    '<div class="level-name" style="color:#7B1FA2">SiÃªu sao</div>' +
    '<div class="level-desc">DÃ nh cho cao thá»§!</div>' +
    '</div>' +
    '<div class="level-time">15 cÃ¢u â€¢ 12 phÃºt</div>' +
    '</div>' +
    '</div></div>';
  
  document.getElementById('levelScreen').innerHTML = html;
  showScreen('levelScreen');
}

function startWithLevel(numQuestions) {
  playSound('click');
  questionsPerRound = numQuestions;
  
  // Thu tháº­p táº¥t cáº£ cÃ¢u há»i tá»« topic
  allQuestions = [];
  var stories = STORIES[currentTopic];
  
  stories.forEach(function(story) {
    story.scenes.forEach(function(scene) {
      allQuestions.push({
        bg: story.bg,
        image: scene.image,
        text: scene.text,
        question: scene.question,
        choices: scene.choices,
        correct: scene.correct,
        feedback: scene.feedback,
        tip: scene.tip
      });
    });
  });
  
  // Trá»™n ngáº«u nhiÃªn vÃ  láº¥y sá»‘ cÃ¢u cáº§n thiáº¿t
  allQuestions = shuffle(allQuestions).slice(0, questionsPerRound);
  
  // Reset state
  currentQuestionIndex = 0;
  stars = 0;
  correctAnswers = 0;
  totalQuestions = questionsPerRound;
  
  // Báº¯t Ä‘áº§u hiá»ƒn thá»‹ cÃ¢u há»i
  showQuestion();
}

function showQuestion() {
  if (currentQuestionIndex >= allQuestions.length) {
    showResult();
    return;
  }
  
  var q = allQuestions[currentQuestionIndex];
  document.getElementById('appContainer').className = 'app-container ' + q.bg;
  
  var dotsHtml = '';
  for (var i = 0; i < totalQuestions; i++) {
    var dotClass = 'dot';
    if (i < currentQuestionIndex) dotClass += ' done';
    else if (i === currentQuestionIndex) dotClass += ' active';
    dotsHtml += '<div class="' + dotClass + '"></div>';
  }
  
  var html = '<div class="progress-header">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div class="progress-dots">' + dotsHtml + '</div>' +
    '<div class="star-count">â­ ' + stars + '</div>' +
    '</div>' +
    '<div class="story-scene">' +
    '<div class="scene-image">' + q.image + '</div>' +
    '<div class="scene-text">' + q.text + '</div>' +
    '<div class="scene-question">' + q.question + '</div>' +
    '<div class="choice-buttons">';
  
  q.choices.forEach(function(choice, i) {
    html += '<button class="choice-btn" id="choice' + i + '" onclick="checkQuestionAnswer(' + i + ')">' + choice + '</button>';
  });
  
  html += '</div><div id="feedbackArea"></div></div>';
  
  document.getElementById('storyScreen').innerHTML = html;
  showScreen('storyScreen');
}

function checkQuestionAnswer(index) {
  var q = allQuestions[currentQuestionIndex];
  var correct = index === q.correct;
  
  // Disable all buttons
  document.querySelectorAll('.choice-btn').forEach(function(btn, i) {
    btn.disabled = true;
    if (i === q.correct) btn.classList.add('correct');
    if (i === index && !correct) btn.classList.add('wrong');
  });
  
  if (correct) {
    stars++;
    correctAnswers++;
    playSound('correct');
    if (stars % 3 === 0) showConfetti();
  } else {
    playSound('wrong');
  }
  
  var feedbackHtml = '<div class="feedback-box ' + (correct ? 'correct' : 'wrong') + '">' +
    '<div class="feedback-emoji">' + (correct ? 'ğŸ‰' : 'ğŸ’ª') + '</div>' +
    '<div class="feedback-text">' + q.feedback + '</div>' +
    '<div class="feedback-tip">' + q.tip + '</div>' +
    '<button class="next-btn" onclick="nextQuestion()">' +
    (currentQuestionIndex < totalQuestions - 1 ? 'Tiáº¿p theo â†’' : 'Xem káº¿t quáº£ ğŸ†') +
    '</button></div>';
  
  document.getElementById('feedbackArea').innerHTML = feedbackHtml;
}

function nextQuestion() {
  currentQuestionIndex++;
  showQuestion();
}

// ============ SOUND ============
function playSound(type) {
  if (!soundEnabled) return;
  try {
    var ctx = new (window.AudioContext || window.webkitAudioContext)();
    var osc = ctx.createOscillator();
    var gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    
    if (type === 'correct') {
      osc.frequency.setValueAtTime(523, ctx.currentTime);
      osc.frequency.setValueAtTime(659, ctx.currentTime + 0.1);
      osc.frequency.setValueAtTime(784, ctx.currentTime + 0.2);
      gain.gain.setValueAtTime(0.3, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.4);
    } else if (type === 'wrong') {
      osc.frequency.setValueAtTime(330, ctx.currentTime);
      osc.frequency.setValueAtTime(294, ctx.currentTime + 0.15);
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.3);
    } else if (type === 'click') {
      osc.frequency.setValueAtTime(800, ctx.currentTime);
      gain.gain.setValueAtTime(0.1, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.05);
    } else if (type === 'complete') {
      [523, 659, 784, 1047].forEach(function(freq, i) {
        var o = ctx.createOscillator();
        var g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
        g.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.2);
        o.start(ctx.currentTime + i * 0.15);
        o.stop(ctx.currentTime + i * 0.15 + 0.2);
      });
    } else if (type === 'flip') {
      osc.frequency.setValueAtTime(600, ctx.currentTime);
      osc.frequency.setValueAtTime(900, ctx.currentTime + 0.05);
      gain.gain.setValueAtTime(0.15, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.1);
    }
  } catch(e) {}
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
}

// ============ CONFETTI ============
function showConfetti() {
  var container = document.getElementById('confettiContainer');
  container.innerHTML = '';
  var colors = ['#FFD700','#FF6B6B','#4CAF50','#2196F3','#E91E63'];
  for (var i = 0; i < 30; i++) {
    var c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + '%';
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    c.style.animationDelay = Math.random() * 0.5 + 's';
    container.appendChild(c);
  }
  setTimeout(function() { container.innerHTML = ''; }, 3000);
}

// ============ NAVIGATION ============
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(function(s) {
    s.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}

function goHome() {
  document.getElementById('appContainer').className = 'app-container bg-fun';
  showScreen('homeScreen');
}

// ============ SHUFFLE ============
function shuffle(arr) {
  var a = arr.slice();
  for (var i = a.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var t = a[i]; a[i] = a[j]; a[j] = t;
  }
  return a;
}

// ============ LEARN SCREEN ============
function showLearnScreen() {
  playSound('click');
  document.getElementById('appContainer').className = 'app-container bg-sunny';
  
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div style="color:white;font-weight:700;font-size:1.2rem">ğŸ“š Há»c kiáº¿n thá»©c</div>' +
    '<div></div></div>' +
    
    // === Dáº¤U HIá»†U NHáº¬N BIáº¾T ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">ğŸ”</span> Dáº¥u hiá»‡u nháº­n biáº¿t</div>' +
    '<div class="compare-box">' +
    '<div class="compare-side now">' +
    '<div class="label">â˜€ï¸ HIá»†N Táº I</div>' +
    '<div class="time-words">' +
    '<span class="time-word">every day</span>' +
    '<span class="time-word">every morning</span>' +
    '<span class="time-word">every night</span>' +
    '<span class="time-word">every week</span>' +
    '<span class="time-word">always</span>' +
    '<span class="time-word">usually</span>' +
    '<span class="time-word">often</span>' +
    '<span class="time-word">sometimes</span>' +
    '</div>' +
    '</div>' +
    '<div class="compare-side past">' +
    '<div class="label">ğŸŒ™ QUÃ KHá»¨</div>' +
    '<div class="time-words">' +
    '<span class="time-word">yesterday</span>' +
    '<span class="time-word">last night</span>' +
    '<span class="time-word">last week</span>' +
    '<span class="time-word">last month</span>' +
    '<span class="time-word">last year</span>' +
    '<span class="time-word">...ago</span>' +
    '<span class="time-word">in 2023</span>' +
    '</div>' +
    '</div></div>' +
    '<div class="tip-bubble"><span class="bulb">ğŸ’¡</span>' +
    '<span class="tip-text"><strong>Máº¹o nhá»›:</strong><br>' +
    'ğŸ‘‰ Tháº¥y <strong>"every"</strong> â†’ Hiá»‡n táº¡i<br>' +
    'ğŸ‘‰ Tháº¥y <strong>"yesterday/last/ago"</strong> â†’ QuÃ¡ khá»©</span></div>' +
    '</div>' +
    
    // === CÃ‚U KHáº²NG Äá»ŠNH ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">âœ…</span> CÃ¢u kháº³ng Ä‘á»‹nh</div>' +
    '<div style="background:#E8F5E9;padding:15px;border-radius:12px;margin-bottom:15px">' +
    '<div style="font-weight:700;color:#2E7D32;margin-bottom:10px">â˜€ï¸ Hiá»‡n táº¡i:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <strong>goes</strong> to school every day.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <strong>plays</strong> football every weekend.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <strong>eat</strong> breakfast every morning.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px;font-size:0.9rem">' +
    'âš ï¸ <strong>He/She/It</strong> â†’ thÃªm <strong>s/es</strong> (goes, plays, watches)' +
    '</div></div>' +
    '<div style="background:#FFF3E0;padding:15px;border-radius:12px">' +
    '<div style="font-weight:700;color:#E65100;margin-bottom:10px">ğŸŒ™ QuÃ¡ khá»©:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <span class="past">went</span> to school yesterday.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <span class="past">played</span> football last week.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <span class="past">ate</span> pizza last night.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px;font-size:0.9rem">' +
    'âš ï¸ Äá»™ng tá»« Ä‘á»•i sang dáº¡ng quÃ¡ khá»© (went, played, ate...)' +
    '</div></div>' +
    '</div>' +
    
    // === CÃ‚U PHá»¦ Äá»ŠNH ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">ğŸš«</span> CÃ¢u phá»§ Ä‘á»‹nh (KhÃ´ng lÃ m gÃ¬)</div>' +
    '<div style="background:#E8F5E9;padding:15px;border-radius:12px;margin-bottom:15px">' +
    '<div style="font-weight:700;color:#2E7D32;margin-bottom:10px">â˜€ï¸ Hiá»‡n táº¡i:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <strong>doesn\'t go</strong> to school on Sunday.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <strong>doesn\'t like</strong> vegetables.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <strong>don\'t eat</strong> meat.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem;margin-bottom:5px">ğŸ“Œ <strong>I/You/We/They</strong> â†’ <span style="background:#FFCDD2;padding:2px 6px;border-radius:4px">don\'t</span> + Ä‘á»™ng tá»« gá»‘c</div>' +
    '<div style="font-size:0.9rem">ğŸ“Œ <strong>He/She/It</strong> â†’ <span style="background:#FFCDD2;padding:2px 6px;border-radius:4px">doesn\'t</span> + Ä‘á»™ng tá»« gá»‘c</div>' +
    '</div></div>' +
    '<div style="background:#FFF3E0;padding:15px;border-radius:12px">' +
    '<div style="font-weight:700;color:#E65100;margin-bottom:10px">ğŸŒ™ QuÃ¡ khá»©:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <span class="past">didn\'t go</span> to school yesterday.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <span class="past">didn\'t watch</span> TV last night.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <span class="past">didn\'t play</span> games yesterday.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem">ğŸ“Œ <strong>Táº¥t cáº£</strong> â†’ <span style="background:#FFCC80;padding:2px 6px;border-radius:4px">didn\'t</span> + Ä‘á»™ng tá»« <strong>Gá»C</strong></div>' +
    '</div></div>' +
    '<div class="tip-bubble" style="background:#FFEBEE"><span class="bulb">âš ï¸</span>' +
    '<span class="tip-text"><strong>Quan trá»ng:</strong> Sau don\'t / doesn\'t / didn\'t â†’ Ä‘á»™ng tá»« giá»¯ nguyÃªn dáº¡ng Gá»C!<br>' +
    'âŒ She doesn\'t <s>goes</s> â†’ âœ… She doesn\'t <strong>go</strong><br>' +
    'âŒ He didn\'t <s>went</s> â†’ âœ… He didn\'t <strong>go</strong></span></div>' +
    '</div>' +
    
    // === CÃ‚U Há»I ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">â“</span> CÃ¢u há»i (CÃ³ lÃ m khÃ´ng?)</div>' +
    '<div style="background:#E8F5E9;padding:15px;border-radius:12px;margin-bottom:15px">' +
    '<div style="font-weight:700;color:#2E7D32;margin-bottom:10px">â˜€ï¸ Hiá»‡n táº¡i:</div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><strong>Do you</strong> like pizza? - Yes, I do!</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><strong>Does she</strong> go to school? - Yes, she does!</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><strong>Do they</strong> play games? - No, they don\'t.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem;margin-bottom:5px">ğŸ“Œ <span style="background:#BBDEFB;padding:2px 6px;border-radius:4px">Do</span> + I/you/we/they + Ä‘á»™ng tá»« gá»‘c?</div>' +
    '<div style="font-size:0.9rem">ğŸ“Œ <span style="background:#BBDEFB;padding:2px 6px;border-radius:4px">Does</span> + he/she/it + Ä‘á»™ng tá»« gá»‘c?</div>' +
    '</div></div>' +
    '<div style="background:#FFF3E0;padding:15px;border-radius:12px">' +
    '<div style="font-weight:700;color:#E65100;margin-bottom:10px">ğŸŒ™ QuÃ¡ khá»©:</div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><span class="past">Did you</span> go to school yesterday? - Yes, I did!</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><span class="past">Did she</span> eat pizza? - No, she didn\'t.</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><span class="past">Did they</span> watch TV? - Yes, they did!</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem">ğŸ“Œ <span style="background:#FFCC80;padding:2px 6px;border-radius:4px">Did</span> + táº¥t cáº£ + Ä‘á»™ng tá»« <strong>Gá»C</strong>?</div>' +
    '</div></div>' +
    '<div class="tip-bubble" style="background:#E3F2FD"><span class="bulb">âš ï¸</span>' +
    '<span class="tip-text"><strong>Quan trá»ng:</strong> Sau Do / Does / Did â†’ Ä‘á»™ng tá»« giá»¯ nguyÃªn dáº¡ng Gá»C!<br>' +
    'âŒ Does she <s>goes</s>? â†’ âœ… Does she <strong>go</strong>?<br>' +
    'âŒ Did you <s>went</s>? â†’ âœ… Did you <strong>go</strong>?</span></div>' +
    '</div>' +
    
    // === Báº¢NG TÃ“M Táº®T ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">ğŸ“‹</span> Báº£ng tÃ³m táº¯t</div>' +
    '<table style="width:100%;border-collapse:collapse;font-size:0.9rem">' +
    '<tr style="background:#E3F2FD"><th style="padding:10px;border:1px solid #ddd"></th><th style="padding:10px;border:1px solid #ddd">â˜€ï¸ Hiá»‡n táº¡i</th><th style="padding:10px;border:1px solid #ddd">ğŸŒ™ QuÃ¡ khá»©</th></tr>' +
    '<tr><td style="padding:10px;border:1px solid #ddd;font-weight:700">Dáº¥u hiá»‡u</td><td style="padding:10px;border:1px solid #ddd">every day, always</td><td style="padding:10px;border:1px solid #ddd">yesterday, last...</td></tr>' +
    '<tr style="background:#E8F5E9"><td style="padding:10px;border:1px solid #ddd;font-weight:700">âœ… She</td><td style="padding:10px;border:1px solid #ddd">She <strong>goes</strong></td><td style="padding:10px;border:1px solid #ddd">She <strong>went</strong></td></tr>' +
    '<tr style="background:#FFEBEE"><td style="padding:10px;border:1px solid #ddd;font-weight:700">ğŸš« She</td><td style="padding:10px;border:1px solid #ddd">She <strong>doesn\'t go</strong></td><td style="padding:10px;border:1px solid #ddd">She <strong>didn\'t go</strong></td></tr>' +
    '<tr style="background:#E3F2FD"><td style="padding:10px;border:1px solid #ddd;font-weight:700">â“ She</td><td style="padding:10px;border:1px solid #ddd"><strong>Does</strong> she <strong>go</strong>?</td><td style="padding:10px;border:1px solid #ddd"><strong>Did</strong> she <strong>go</strong>?</td></tr>' +
    '<tr style="background:#E8F5E9"><td style="padding:10px;border:1px solid #ddd;font-weight:700">âœ… They</td><td style="padding:10px;border:1px solid #ddd">They <strong>go</strong></td><td style="padding:10px;border:1px solid #ddd">They <strong>went</strong></td></tr>' +
    '<tr style="background:#FFEBEE"><td style="padding:10px;border:1px solid #ddd;font-weight:700">ğŸš« They</td><td style="padding:10px;border:1px solid #ddd">They <strong>don\'t go</strong></td><td style="padding:10px;border:1px solid #ddd">They <strong>didn\'t go</strong></td></tr>' +
    '<tr style="background:#E3F2FD"><td style="padding:10px;border:1px solid #ddd;font-weight:700">â“ They</td><td style="padding:10px;border:1px solid #ddd"><strong>Do</strong> they <strong>go</strong>?</td><td style="padding:10px;border:1px solid #ddd"><strong>Did</strong> they <strong>go</strong>?</td></tr>' +
    '</table>' +
    '</div>' +
    
    // === QUY Táº®C VÃ€NG ===
    '<div class="pattern-card" style="background:linear-gradient(135deg,#FFF9C4,#FFECB3)">' +
    '<div class="pattern-title"><span class="icon">â­</span> QUY Táº®C VÃ€NG</div>' +
    '<div style="text-align:center;padding:15px">' +
    '<p style="font-size:1.2rem;font-weight:700;color:#F57F17;margin-bottom:15px">' +
    'Sau <span style="background:#FF8A65;color:white;padding:5px 12px;border-radius:8px">don\'t / doesn\'t / didn\'t</span></p>' +
    '<p style="font-size:1.2rem;font-weight:700;color:#F57F17;margin-bottom:15px">' +
    'Sau <span style="background:#64B5F6;color:white;padding:5px 12px;border-radius:8px">Do / Does / Did</span></p>' +
    '<p style="font-size:1.5rem;font-weight:800;color:#E65100">' +
    'â†’ Äá»™ng tá»« luÃ´n á»Ÿ <span style="background:#FFEB3B;padding:5px 15px;border-radius:8px">Dáº NG Gá»C</span>!</p>' +
    '</div></div>' +
    
    '<button class="next-btn" onclick="goHome()" style="margin-top:20px">ğŸ  Vá» trang chá»§</button>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

// ============ TOPIC START ============
function startTopic(topic) {
  playSound('click');
  currentTopic = topic;
  
  if (topic === 'games') {
    showGameMenu();
  } else if (STORIES[topic]) {
    currentStory = Math.floor(Math.random() * STORIES[topic].length);
    currentScene = 0;
    stars = 0;
    correctAnswers = 0;
    totalQuestions = STORIES[topic][currentStory].scenes.length;
    showStory();
  }
}

// ============ STORY ============
function showStory() {
  var story = STORIES[currentTopic][currentStory];
  var scene = story.scenes[currentScene];
  
  document.getElementById('appContainer').className = 'app-container ' + story.bg;
  
  var dotsHtml = '';
  for (var i = 0; i < story.scenes.length; i++) {
    var dotClass = 'dot';
    if (i < currentScene) dotClass += ' done';
    else if (i === currentScene) dotClass += ' active';
    dotsHtml += '<div class="' + dotClass + '"></div>';
  }
  
  var html = '<div class="progress-header">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div class="progress-dots">' + dotsHtml + '</div>' +
    '<div class="star-count">â­ ' + stars + '</div>' +
    '</div>' +
    '<div class="story-scene">' +
    '<div class="scene-image">' + scene.image + '</div>' +
    '<div class="scene-text">' + scene.text + '</div>' +
    '<div class="scene-question">' + scene.question + '</div>' +
    '<div class="choice-buttons">';
  
  scene.choices.forEach(function(choice, i) {
    html += '<button class="choice-btn" id="choice' + i + '" onclick="checkAnswer(' + i + ')">' + choice + '</button>';
  });
  
  html += '</div><div id="feedbackArea"></div></div>';
  
  document.getElementById('storyScreen').innerHTML = html;
  showScreen('storyScreen');
}

function checkAnswer(index) {
  var story = STORIES[currentTopic][currentStory];
  var scene = story.scenes[currentScene];
  var correct = index === scene.correct;
  
  // Disable all buttons
  document.querySelectorAll('.choice-btn').forEach(function(btn, i) {
    btn.disabled = true;
    if (i === scene.correct) btn.classList.add('correct');
    if (i === index && !correct) btn.classList.add('wrong');
  });
  
  if (correct) {
    stars++;
    correctAnswers++;
    playSound('correct');
    if (stars % 3 === 0) showConfetti();
  } else {
    playSound('wrong');
  }
  
  var feedbackHtml = '<div class="feedback-box ' + (correct ? 'correct' : 'wrong') + '">' +
    '<div class="feedback-emoji">' + (correct ? 'ğŸ‰' : 'ğŸ’ª') + '</div>' +
    '<div class="feedback-text">' + scene.feedback + '</div>' +
    '<div class="feedback-tip">' + scene.tip + '</div>' +
    '<button class="next-btn" onclick="nextScene()">' +
    (currentScene < story.scenes.length - 1 ? 'Next â†’' : 'Finish! ğŸ†') +
    '</button></div>';
  
  document.getElementById('feedbackArea').innerHTML = feedbackHtml;
}

function nextScene() {
  var story = STORIES[currentTopic][currentStory];
  
  if (currentScene < story.scenes.length - 1) {
    currentScene++;
    showStory();
  } else {
    showResult();
  }
}

// ============ RESULT ============
function showResult() {
  playSound('complete');
  showConfetti();
  
  var percentage = Math.round((correctAnswers / totalQuestions) * 100);
  var starCount = Math.min(3, Math.floor(percentage / 33) + (percentage > 0 ? 1 : 0));
  var starsHtml = '';
  for (var i = 0; i < 3; i++) {
    starsHtml += i < starCount ? 'â­' : 'â˜†';
  }
  
  var emoji = percentage >= 80 ? 'ğŸ†' : percentage >= 50 ? 'ğŸŒŸ' : 'ğŸ’ª';
  var title = percentage >= 80 ? 'Xuáº¥t sáº¯c!' : percentage >= 50 ? 'Tá»‘t láº¯m!' : 'Cá»‘ gáº¯ng thÃªm!';
  var message = percentage >= 80 ? 'Con lÃ m giá»i láº¯m! ğŸ‰' : 
                percentage >= 50 ? 'Tiáº¿p tá»¥c phÃ¡t huy nhÃ©! ğŸ‘' : 
                'Luyá»‡n táº­p thÃªm con sáº½ giá»i hÆ¡n! ğŸ’ª';
  
  document.getElementById('appContainer').className = 'app-container bg-fun';
  
  var html = '<div class="result-content"><div class="result-card">' +
    '<div class="result-emoji">' + emoji + '</div>' +
    '<div class="result-title">' + title + '</div>' +
    '<div class="result-stars">' + starsHtml + '</div>' +
    '<div style="background:#f5f5f5;padding:15px;border-radius:12px;margin:15px 0">' +
    '<div style="display:flex;justify-content:space-around;text-align:center">' +
    '<div><div style="font-size:1.5rem;font-weight:700;color:#4CAF50">' + correctAnswers + '</div><div style="font-size:0.85rem;color:#666">ÄÃºng âœ“</div></div>' +
    '<div><div style="font-size:1.5rem;font-weight:700;color:#F44336">' + (totalQuestions - correctAnswers) + '</div><div style="font-size:0.85rem;color:#666">Sai âœ—</div></div>' +
    '<div><div style="font-size:1.5rem;font-weight:700;color:#2196F3">' + percentage + '%</div><div style="font-size:0.85rem;color:#666">Tá»· lá»‡</div></div>' +
    '</div></div>' +
    '<div class="result-message">' + message + '</div>' +
    '<div class="result-buttons">' +
    '<button class="result-btn primary" onclick="showLevelSelect(\'' + currentTopic + '\')">ChÆ¡i láº¡i ğŸ”„</button>' +
    '<button class="result-btn secondary" onclick="goHome()">Vá» nhÃ  ğŸ </button>' +
    '</div></div></div>';
  
  document.getElementById('resultScreen').innerHTML = html;
  showScreen('resultScreen');
}

// ============ GAME MENU ============
function showGameMenu() {
  document.getElementById('appContainer').className = 'app-container bg-fun';
  
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div style="color:white;font-weight:700;font-size:1.2rem">ğŸ® Word Games</div>' +
    '<div></div></div>' +
    
    '<div class="topic-grid">' +
    '<div class="topic-card" onclick="startMatchingGame()" style="border-color:#9C27B0">' +
    '<div class="topic-icon">ğŸ¯</div>' +
    '<div class="topic-name">Matching</div>' +
    '</div>' +
    '<div class="topic-card" onclick="startFlashcards()" style="border-color:#FF9800">' +
    '<div class="topic-icon">ğŸ´</div>' +
    '<div class="topic-name">Flashcards</div>' +
    '</div>' +
    '<div class="topic-card" onclick="showLearnScreen()" style="border-color:#4CAF50">' +
    '<div class="topic-icon">ğŸ“–</div>' +
    '<div class="topic-name">Horrible List</div>' +
    '</div>' +
    '<div class="topic-card" onclick="startVerbMemory()" style="border-color:#2196F3">' +
    '<div class="topic-icon">ğŸ§ </div>' +
    '<div class="topic-name">Memory</div>' +
    '</div>' +
    '</div>' +
    
    // Visual learning section
    '<div class="pattern-card" style="margin-top:20px">' +
    '<div class="pattern-title"><span class="icon">ğŸ’¡</span> Nhá»› nhanh!</div>' +
    '<div class="compare-box">' +
    '<div class="compare-side now">' +
    '<div class="label">â˜€ï¸ Hiá»‡n táº¡i</div>' +
    '<div class="time-words"><span class="time-word">every day</span><span class="time-word">always</span></div>' +
    '<div class="example">I <strong>go</strong> to school.</div>' +
    '</div>' +
    '<div class="compare-side past">' +
    '<div class="label">ğŸŒ™ QuÃ¡ khá»©</div>' +
    '<div class="time-words"><span class="time-word">yesterday</span><span class="time-word">last week</span></div>' +
    '<div class="example">I <strong style="color:#E65100">went</strong> to school.</div>' +
    '</div></div>' +
    '<div class="tip-bubble"><span class="bulb">ğŸ’¡</span>' +
    '<span class="tip-text">Tháº¥y <strong>every</strong> â†’ dÃ¹ng tá»« hiá»‡n táº¡i<br>' +
    'Tháº¥y <strong>yesterday/last</strong> â†’ dÃ¹ng tá»« quÃ¡ khá»©!</span></div>' +
    '</div>';
  
  document.getElementById('gameScreen').innerHTML = html;
  showScreen('gameScreen');
}

// ============ MATCHING GAME ============
function startMatchingGame() {
  playSound('click');
  
  var words = shuffle(WORD_GAMES.matching).slice(0, 6);
  matchCards = [];
  selectedCard = null;
  matchedPairs = [];
  
  words.forEach(function(w, i) {
    matchCards.push({ id: 'now-' + i, text: w.now, type: 'now', pairId: i });
    matchCards.push({ id: 'past-' + i, text: w.past, type: 'past', pairId: i });
  });
  matchCards = shuffle(matchCards);
  
  renderMatchingGame();
}

function renderMatchingGame() {
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="showGameMenu()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ¯ Match the pairs!</div>' +
    '<div></div></div>' +
    
    '<div class="match-instruction">ğŸŸ¢ Chá»n tá»« hiá»‡n táº¡i â†’ ğŸŸ  Chá»n tá»« quÃ¡ khá»© cá»§a nÃ³!</div>' +
    
    '<div class="match-grid">';
  
  matchCards.forEach(function(card) {
    var isSelected = selectedCard && selectedCard.id === card.id;
    var isMatched = matchedPairs.indexOf(card.pairId) >= 0;
    html += '<button class="match-card type-' + card.type + 
      (isSelected ? ' selected' : '') + 
      (isMatched ? ' matched' : '') + '" ' +
      (isMatched ? 'disabled' : 'onclick="selectMatchCard(\'' + card.id + '\')"') + '>' +
      card.text + '</button>';
  });
  
  html += '</div>' +
    '<div class="match-score">âœ… ' + matchedPairs.length + ' / 6</div>';
  
  if (matchedPairs.length >= 6) {
    html += '<div style="text-align:center;margin-top:20px">' +
      '<div style="font-size:50px;margin-bottom:10px">ğŸ‰</div>' +
      '<div style="color:white;font-size:1.3rem;font-weight:700;margin-bottom:15px">Excellent!</div>' +
      '<button class="next-btn" onclick="startMatchingGame()">Play Again ğŸ”„</button></div>';
  }
  
  document.getElementById('gameScreen').innerHTML = html;
  showScreen('gameScreen');
}

function selectMatchCard(cardId) {
  playSound('click');
  
  var card = matchCards.find(function(c) { return c.id === cardId; });
  
  if (!selectedCard) {
    selectedCard = card;
    renderMatchingGame();
  } else {
    if (selectedCard.id === card.id) {
      selectedCard = null;
      renderMatchingGame();
      return;
    }
    
    if (selectedCard.pairId === card.pairId && selectedCard.type !== card.type) {
      matchedPairs.push(card.pairId);
      playSound('correct');
      if (matchedPairs.length >= 6) {
        playSound('complete');
        showConfetti();
      }
    } else {
      playSound('wrong');
    }
    selectedCard = null;
    renderMatchingGame();
  }
}

// ============ FLASHCARDS ============
function startFlashcards() {
  playSound('click');
  flashcardIndex = 0;
  isFlipped = false;
  renderFlashcards();
}

function renderFlashcards() {
  var words = WORD_GAMES.matching;
  var word = words[flashcardIndex];
  
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="showGameMenu()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ´ ' + (flashcardIndex + 1) + ' / ' + words.length + '</div>' +
    '<div></div></div>' +
    
    '<div style="color:white;text-align:center;margin-bottom:8px;font-size:1.1rem">' +
    'ğŸ‘† Cháº¡m tháº» Ä‘á»ƒ láº­t!</div>' +
    
    '<div style="background:rgba(255,255,255,0.2);padding:10px 15px;border-radius:12px;margin-bottom:15px;text-align:center">' +
    '<span style="font-size:1.1rem">ğŸ”Š <strong style="color:#FFEB3B">Äá»c TO</strong> Ä‘á»ƒ nhá»› lÃ¢u nhÃ© con!</span>' +
    '</div>' +
    
    '<div class="flashcard-container">' +
    '<div class="flashcard' + (isFlipped ? ' flipped' : '') + '" onclick="flipCard()">' +
    '<div class="flashcard-face flashcard-front">' +
    '<div class="flashcard-label">â˜€ï¸ Hiá»‡n táº¡i</div>' +
    '<div class="flashcard-word">' + word.now + '</div>' +
    '<div class="flashcard-meaning">(' + word.meaning + ')</div>' +
    '<div class="flashcard-hint" style="margin-top:10px;padding:8px 12px;background:#E8F5E9;border-radius:8px;color:#2E7D32">' +
    'ğŸ—£ï¸ Äá»c to: "<strong>' + word.now + '</strong>"</div>' +
    '</div>' +
    '<div class="flashcard-face flashcard-back">' +
    '<div class="flashcard-label">ğŸŒ™ QuÃ¡ khá»©</div>' +
    '<div class="flashcard-word">' + word.past + '</div>' +
    '<div class="flashcard-meaning">' + word.now + ' â†’ ' + word.past + '</div>' +
    '<div class="flashcard-hint" style="margin-top:10px;padding:8px 12px;background:#FFF3E0;border-radius:8px;color:#E65100">' +
    'ğŸ—£ï¸ Äá»c to: "<strong>' + word.now + '</strong> â†’ <strong>' + word.past + '</strong>"</div>' +
    '</div></div></div>' +
    
    '<div class="flashcard-nav">' +
    '<button class="flashcard-btn" onclick="prevFlashcard()">â† TrÆ°á»›c</button>' +
    '<button class="flashcard-btn" onclick="shuffleFlashcards()">ğŸ”€ Trá»™n</button>' +
    '<button class="flashcard-btn" onclick="nextFlashcard()">Sau â†’</button>' +
    '</div>' +
    
    '<div class="pattern-card" style="margin-top:20px">' +
    '<div style="text-align:center;margin-bottom:10px;color:#666;font-size:0.9rem">ğŸ—£ï¸ Äá»c to cÃ¢u nÃ y nha:</div>' +
    '<div class="example-row">' +
    '<span class="emoji">â˜€ï¸</span>' +
    '<span class="sentence">I <strong>' + word.now + '</strong> every day.</span>' +
    '</div>' +
    '<div class="example-row">' +
    '<span class="emoji">ğŸŒ™</span>' +
    '<span class="sentence">I <span class="past">' + word.past + '</span> yesterday.</span>' +
    '</div></div>';
  
  document.getElementById('gameScreen').innerHTML = html;
  showScreen('gameScreen');
}

function flipCard() {
  playSound('flip');
  isFlipped = !isFlipped;
  renderFlashcards();
}

function prevFlashcard() {
  isFlipped = false;
  flashcardIndex = flashcardIndex > 0 ? flashcardIndex - 1 : WORD_GAMES.matching.length - 1;
  renderFlashcards();
}

function nextFlashcard() {
  isFlipped = false;
  flashcardIndex = flashcardIndex < WORD_GAMES.matching.length - 1 ? flashcardIndex + 1 : 0;
  renderFlashcards();
}

function shuffleFlashcards() {
  WORD_GAMES.matching = shuffle(WORD_GAMES.matching);
  flashcardIndex = 0;
  isFlipped = false;
  renderFlashcards();
}

// ============ IRREGULAR VERBS DATA (tá»« hÃ¬nh áº£nh) ============
var IRREGULAR_VERBS = {
  groups: [
    {
      id: 'important',
      name: '1. Äá»™ng tá»« quan trá»ng',
      pattern: 'IMPORTANT VERBS',
      color: 'pattern-important',
      tip: 'ğŸŒŸ ÄÃ¢y lÃ  nhá»¯ng Ä‘á»™ng tá»« dÃ¹ng NHIá»€U NHáº¤T! Há»c thuá»™c nhÃ³m nÃ y trÆ°á»›c nhÃ©!',
      verbs: [
        { base: 'be', past: 'was/were', pp: 'been', vn: 'thÃ¬, lÃ , á»Ÿ' },
        { base: 'do', past: 'did', pp: 'done', vn: 'lÃ m' },
        { base: 'have', past: 'had', pp: 'had', vn: 'cÃ³' },
        { base: 'come', past: 'came', pp: 'come', vn: 'Ä‘áº¿n' },
        { base: 'get', past: 'got', pp: 'got', vn: 'Ä‘Æ°á»£c, láº¥y' },
        { base: 'go', past: 'went', pp: 'gone', vn: 'Ä‘i' },
        { base: 'make', past: 'made', pp: 'made', vn: 'lÃ m, cháº¿ táº¡o' },
        { base: 'say', past: 'said', pp: 'said', vn: 'nÃ³i' },
        { base: 'tell', past: 'told', pp: 'told', vn: 'ká»ƒ, báº£o' }
      ]
    },
    {
      id: 'perception',
      name: '2. GiÃ¡c quan',
      pattern: 'PERCEPTION VERBS',
      color: 'pattern-perception',
      tip: 'ğŸ‘€ğŸ‘‚ğŸ‘ƒ NhÃ³m nÃ y liÃªn quan Ä‘áº¿n cÃ¡c giÃ¡c quan: nhÃ¬n, nghe, ngá»­i',
      verbs: [
        { base: 'hear', past: 'heard', pp: 'heard', vn: 'nghe' },
        { base: 'see', past: 'saw', pp: 'seen', vn: 'tháº¥y, nhÃ¬n' },
        { base: 'smell', past: 'smelt', pp: 'smelt', vn: 'ngá»­i' }
      ]
    },
    {
      id: 'nochange',
      name: '3. KhÃ´ng Ä‘á»•i',
      pattern: 'NO CHANGE',
      color: 'pattern-no-change',
      tip: 'ğŸ˜ EASY! Cáº£ 3 dáº¡ng giá»‘ng há»‡t nhau - khÃ´ng cáº§n nhá»› gÃ¬ cáº£!',
      verbs: [
        { base: 'cost', past: 'cost', pp: 'cost', vn: 'tá»‘n (tiá»n)' },
        { base: 'cut', past: 'cut', pp: 'cut', vn: 'cáº¯t' },
        { base: 'hit', past: 'hit', pp: 'hit', vn: 'Ä‘Ã¡nh, Ä‘áº­p' },
        { base: 'hurt', past: 'hurt', pp: 'hurt', vn: 'Ä‘au, lÃ m Ä‘au' },
        { base: 'let', past: 'let', pp: 'let', vn: 'Ä‘á»ƒ, cho phÃ©p' },
        { base: 'put', past: 'put', pp: 'put', vn: 'Ä‘áº·t, Ä‘á»ƒ' },
        { base: 'read', past: 'read', pp: 'read', vn: 'Ä‘á»c (phÃ¡t Ã¢m khÃ¡c)' },
        { base: 'shut', past: 'shut', pp: 'shut', vn: 'Ä‘Ã³ng' }
      ]
    },
    {
      id: 'vowel',
      name: '4. I â†’ O â†’ E/EN',
      pattern: 'I - E / O - E / I - EN',
      color: 'pattern-vowel',
      tip: 'ğŸ”¤ Quy luáº­t nguyÃªn Ã¢m: i â†’ o â†’ e/en. VÃ­ dá»¥: drIve â†’ drOve â†’ drivEN',
      verbs: [
        { base: 'bite', past: 'bit', pp: 'bitten', vn: 'cáº¯n' },
        { base: 'break', past: 'broke', pp: 'broken', vn: 'vá»¡, báº» gÃ£y' },
        { base: 'choose', past: 'chose', pp: 'chosen', vn: 'chá»n' },
        { base: 'drive', past: 'drove', pp: 'driven', vn: 'lÃ¡i xe' },
        { base: 'eat', past: 'ate', pp: 'eaten', vn: 'Äƒn' },
        { base: 'fall', past: 'fell', pp: 'fallen', vn: 'ngÃ£, rÆ¡i' },
        { base: 'give', past: 'gave', pp: 'given', vn: 'cho, táº·ng' },
        { base: 'forget', past: 'forgot', pp: 'forgotten', vn: 'quÃªn' },
        { base: 'forgive', past: 'forgave', pp: 'forgiven', vn: 'tha thá»©' },
        { base: 'freeze', past: 'froze', pp: 'frozen', vn: 'Ä‘Ã´ng Ä‘Ã¡' },
        { base: 'hide', past: 'hid', pp: 'hidden', vn: 'giáº¥u, trá»‘n' },
        { base: 'ride', past: 'rode', pp: 'ridden', vn: 'cÆ°á»¡i, Ä‘i (xe)' },
        { base: 'rise', past: 'rose', pp: 'risen', vn: 'má»c, ná»•i lÃªn' },
        { base: 'shake', past: 'shook', pp: 'shaken', vn: 'láº¯c' },
        { base: 'speak', past: 'spoke', pp: 'spoken', vn: 'nÃ³i' },
        { base: 'steal', past: 'stole', pp: 'stolen', vn: 'Äƒn cáº¯p' },
        { base: 'take', past: 'took', pp: 'taken', vn: 'láº¥y, mang' },
        { base: 'wake', past: 'woke', pp: 'woken', vn: 'thá»©c dáº­y' },
        { base: 'write', past: 'wrote', pp: 'written', vn: 'viáº¿t' }
      ]
    },
    {
      id: 'drink',
      name: '5. I â†’ U*-A â†’ U',
      pattern: 'I / U* - A / U',
      color: 'pattern-drink',
      tip: 'ğŸµ Nhá»› theo nhá»‹p: drINK â†’ drANK â†’ drUNK. Váº§n nhÆ° bÃ i hÃ¡t!',
      verbs: [
        { base: 'begin', past: 'began', pp: 'begun', vn: 'báº¯t Ä‘áº§u' },
        { base: 'drink', past: 'drank', pp: 'drunk', vn: 'uá»‘ng' },
        { base: 'ring', past: 'rang', pp: 'rung', vn: 'reo, rung chuÃ´ng' },
        { base: 'sing', past: 'sang', pp: 'sung', vn: 'hÃ¡t' },
        { base: 'swim', past: 'swam', pp: 'swum', vn: 'bÆ¡i' },
        { base: 'swing', past: 'swung', pp: 'swung', vn: 'Ä‘ung Ä‘Æ°a' }
      ]
    },
    {
      id: 'owewown',
      name: '6. OW â†’ EW â†’ OWN',
      pattern: 'AW - OW / EW / OWN',
      color: 'pattern-ow-ew',
      tip: 'ğŸ’¨ Quy luáº­t: OW â†’ EW â†’ OWN. VÃ­ dá»¥: blOW â†’ blEW â†’ blOWN',
      verbs: [
        { base: 'blow', past: 'blew', pp: 'blown', vn: 'thá»•i' },
        { base: 'draw', past: 'drew', pp: 'drawn', vn: 'váº½' },
        { base: 'fly', past: 'flew', pp: 'flown', vn: 'bay' },
        { base: 'grow', past: 'grew', pp: 'grown', vn: 'lá»›n lÃªn, trá»“ng' },
        { base: 'know', past: 'knew', pp: 'known', vn: 'biáº¿t' },
        { base: 'throw', past: 'threw', pp: 'thrown', vn: 'nÃ©m' }
      ]
    },
    {
      id: 'ought',
      name: '7. -AUGHT / -OUGHT',
      pattern: '-AUGHT / -OUGHT',
      color: 'pattern-ought',
      tip: 'ğŸ¯ Káº¿t thÃºc báº±ng -OUGHT hoáº·c -AUGHT. PhÃ¡t Ã¢m: /É”Ët/',
      verbs: [
        { base: 'bring', past: 'brought', pp: 'brought', vn: 'mang Ä‘áº¿n' },
        { base: 'buy', past: 'bought', pp: 'bought', vn: 'mua' },
        { base: 'catch', past: 'caught', pp: 'caught', vn: 'báº¯t' },
        { base: 'fight', past: 'fought', pp: 'fought', vn: 'chiáº¿n Ä‘áº¥u' },
        { base: 'teach', past: 'taught', pp: 'taught', vn: 'dáº¡y' },
        { base: 'think', past: 'thought', pp: 'thought', vn: 'nghÄ©' }
      ]
    },
    {
      id: 'stand',
      name: '8. -STAND â†’ -STOOD',
      pattern: '-STAND / -STOOD / -STOOD',
      color: 'pattern-stand',
      tip: 'ğŸ§ LiÃªn quan Ä‘áº¿n Äá»¨NG: stand â†’ stood â†’ stood',
      verbs: [
        { base: 'stand', past: 'stood', pp: 'stood', vn: 'Ä‘á»©ng' },
        { base: 'understand', past: 'understood', pp: 'understood', vn: 'hiá»ƒu' }
      ]
    },
    {
      id: 'ee',
      name: '9. -EE- â†’ -E- â†’ -E-',
      pattern: '-EE- / -E- / -E-',
      color: 'pattern-ee',
      tip: 'ğŸ“– NguyÃªn Ã¢m EE rÃºt ngáº¯n thÃ nh E. VÃ­ dá»¥: fEEd â†’ fEd â†’ fEd',
      verbs: [
        { base: 'bleed', past: 'bled', pp: 'bled', vn: 'cháº£y mÃ¡u' },
        { base: 'feed', past: 'fed', pp: 'fed', vn: 'cho Äƒn' },
        { base: 'feel', past: 'felt', pp: 'felt', vn: 'cáº£m tháº¥y' },
        { base: 'keep', past: 'kept', pp: 'kept', vn: 'giá»¯' },
        { base: 'meet', past: 'met', pp: 'met', vn: 'gáº·p' },
        { base: 'sleep', past: 'slept', pp: 'slept', vn: 'ngá»§' },
        { base: 'sweep', past: 'swept', pp: 'swept', vn: 'quÃ©t' }
      ]
    },
    {
      id: 'dt',
      name: '10. -D â†’ -T â†’ -T',
      pattern: '-D / -T / -T',
      color: 'pattern-d-t',
      tip: 'ğŸ”„ Äá»•i D thÃ nh T. VÃ­ dá»¥: senD â†’ senT â†’ senT',
      verbs: [
        { base: 'build', past: 'built', pp: 'built', vn: 'xÃ¢y dá»±ng' },
        { base: 'lend', past: 'lent', pp: 'lent', vn: 'cho mÆ°á»£n' },
        { base: 'send', past: 'sent', pp: 'sent', vn: 'gá»­i' },
        { base: 'spend', past: 'spent', pp: 'spent', vn: 'tiÃªu (tiá»n/thá»i gian)' }
      ]
    },
    {
      id: 't',
      name: '11. Káº¿t thÃºc -T',
      pattern: '-T / -T',
      color: 'pattern-t',
      tip: 'âœ¨ Past vÃ  PP Ä‘á»u káº¿t thÃºc báº±ng -T',
      verbs: [
        { base: 'burn', past: 'burnt', pp: 'burnt', vn: 'chÃ¡y, Ä‘á»‘t' },
        { base: 'dream', past: 'dreamt', pp: 'dreamt', vn: 'mÆ¡' },
        { base: 'learn', past: 'learnt', pp: 'learnt', vn: 'há»c' },
        { base: 'leave', past: 'left', pp: 'left', vn: 'rá»i Ä‘i' },
        { base: 'light', past: 'lit', pp: 'lit', vn: 'tháº¯p sÃ¡ng' },
        { base: 'lose', past: 'lost', pp: 'lost', vn: 'máº¥t, thua' },
        { base: 'mean', past: 'meant', pp: 'meant', vn: 'cÃ³ nghÄ©a' },
        { base: 'shoot', past: 'shot', pp: 'shot', vn: 'báº¯n' },
        { base: 'sit', past: 'sat', pp: 'sat', vn: 'ngá»“i' },
        { base: 'spell', past: 'spelt', pp: 'spelt', vn: 'Ä‘Ã¡nh váº§n' }
      ]
    },
    {
      id: 'misc',
      name: '12. Há»—n há»£p',
      pattern: 'MISCELLANEOUS',
      color: 'pattern-misc',
      tip: 'ğŸ² NhÃ³m Ä‘áº·c biá»‡t - cáº§n nhá»› riÃªng tá»«ng tá»«!',
      verbs: [
        { base: 'become', past: 'became', pp: 'become', vn: 'trá»Ÿ thÃ nh' },
        { base: 'find', past: 'found', pp: 'found', vn: 'tÃ¬m tháº¥y' },
        { base: 'hang', past: 'hung', pp: 'hung', vn: 'treo' },
        { base: 'hold', past: 'held', pp: 'held', vn: 'cáº§m, giá»¯' },
        { base: 'lay', past: 'laid', pp: 'laid', vn: 'Ä‘áº·t, Ä‘á»ƒ' },
        { base: 'lie', past: 'lay', pp: 'lain', vn: 'náº±m' },
        { base: 'pay', past: 'paid', pp: 'paid', vn: 'tráº£ tiá»n' },
        { base: 'run', past: 'ran', pp: 'run', vn: 'cháº¡y' },
        { base: 'sell', past: 'sold', pp: 'sold', vn: 'bÃ¡n' },
        { base: 'shine', past: 'shone', pp: 'shone', vn: 'chiáº¿u sÃ¡ng' },
        { base: 'show', past: 'showed', pp: 'shown', vn: 'cho xem' },
        { base: 'wear', past: 'wore', pp: 'worn', vn: 'máº·c' },
        { base: 'win', past: 'won', pp: 'won', vn: 'tháº¯ng' }
      ]
    }
  ]
};

// Study state
var currentStudyGroup = 'all';
var expandedGroups = ['important'];
var studyQuizState = {
  active: false,
  verbs: [],
  currentIndex: 0,
  score: 0,
  answers: [],
  mode: 'past' // 'past' or 'pp'
};
var speedGameState = {
  active: false,
  timer: 30,
  score: 0,
  currentVerb: null,
  intervalId: null
};

// ============ STUDY SCREEN ============
function showLearnScreen() {
  playSound('click');
  
  var html = '<div class="progress-header" style="margin-bottom:10px">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div style="color:white;font-weight:700;font-size:1.1rem">ğŸ“š Há»c Táº­p</div>' +
    '<div></div></div>' +
    
    '<div class="study-header">' +
    '<div class="study-title">ğŸ“– Horrible List</div>' +
    '<div class="study-subtitle">Danh sÃ¡ch Ä‘á»™ng tá»« báº¥t quy táº¯c</div>' +
    '</div>' +
    
    '<div class="study-tip-box">' +
    '<div class="study-tip-icon">ğŸ’¡</div>' +
    '<div class="study-tip-text">' +
    '<strong>Máº¹o há»c nhanh:</strong> Há»c theo nhÃ³m cÃ³ quy luáº­t giá»‘ng nhau sáº½ dá»… nhá»› hÆ¡n! ' +
    'Báº¯t Ä‘áº§u vá»›i nhÃ³m <strong>"KhÃ´ng Ä‘á»•i"</strong> vÃ¬ cáº£ 3 dáº¡ng giá»‘ng nhau.' +
    '</div></div>' +
    
    // Study modes
    '<div class="study-modes">' +
    '<button class="study-mode-btn" onclick="startEasyMatch()" style="background:#E8F5E9;color:#2E7D32">' +
    '<span class="icon">ğŸ¯</span>' +
    '<span>Easy Match</span>' +
    '</button>' +
    '<button class="study-mode-btn" onclick="startTripleMatch()" style="background:#E3F2FD;color:#1565C0">' +
    '<span class="icon">ğŸ”—</span>' +
    '<span>Triple Match</span>' +
    '</button>' +
    '<button class="study-mode-btn" onclick="startVerbSentenceQuiz()" style="background:#FFF3E0;color:#E65100">' +
    '<span class="icon">ğŸ“</span>' +
    '<span>Tráº¯c nghiá»‡m</span>' +
    '</button>' +
    '<button class="study-mode-btn speed" onclick="startSpeedChallenge()">' +
    '<span class="icon">âš¡</span>' +
    '<span>Thá»­ thÃ¡ch</span>' +
    '</button>' +
    '</div>' +
    
    // Group selector
    '<div class="group-selector">' +
    '<button class="group-btn' + (currentStudyGroup === 'all' ? ' active' : '') + '" onclick="filterStudyGroup(\'all\')">Táº¥t cáº£</button>';
  
  IRREGULAR_VERBS.groups.forEach(function(group) {
    html += '<button class="group-btn' + (currentStudyGroup === group.id ? ' active' : '') + '" onclick="filterStudyGroup(\'' + group.id + '\')">' + 
      group.name.split('.')[0] + '.' + group.pattern.substring(0, 8) + '</button>';
  });
  
  html += '</div>';
  
  // Verb groups
  var groupsToShow = currentStudyGroup === 'all' ? IRREGULAR_VERBS.groups : 
    IRREGULAR_VERBS.groups.filter(function(g) { return g.id === currentStudyGroup; });
  
  groupsToShow.forEach(function(group) {
    var isExpanded = expandedGroups.indexOf(group.id) >= 0;
    html += '<div class="verb-group-card">' +
      '<div class="verb-group-header ' + group.color + (isExpanded ? ' expanded' : '') + '" onclick="toggleVerbGroup(\'' + group.id + '\')">' +
      '<div class="verb-group-title">' +
      '<span>' + group.name + '</span>' +
      '<span class="verb-group-count">' + group.verbs.length + ' tá»«</span>' +
      '</div>' +
      '<span class="verb-group-arrow' + (isExpanded ? ' rotated' : '') + '">â–¼</span>' +
      '</div>' +
      '<div class="verb-group-content' + (isExpanded ? ' expanded' : '') + '">' +
      '<div class="study-tip-box" style="margin:15px;background:linear-gradient(135deg,#E3F2FD,#BBDEFB)">' +
      '<div class="study-tip-icon">ğŸ’¡</div>' +
      '<div class="study-tip-text">' + group.tip + '</div>' +
      '</div>' +
      '<table class="verb-table">' +
      '<tr><th>Infinitive</th><th>Simple Past</th><th>Past Participle</th><th>NghÄ©a ğŸ‡»ğŸ‡³</th></tr>';
    
    group.verbs.forEach(function(verb) {
      html += '<tr>' +
        '<td>' + verb.base + '</td>' +
        '<td>' + verb.past + '</td>' +
        '<td>' + verb.pp + '</td>' +
        '<td>' + verb.vn + '</td>' +
        '</tr>';
    });
    
    html += '</table></div></div>';
  });
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function toggleVerbGroup(groupId) {
  playSound('click');
  var index = expandedGroups.indexOf(groupId);
  if (index >= 0) {
    expandedGroups.splice(index, 1);
  } else {
    expandedGroups.push(groupId);
  }
  showLearnScreen();
}

function filterStudyGroup(groupId) {
  playSound('click');
  currentStudyGroup = groupId;
  if (groupId !== 'all') {
    expandedGroups = [groupId];
  }
  showLearnScreen();
}

// ============ STUDY QUIZ ============
function startStudyQuiz(mode) {
  playSound('click');
  
  // Collect all verbs
  var allVerbs = [];
  IRREGULAR_VERBS.groups.forEach(function(group) {
    group.verbs.forEach(function(verb) {
      allVerbs.push(verb);
    });
  });
  
  studyQuizState = {
    active: true,
    verbs: shuffle(allVerbs).slice(0, 10),
    currentIndex: 0,
    score: 0,
    answers: [],
    mode: mode
  };
  
  renderStudyQuiz();
}

function renderStudyQuiz() {
  var state = studyQuizState;
  if (state.currentIndex >= state.verbs.length) {
    showStudyQuizResult();
    return;
  }
  
  var verb = state.verbs[state.currentIndex];
  var questionText = state.mode === 'past' ? 'Dáº¡ng QUÃ KHá»¨ cá»§a:' : 'Dáº¡ng PAST PARTICIPLE cá»§a:';
  var answer = state.mode === 'past' ? verb.past : verb.pp;
  
  var dotsHtml = '';
  for (var i = 0; i < state.verbs.length; i++) {
    var dotClass = 'quiz-dot';
    if (i < state.currentIndex) {
      dotClass += state.answers[i] ? ' done' : ' wrong-dot';
    } else if (i === state.currentIndex) {
      dotClass += ' current';
    }
    dotsHtml += '<div class="' + dotClass + '"></div>';
  }
  
  var html = '<div class="quiz-overlay" onclick="closeStudyQuiz(event)">' +
    '<div class="quiz-modal" onclick="event.stopPropagation()">' +
    '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">' +
    '<button class="back-btn" onclick="closeStudyQuiz()" style="padding:8px 15px">âœ•</button>' +
    '<div style="font-weight:700;color:#666">' + (state.currentIndex + 1) + ' / ' + state.verbs.length + '</div>' +
    '<div style="font-weight:700;color:#4CAF50">â­ ' + state.score + '</div>' +
    '</div>' +
    '<div class="quiz-question">' + questionText + '</div>' +
    '<div class="quiz-verb">' + verb.base + '</div>' +
    '<div style="color:#666;margin-bottom:15px">(' + verb.vn + ')</div>' +
    '<input type="text" class="quiz-input" id="quizInput" placeholder="Nháº­p cÃ¢u tráº£ lá»i..." autocomplete="off" onkeypress="if(event.key===\'Enter\')checkStudyQuizAnswer()">' +
    '<div class="quiz-hint">ğŸ’¡ GÃµ vÃ  nháº¥n Enter</div>' +
    '<div id="quizFeedback"></div>' +
    '<div class="quiz-progress">' + dotsHtml + '</div>' +
    '</div></div>';
  
  document.getElementById('learnScreen').innerHTML += '<div id="quizOverlay">' + html + '</div>';
  setTimeout(function() {
    var input = document.getElementById('quizInput');
    if (input) input.focus();
  }, 100);
}

function checkStudyQuizAnswer() {
  var input = document.getElementById('quizInput');
  var userAnswer = input.value.trim().toLowerCase();
  var verb = studyQuizState.verbs[studyQuizState.currentIndex];
  var correctAnswer = studyQuizState.mode === 'past' ? verb.past : verb.pp;
  
  // Handle multiple correct answers (e.g., "was/were")
  var correctAnswers = correctAnswer.toLowerCase().split('/').map(function(a) { return a.trim(); });
  var isCorrect = correctAnswers.indexOf(userAnswer) >= 0;
  
  studyQuizState.answers.push(isCorrect);
  
  if (isCorrect) {
    studyQuizState.score++;
    input.classList.add('correct');
    playSound('correct');
  } else {
    input.classList.add('wrong');
    playSound('wrong');
  }
  
  var feedback = '<div style="margin-top:15px;padding:15px;border-radius:12px;' + 
    (isCorrect ? 'background:#E8F5E9' : 'background:#FFEBEE') + '">' +
    '<div style="font-size:2rem;margin-bottom:8px">' + (isCorrect ? 'ğŸ‰' : 'ğŸ’ª') + '</div>' +
    '<div style="font-weight:700;color:' + (isCorrect ? '#2E7D32' : '#C62828') + '">' +
    (isCorrect ? 'ChÃ­nh xÃ¡c!' : 'ÄÃ¡p Ã¡n: ' + correctAnswer) + '</div>' +
    '</div>';
  
  document.getElementById('quizFeedback').innerHTML = feedback;
  input.disabled = true;
  
  setTimeout(function() {
    studyQuizState.currentIndex++;
    document.getElementById('quizOverlay').remove();
    if (studyQuizState.currentIndex < studyQuizState.verbs.length) {
      renderStudyQuiz();
    } else {
      showStudyQuizResult();
    }
  }, 1500);
}

function showStudyQuizResult() {
  var state = studyQuizState;
  var percentage = Math.round((state.score / state.verbs.length) * 100);
  var emoji = percentage >= 80 ? 'ğŸ†' : percentage >= 60 ? 'â­' : percentage >= 40 ? 'ğŸ’ª' : 'ğŸ“š';
  var message = percentage >= 80 ? 'Xuáº¥t sáº¯c! Con giá»i láº¯m!' : 
                percentage >= 60 ? 'Tá»‘t láº¯m! Tiáº¿p tá»¥c cá»‘ gáº¯ng nhÃ©!' :
                percentage >= 40 ? 'Cá»‘ lÃªn! Ã”n thÃªm nhÃ© con!' : 'Cáº§n Ã´n láº¡i nhiá»u hÆ¡n nha!';
  
  playSound('complete');
  showConfetti();
  
  var html = '<div class="quiz-overlay">' +
    '<div class="quiz-modal">' +
    '<div style="font-size:80px;margin-bottom:15px">' + emoji + '</div>' +
    '<div style="font-size:1.5rem;font-weight:800;color:#333;margin-bottom:10px">' + message + '</div>' +
    '<div style="font-size:3rem;font-weight:800;color:#667eea;margin:20px 0">' + state.score + '/' + state.verbs.length + '</div>' +
    '<div style="font-size:1.1rem;color:#666;margin-bottom:25px">' + percentage + '% chÃ­nh xÃ¡c</div>' +
    '<button class="next-btn" onclick="closeStudyQuiz();startStudyQuiz(\'' + state.mode + '\')">ChÆ¡i láº¡i ğŸ”„</button>' +
    '<button class="next-btn" style="margin-top:10px;background:#F5F5F5;color:#333" onclick="closeStudyQuiz();showLearnScreen()">Vá» há»c táº­p ğŸ“š</button>' +
    '</div></div>';
  
  document.getElementById('learnScreen').innerHTML += '<div id="quizOverlay">' + html + '</div>';
}

function closeStudyQuiz(event) {
  if (event && event.target.className !== 'quiz-overlay') return;
  var overlay = document.getElementById('quizOverlay');
  if (overlay) overlay.remove();
  studyQuizState.active = false;
}

// ============ SPEED CHALLENGE ============
function startSpeedChallenge() {
  playSound('click');
  
  var allVerbs = [];
  IRREGULAR_VERBS.groups.forEach(function(group) {
    group.verbs.forEach(function(verb) {
      allVerbs.push(verb);
    });
  });
  
  speedGameState = {
    active: true,
    timer: 30,
    score: 0,
    verbs: shuffle(allVerbs),
    currentIndex: 0
  };
  
  renderSpeedGame();
  
  speedGameState.intervalId = setInterval(function() {
    speedGameState.timer--;
    updateSpeedTimer();
    if (speedGameState.timer <= 0) {
      endSpeedGame();
    }
  }, 1000);
}

function renderSpeedGame() {
  var state = speedGameState;
  var verb = state.verbs[state.currentIndex % state.verbs.length];
  
  var timerClass = 'speed-timer';
  if (state.timer <= 10) timerClass += ' warning';
  if (state.timer <= 5) timerClass += ' danger';
  
  var html = '<div class="progress-header" style="margin-bottom:10px">' +
    '<button class="back-btn" onclick="endSpeedGame()">â† ThoÃ¡t</button>' +
    '<div style="color:white;font-weight:700">âš¡ Thá»­ thÃ¡ch tá»‘c Ä‘á»™</div>' +
    '<div></div></div>' +
    
    '<div class="' + timerClass + '" id="speedTimer">' + state.timer + '</div>' +
    '<div class="speed-score">ğŸŒŸ Äiá»ƒm: ' + state.score + '</div>' +
    
    '<div class="quiz-modal" style="margin:0 auto">' +
    '<div class="quiz-question">Dáº¡ng QUÃ KHá»¨ cá»§a:</div>' +
    '<div class="quiz-verb">' + verb.base + '</div>' +
    '<div style="color:#666;margin-bottom:15px">(' + verb.vn + ')</div>' +
    '<input type="text" class="quiz-input" id="speedInput" placeholder="GÃµ nhanh!" autocomplete="off" onkeypress="if(event.key===\'Enter\')checkSpeedAnswer()">' +
    '<div id="speedFeedback"></div>' +
    '</div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  setTimeout(function() {
    var input = document.getElementById('speedInput');
    if (input) input.focus();
  }, 50);
}

function updateSpeedTimer() {
  var timerEl = document.getElementById('speedTimer');
  if (timerEl) {
    timerEl.textContent = speedGameState.timer;
    timerEl.className = 'speed-timer';
    if (speedGameState.timer <= 10) timerEl.className += ' warning';
    if (speedGameState.timer <= 5) timerEl.className += ' danger';
  }
}

function checkSpeedAnswer() {
  var input = document.getElementById('speedInput');
  var userAnswer = input.value.trim().toLowerCase();
  var verb = speedGameState.verbs[speedGameState.currentIndex % speedGameState.verbs.length];
  var correctAnswers = verb.past.toLowerCase().split('/').map(function(a) { return a.trim(); });
  
  if (correctAnswers.indexOf(userAnswer) >= 0) {
    speedGameState.score++;
    playSound('correct');
  } else {
    playSound('wrong');
  }
  
  speedGameState.currentIndex++;
  renderSpeedGame();
}

function endSpeedGame() {
  if (speedGameState.intervalId) {
    clearInterval(speedGameState.intervalId);
  }
  
  var score = speedGameState.score;
  var emoji = score >= 15 ? 'ğŸ†' : score >= 10 ? 'â­' : score >= 5 ? 'ğŸ’ª' : 'ğŸ“š';
  var message = score >= 15 ? 'SiÃªu tá»‘c Ä‘á»™!' : score >= 10 ? 'Tá»‘t láº¯m!' : score >= 5 ? 'Cá»‘ lÃªn!' : 'Luyá»‡n thÃªm nhÃ©!';
  
  playSound('complete');
  if (score >= 10) showConfetti();
  
  var html = '<div class="result-content">' +
    '<div class="result-card">' +
    '<div class="result-emoji">' + emoji + '</div>' +
    '<div class="result-title">' + message + '</div>' +
    '<div style="font-size:3rem;font-weight:800;color:#667eea;margin:20px 0">ğŸŒŸ ' + score + '</div>' +
    '<div class="result-message">trong 30 giÃ¢y</div>' +
    '<div class="result-buttons">' +
    '<button class="result-btn primary" onclick="startSpeedChallenge()">ChÆ¡i láº¡i âš¡</button>' +
    '<button class="result-btn secondary" onclick="showLearnScreen()">Vá» há»c táº­p ğŸ“š</button>' +
    '</div></div></div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
  speedGameState.active = false;
}

// ============ MEMORY GAME ============
var memoryGameState = {
  cards: [],
  flipped: [],
  matched: [],
  moves: 0
};

function startVerbMemory() {
  playSound('click');
  
  var allVerbs = [];
  IRREGULAR_VERBS.groups.forEach(function(group) {
    group.verbs.forEach(function(verb) {
      allVerbs.push(verb);
    });
  });
  
  var selectedVerbs = shuffle(allVerbs).slice(0, 6);
  var cards = [];
  
  selectedVerbs.forEach(function(verb, i) {
    cards.push({ id: 'base-' + i, text: verb.base, pairId: i, type: 'base' });
    cards.push({ id: 'past-' + i, text: verb.past, pairId: i, type: 'past' });
  });
  
  memoryGameState = {
    cards: shuffle(cards),
    flipped: [],
    matched: [],
    moves: 0
  };
  
  renderMemoryGame();
}

function renderMemoryGame() {
  var state = memoryGameState;
  
  var html = '<div class="progress-header" style="margin-bottom:15px">' +
    '<button class="back-btn" onclick="showLearnScreen()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ§  Memory Game</div>' +
    '<div style="color:white;font-weight:700">LÆ°á»£t: ' + state.moves + '</div>' +
    '</div>' +
    
    '<div style="text-align:center;color:white;margin-bottom:15px">' +
    'ğŸŸ¢ GhÃ©p tá»« gá»‘c vá»›i dáº¡ng quÃ¡ khá»©!' +
    '</div>' +
    
    '<div class="memory-grid">';
  
  state.cards.forEach(function(card, index) {
    var isFlipped = state.flipped.indexOf(index) >= 0;
    var isMatched = state.matched.indexOf(card.pairId) >= 0;
    
    var cardClass = 'memory-card';
    if (isFlipped || isMatched) cardClass += ' flipped';
    if (isMatched) cardClass += ' matched';
    
    html += '<button class="' + cardClass + '" ' +
      (isMatched ? 'disabled' : 'onclick="flipMemoryCard(' + index + ')"') + '>' +
      (isFlipped || isMatched ? card.text : 'â“') +
      '</button>';
  });
  
  html += '</div>';
  
  if (state.matched.length >= 6) {
    html += '<div style="text-align:center;margin-top:25px">' +
      '<div style="font-size:60px;margin-bottom:15px">ğŸ‰</div>' +
      '<div style="color:white;font-size:1.5rem;font-weight:700;margin-bottom:10px">HoÃ n thÃ nh!</div>' +
      '<div style="color:rgba(255,255,255,0.8);margin-bottom:20px">Sá»‘ lÆ°á»£t: ' + state.moves + '</div>' +
      '<button class="next-btn" onclick="startVerbMemory()">ChÆ¡i láº¡i ğŸ”„</button>' +
      '</div>';
  }
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function flipMemoryCard(index) {
  var state = memoryGameState;
  
  if (state.flipped.length >= 2) return;
  if (state.flipped.indexOf(index) >= 0) return;
  if (state.matched.indexOf(state.cards[index].pairId) >= 0) return;
  
  playSound('flip');
  state.flipped.push(index);
  renderMemoryGame();
  
  if (state.flipped.length === 2) {
    state.moves++;
    var card1 = state.cards[state.flipped[0]];
    var card2 = state.cards[state.flipped[1]];
    
    if (card1.pairId === card2.pairId && card1.type !== card2.type) {
      // Match!
      setTimeout(function() {
        playSound('correct');
        state.matched.push(card1.pairId);
        state.flipped = [];
        renderMemoryGame();
        if (state.matched.length >= 6) {
          playSound('complete');
          showConfetti();
        }
      }, 500);
    } else {
      // No match
      setTimeout(function() {
        playSound('wrong');
        state.flipped = [];
        renderMemoryGame();
      }, 1000);
    }
  }
}

// ============ EASY MATCH GAME ============
var easyMatchState = {
  verbs: [],
  baseCards: [],
  pastCards: [],
  selectedBase: null,
  matched: [],
  level: 4
};

function startEasyMatch() {
  playSound('click');
  
  // Show level selection
  var html = '<div class="progress-header" style="margin-bottom:15px">' +
    '<button class="back-btn" onclick="showLearnScreen()">â† Back</button>' +
    '<div style="color:white;font-weight:700;font-size:1.1rem">ğŸ¯ Easy Match</div>' +
    '<div></div></div>' +
    
    '<div class="easy-match-container">' +
    '<div class="easy-match-header">' +
    '<div style="font-size:50px;margin-bottom:10px">ğŸ¯</div>' +
    '<div class="easy-match-title">Chá»n má»©c Ä‘á»™</div>' +
    '<div class="easy-match-hint">GhÃ©p tá»« gá»‘c vá»›i tá»« quÃ¡ khá»©</div>' +
    '</div>' +
    
    '<div class="easy-match-level-select">' +
    '<div class="easy-match-level easy" onclick="startEasyMatchGame(4)">' +
    '<div class="level-icon">ğŸŒ±</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Dá»…</div>' +
    '<div class="level-desc">4 cáº·p tá»« - CÃ³ gá»£i Ã½ nghÄ©a</div>' +
    '</div></div>' +
    
    '<div class="easy-match-level medium" onclick="startEasyMatchGame(6)">' +
    '<div class="level-icon">ğŸŒ¿</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Vá»«a</div>' +
    '<div class="level-desc">6 cáº·p tá»« - CÃ³ gá»£i Ã½ nghÄ©a</div>' +
    '</div></div>' +
    
    '<div class="easy-match-level hard" onclick="startEasyMatchGame(8)">' +
    '<div class="level-icon">ğŸŒ³</div>' +
    '<div class="level-info">' +
    '<div class="level-name">KhÃ³</div>' +
    '<div class="level-desc">8 cáº·p tá»« - KhÃ´ng gá»£i Ã½</div>' +
    '</div></div>' +
    '</div></div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function startEasyMatchGame(level) {
  playSound('click');
  
  // Collect all verbs
  var allVerbs = [];
  IRREGULAR_VERBS.groups.forEach(function(group) {
    group.verbs.forEach(function(verb) {
      // Only use verbs where past is different from base
      if (verb.base !== verb.past) {
        allVerbs.push(verb);
      }
    });
  });
  
  var selectedVerbs = shuffle(allVerbs).slice(0, level);
  
  easyMatchState = {
    verbs: selectedVerbs,
    baseCards: shuffle(selectedVerbs.map(function(v, i) { return { verb: v, index: i }; })),
    pastCards: shuffle(selectedVerbs.map(function(v, i) { return { verb: v, index: i }; })),
    selectedBase: null,
    matched: [],
    level: level,
    showMeaning: level <= 6
  };
  
  renderEasyMatch();
}

function renderEasyMatch() {
  var state = easyMatchState;
  
  var html = '<div class="progress-header" style="margin-bottom:15px">' +
    '<button class="back-btn" onclick="startEasyMatch()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ¯ Easy Match</div>' +
    '<div style="color:white;font-weight:700">âœ“ ' + state.matched.length + '/' + state.level + '</div>' +
    '</div>' +
    
    '<div style="text-align:center;color:white;margin-bottom:10px;padding:10px 15px;background:rgba(255,255,255,0.15);border-radius:12px">' +
    '<span style="font-size:1.1rem">' +
    (state.selectedBase === null ? 'ğŸ‘† Chá»n tá»« <strong style="color:#A5D6A7">Gá»C</strong> (bÃªn trÃ¡i)' : 
    'ğŸ‘‰ Chá»n tá»« <strong style="color:#FFCC80">QUÃ KHá»¨</strong> tÆ°Æ¡ng á»©ng') +
    '</span></div>' +
    
    '<div class="easy-match-container">' +
    '<div class="easy-match-columns">' +
    
    // Base column
    '<div class="easy-match-column">' +
    '<div class="easy-match-label base">â˜€ï¸ Tá»« gá»‘c</div>';
  
  state.baseCards.forEach(function(card) {
    var isMatched = state.matched.indexOf(card.index) >= 0;
    var isSelected = state.selectedBase === card.index;
    var cardClass = 'easy-match-card base-card';
    if (isMatched) cardClass += ' matched';
    if (isSelected) cardClass += ' selected';
    
    html += '<div class="' + cardClass + '" ' +
      'id="base-' + card.index + '" ' +
      (isMatched ? '' : 'onclick="selectEasyMatchBase(' + card.index + ')"') + '>' +
      '<div class="verb-text">' + card.verb.base + '</div>' +
      (state.showMeaning ? '<div class="verb-meaning">' + card.verb.vn + '</div>' : '') +
      '</div>';
  });
  
  html += '</div>' +
    
    // Past column
    '<div class="easy-match-column">' +
    '<div class="easy-match-label past">ğŸŒ™ QuÃ¡ khá»©</div>';
  
  state.pastCards.forEach(function(card) {
    var isMatched = state.matched.indexOf(card.index) >= 0;
    var cardClass = 'easy-match-card past-card';
    if (isMatched) cardClass += ' matched';
    
    html += '<div class="' + cardClass + '" ' +
      'id="past-' + card.index + '" ' +
      (isMatched ? '' : 'onclick="selectEasyMatchPast(' + card.index + ')"') + '>' +
      '<div class="verb-text">' + card.verb.past + '</div>' +
      '</div>';
  });
  
  html += '</div></div>' +
    
    // Score section
    '<div class="easy-match-score">' +
    '<div class="easy-match-progress">';
  
  for (var i = 0; i < state.level; i++) {
    html += '<div class="easy-match-dot' + (i < state.matched.length ? ' done' : '') + '">' +
      (i < state.matched.length ? 'âœ“' : (i + 1)) + '</div>';
  }
  
  html += '</div>' +
    '<div style="color:#2E7D32;font-weight:700">' +
    (state.matched.length === state.level ? 'ğŸ‰ HoÃ n thÃ nh xuáº¥t sáº¯c!' : 
    'ÄÃ£ ghÃ©p: ' + state.matched.length + ' / ' + state.level) +
    '</div></div></div>';
  
  // Complete screen
  if (state.matched.length === state.level) {
    playSound('complete');
    showConfetti();
    
    html += '<div style="text-align:center;margin-top:20px">' +
      '<button class="next-btn" onclick="startEasyMatchGame(' + state.level + ')" style="margin-bottom:10px">ChÆ¡i láº¡i ğŸ”„</button>' +
      '<button class="next-btn" style="background:#F5F5F5;color:#333" onclick="startEasyMatch()">Äá»•i má»©c Ä‘á»™ ğŸ“Š</button>' +
      '</div>';
  }
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function selectEasyMatchBase(index) {
  if (easyMatchState.matched.indexOf(index) >= 0) return;
  
  playSound('click');
  easyMatchState.selectedBase = index;
  renderEasyMatch();
}

function selectEasyMatchPast(index) {
  if (easyMatchState.selectedBase === null) {
    // Hint to select base first
    playSound('wrong');
    return;
  }
  
  if (easyMatchState.matched.indexOf(index) >= 0) return;
  
  var baseIndex = easyMatchState.selectedBase;
  
  if (baseIndex === index) {
    // Correct match!
    playSound('correct');
    
    // Flash animation
    var baseEl = document.getElementById('base-' + baseIndex);
    var pastEl = document.getElementById('past-' + index);
    if (baseEl) baseEl.classList.add('correct-flash');
    if (pastEl) pastEl.classList.add('correct-flash');
    
    setTimeout(function() {
      easyMatchState.matched.push(index);
      easyMatchState.selectedBase = null;
      renderEasyMatch();
    }, 500);
  } else {
    // Wrong match
    playSound('wrong');
    
    var pastEl = document.getElementById('past-' + index);
    if (pastEl) pastEl.classList.add('wrong-flash');
    
    setTimeout(function() {
      if (pastEl) pastEl.classList.remove('wrong-flash');
    }, 500);
  }
}

// ============ TRIPLE MATCH GAME ============
var tripleMatchState = {
  verbs: [],
  infCards: [],
  pastCards: [],
  ppCards: [],
  selectedInf: null,
  selectedPast: null,
  matched: [],
  level: 4,
  showMeaning: true
};

function startTripleMatch() {
  playSound('click');
  
  var html = '<div class="progress-header" style="margin-bottom:15px">' +
    '<button class="back-btn" onclick="showLearnScreen()">â† Back</button>' +
    '<div style="color:white;font-weight:700;font-size:1.1rem">ğŸ”— Triple Match</div>' +
    '<div></div></div>' +
    
    '<div class="easy-match-container">' +
    '<div class="easy-match-header">' +
    '<div style="font-size:50px;margin-bottom:10px">ğŸ”—</div>' +
    '<div class="easy-match-title">Triple Match</div>' +
    '<div class="easy-match-hint">GhÃ©p cáº£ 3 dáº¡ng: Gá»‘c â†’ QuÃ¡ khá»© â†’ PP</div>' +
    '</div>' +
    
    '<div class="easy-match-level-select">' +
    '<div class="easy-match-level easy" onclick="startTripleMatchGame(4)">' +
    '<div class="level-icon">ğŸŒ±</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Dá»…</div>' +
    '<div class="level-desc">4 bá»™ tá»« - CÃ³ gá»£i Ã½ nghÄ©a</div>' +
    '</div></div>' +
    
    '<div class="easy-match-level medium" onclick="startTripleMatchGame(5)">' +
    '<div class="level-icon">ğŸŒ¿</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Vá»«a</div>' +
    '<div class="level-desc">5 bá»™ tá»« - CÃ³ gá»£i Ã½ nghÄ©a</div>' +
    '</div></div>' +
    
    '<div class="easy-match-level hard" onclick="startTripleMatchGame(6)">' +
    '<div class="level-icon">ğŸŒ³</div>' +
    '<div class="level-info">' +
    '<div class="level-name">KhÃ³</div>' +
    '<div class="level-desc">6 bá»™ tá»« - KhÃ´ng gá»£i Ã½</div>' +
    '</div></div>' +
    '</div></div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function startTripleMatchGame(level) {
  playSound('click');
  
  var allVerbs = [];
  IRREGULAR_VERBS.groups.forEach(function(group) {
    group.verbs.forEach(function(verb) {
      // Use verbs where all 3 forms are different for better learning
      if (verb.base !== verb.past || verb.past !== verb.pp) {
        allVerbs.push(verb);
      }
    });
  });
  
  var selectedVerbs = shuffle(allVerbs).slice(0, level);
  
  tripleMatchState = {
    verbs: selectedVerbs,
    infCards: shuffle(selectedVerbs.map(function(v, i) { return { verb: v, index: i }; })),
    pastCards: shuffle(selectedVerbs.map(function(v, i) { return { verb: v, index: i }; })),
    ppCards: shuffle(selectedVerbs.map(function(v, i) { return { verb: v, index: i }; })),
    selectedInf: null,
    selectedPast: null,
    matched: [],
    level: level,
    showMeaning: level <= 5
  };
  
  renderTripleMatch();
}

function renderTripleMatch() {
  var state = tripleMatchState;
  
  // Determine current step
  var step = 1;
  if (state.selectedInf !== null && state.selectedPast === null) step = 2;
  if (state.selectedInf !== null && state.selectedPast !== null) step = 3;
  
  var stepText = '';
  if (step === 1) stepText = '1ï¸âƒ£ Chá»n tá»« <strong>Gá»C (Infinitive)</strong>';
  if (step === 2) stepText = '2ï¸âƒ£ Chá»n tá»« <strong>SIMPLE PAST</strong>';
  if (step === 3) stepText = '3ï¸âƒ£ Chá»n tá»« <strong>PAST PARTICIPLE</strong>';
  
  var html = '<div class="progress-header" style="margin-bottom:10px">' +
    '<button class="back-btn" onclick="startTripleMatch()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ”— Triple Match</div>' +
    '<div style="color:white;font-weight:700">âœ“ ' + state.matched.length + '/' + state.level + '</div>' +
    '</div>' +
    
    '<div class="triple-hint-bar">' +
    '<span class="step ' + (step === 1 ? 'active' : (step > 1 ? 'done' : 'waiting')) + '">1. Gá»‘c</span>' +
    ' â†’ ' +
    '<span class="step ' + (step === 2 ? 'active' : (step > 2 ? 'done' : 'waiting')) + '">2. Simple Past</span>' +
    ' â†’ ' +
    '<span class="step ' + (step === 3 ? 'active' : 'waiting') + '">3. Past Participle</span>' +
    '</div>' +
    
    '<div class="triple-match-container">' +
    '<div class="triple-columns">' +
    
    // Infinitive column
    '<div class="triple-column">' +
    '<div class="triple-label inf">â˜€ï¸ Gá»‘c</div>';
  
  state.infCards.forEach(function(card) {
    var isMatched = state.matched.indexOf(card.index) >= 0;
    var isSelected = state.selectedInf === card.index;
    var cardClass = 'triple-card inf-card';
    if (isMatched) cardClass += ' matched';
    if (isSelected) cardClass += ' locked';
    
    html += '<div class="' + cardClass + '" id="inf-' + card.index + '" ' +
      (isMatched || isSelected ? '' : 'onclick="selectTripleInf(' + card.index + ')"') + '>' +
      '<div>' + card.verb.base + '</div>' +
      (state.showMeaning ? '<div class="card-meaning">' + card.verb.vn + '</div>' : '') +
      '</div>';
  });
  
  html += '</div>' +
    
    // Past column
    '<div class="triple-column">' +
    '<div class="triple-label past">ğŸŒ™ Simple Past</div>';
  
  state.pastCards.forEach(function(card) {
    var isMatched = state.matched.indexOf(card.index) >= 0;
    var isSelected = state.selectedPast === card.index;
    var cardClass = 'triple-card past-card';
    if (isMatched) cardClass += ' matched';
    if (isSelected) cardClass += ' locked';
    
    html += '<div class="' + cardClass + '" id="past-' + card.index + '" ' +
      (isMatched || isSelected ? '' : 'onclick="selectTriplePast(' + card.index + ')"') + '>' +
      '<div>' + card.verb.past + '</div>' +
      '</div>';
  });
  
  html += '</div>' +
    
    // Past Participle column
    '<div class="triple-column">' +
    '<div class="triple-label pp">âœ¨ Past Participle</div>';
  
  state.ppCards.forEach(function(card) {
    var isMatched = state.matched.indexOf(card.index) >= 0;
    var cardClass = 'triple-card pp-card';
    if (isMatched) cardClass += ' matched';
    
    html += '<div class="' + cardClass + '" id="pp-' + card.index + '" ' +
      (isMatched ? '' : 'onclick="selectTriplePP(' + card.index + ')"') + '>' +
      '<div>' + card.verb.pp + '</div>' +
      '</div>';
  });
  
  html += '</div></div>' +
    
    // Score section
    '<div class="triple-score-bar">' +
    '<div class="triple-progress-dots">';
  
  for (var i = 0; i < state.level; i++) {
    html += '<div class="triple-dot' + (i < state.matched.length ? ' done' : '') + '">' +
      (i < state.matched.length ? 'âœ“' : '') + '</div>';
  }
  
  html += '</div>' +
    '<div style="font-weight:700;color:#333">' + state.matched.length + ' / ' + state.level + '</div>' +
    '</div></div>';
  
  // Complete screen
  if (state.matched.length === state.level) {
    playSound('complete');
    showConfetti();
    
    html += '<div style="text-align:center;margin-top:20px">' +
      '<div style="font-size:50px;margin-bottom:10px">ğŸ†</div>' +
      '<div style="color:white;font-size:1.3rem;font-weight:700;margin-bottom:15px">Xuáº¥t sáº¯c! Con Ä‘Ã£ ghÃ©p Ä‘Ãºng háº¿t!</div>' +
      '<button class="next-btn" onclick="startTripleMatchGame(' + state.level + ')" style="margin-bottom:10px">ChÆ¡i láº¡i ğŸ”„</button>' +
      '<button class="next-btn" style="background:#F5F5F5;color:#333" onclick="startTripleMatch()">Äá»•i má»©c Ä‘á»™ ğŸ“Š</button>' +
      '</div>';
  }
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function selectTripleInf(index) {
  if (tripleMatchState.matched.indexOf(index) >= 0) return;
  if (tripleMatchState.selectedInf !== null) return; // Already selected
  
  playSound('click');
  tripleMatchState.selectedInf = index;
  renderTripleMatch();
}

function selectTriplePast(index) {
  if (tripleMatchState.selectedInf === null) {
    playSound('wrong');
    return; // Must select Inf first
  }
  if (tripleMatchState.matched.indexOf(index) >= 0) return;
  if (tripleMatchState.selectedPast !== null) return;
  
  // Check if correct
  if (index === tripleMatchState.selectedInf) {
    playSound('click');
    tripleMatchState.selectedPast = index;
    renderTripleMatch();
  } else {
    // Wrong - reset
    playSound('wrong');
    var el = document.getElementById('past-' + index);
    if (el) el.classList.add('wrong-flash');
    
    setTimeout(function() {
      tripleMatchState.selectedInf = null;
      tripleMatchState.selectedPast = null;
      renderTripleMatch();
    }, 600);
  }
}

function selectTriplePP(index) {
  if (tripleMatchState.selectedInf === null || tripleMatchState.selectedPast === null) {
    playSound('wrong');
    return;
  }
  if (tripleMatchState.matched.indexOf(index) >= 0) return;
  
  // Check if all 3 match
  if (index === tripleMatchState.selectedInf) {
    // Correct!
    playSound('correct');
    
    var infEl = document.getElementById('inf-' + tripleMatchState.selectedInf);
    var pastEl = document.getElementById('past-' + tripleMatchState.selectedPast);
    var ppEl = document.getElementById('pp-' + index);
    
    if (infEl) infEl.classList.add('correct-flash');
    if (pastEl) pastEl.classList.add('correct-flash');
    if (ppEl) ppEl.classList.add('correct-flash');
    
    setTimeout(function() {
      tripleMatchState.matched.push(index);
      tripleMatchState.selectedInf = null;
      tripleMatchState.selectedPast = null;
      renderTripleMatch();
    }, 600);
  } else {
    // Wrong - reset all
    playSound('wrong');
    var el = document.getElementById('pp-' + index);
    if (el) el.classList.add('wrong-flash');
    
    setTimeout(function() {
      tripleMatchState.selectedInf = null;
      tripleMatchState.selectedPast = null;
      renderTripleMatch();
    }, 600);
  }
}

// ============ VERB SENTENCE QUIZ ============
var sentenceQuizState = {
  questions: [],
  currentIndex: 0,
  score: 0,
  answered: false,
  level: 10
};

// Signal words for generating questions
var SIGNAL_WORDS = {
  present: [
    { signal: 'every day', vn: 'má»—i ngÃ y' },
    { signal: 'every morning', vn: 'má»—i sÃ¡ng' },
    { signal: 'every week', vn: 'má»—i tuáº§n' },
    { signal: 'always', vn: 'luÃ´n luÃ´n' },
    { signal: 'usually', vn: 'thÆ°á»ng' },
    { signal: 'often', vn: 'thÆ°á»ng xuyÃªn' },
    { signal: 'sometimes', vn: 'Ä‘Ã´i khi' }
  ],
  past: [
    { signal: 'yesterday', vn: 'hÃ´m qua' },
    { signal: 'last night', vn: 'tá»‘i qua' },
    { signal: 'last week', vn: 'tuáº§n trÆ°á»›c' },
    { signal: 'last month', vn: 'thÃ¡ng trÆ°á»›c' },
    { signal: 'last year', vn: 'nÄƒm ngoÃ¡i' },
    { signal: '2 days ago', vn: '2 ngÃ y trÆ°á»›c' },
    { signal: 'this morning', vn: 'sÃ¡ng nay' }
  ]
};

var SENTENCE_TEMPLATES = [
  // =============== AFFIRMATIVE (CÃ¢u kháº³ng Ä‘á»‹nh) ===============
  // GO
  { template: 'I ___ to school {signal}.', subject: 'I', verb: 'go', vn: 'TÃ´i Ä‘i há»c', type: 'affirm' },
  { template: 'She ___ to the park {signal}.', subject: 'She', verb: 'go', vn: 'CÃ´ áº¥y Ä‘i cÃ´ng viÃªn', type: 'affirm' },
  { template: 'They ___ shopping {signal}.', subject: 'They', verb: 'go', vn: 'Há» Ä‘i mua sáº¯m', type: 'affirm' },
  { template: 'We ___ to church {signal}.', subject: 'We', verb: 'go', vn: 'ChÃºng tÃ´i Ä‘i nhÃ  thá»', type: 'affirm' },
  
  // EAT
  { template: 'She ___ breakfast {signal}.', subject: 'She', verb: 'eat', vn: 'CÃ´ áº¥y Äƒn sÃ¡ng', type: 'affirm' },
  { template: 'I ___ lunch at school {signal}.', subject: 'I', verb: 'eat', vn: 'TÃ´i Äƒn trÆ°a á»Ÿ trÆ°á»ng', type: 'affirm' },
  { template: 'He ___ dinner with family {signal}.', subject: 'He', verb: 'eat', vn: 'Anh áº¥y Äƒn tá»‘i vá»›i gia Ä‘Ã¬nh', type: 'affirm' },
  { template: 'They ___ pizza {signal}.', subject: 'They', verb: 'eat', vn: 'Há» Äƒn pizza', type: 'affirm' },
  
  // READ
  { template: 'He ___ a book {signal}.', subject: 'He', verb: 'read', vn: 'Anh áº¥y Ä‘á»c sÃ¡ch', type: 'affirm' },
  { template: 'She ___ the newspaper {signal}.', subject: 'She', verb: 'read', vn: 'CÃ´ áº¥y Ä‘á»c bÃ¡o', type: 'affirm' },
  { template: 'I ___ comics {signal}.', subject: 'I', verb: 'read', vn: 'TÃ´i Ä‘á»c truyá»‡n tranh', type: 'affirm' },
  
  // MAKE
  { template: 'Mom ___ dinner {signal}.', subject: 'Mom', verb: 'make', vn: 'Máº¹ náº¥u bá»¯a tá»‘i', type: 'affirm' },
  { template: 'She ___ a cake {signal}.', subject: 'She', verb: 'make', vn: 'CÃ´ áº¥y lÃ m bÃ¡nh', type: 'affirm' },
  { template: 'I ___ my bed {signal}.', subject: 'I', verb: 'make', vn: 'TÃ´i dá»n giÆ°á»ng', type: 'affirm' },
  
  // DRINK
  { template: 'I ___ milk {signal}.', subject: 'I', verb: 'drink', vn: 'TÃ´i uá»‘ng sá»¯a', type: 'affirm' },
  { template: 'He ___ coffee {signal}.', subject: 'He', verb: 'drink', vn: 'Anh áº¥y uá»‘ng cÃ  phÃª', type: 'affirm' },
  { template: 'She ___ orange juice {signal}.', subject: 'She', verb: 'drink', vn: 'CÃ´ áº¥y uá»‘ng nÆ°á»›c cam', type: 'affirm' },
  
  // SING
  { template: 'He ___ a song {signal}.', subject: 'He', verb: 'sing', vn: 'Anh áº¥y hÃ¡t má»™t bÃ i', type: 'affirm' },
  { template: 'She ___ beautifully {signal}.', subject: 'She', verb: 'sing', vn: 'CÃ´ áº¥y hÃ¡t hay', type: 'affirm' },
  { template: 'They ___ together {signal}.', subject: 'They', verb: 'sing', vn: 'Há» hÃ¡t cÃ¹ng nhau', type: 'affirm' },
  
  // SWIM
  { template: 'They ___ in the pool {signal}.', subject: 'They', verb: 'swim', vn: 'Há» bÆ¡i trong há»“', type: 'affirm' },
  { template: 'I ___ at the beach {signal}.', subject: 'I', verb: 'swim', vn: 'TÃ´i bÆ¡i á»Ÿ biá»ƒn', type: 'affirm' },
  { template: 'He ___ very fast {signal}.', subject: 'He', verb: 'swim', vn: 'Anh áº¥y bÆ¡i ráº¥t nhanh', type: 'affirm' },
  
  // DO
  { template: 'I ___ my homework {signal}.', subject: 'I', verb: 'do', vn: 'TÃ´i lÃ m bÃ i táº­p', type: 'affirm' },
  { template: 'She ___ the dishes {signal}.', subject: 'She', verb: 'do', vn: 'CÃ´ áº¥y rá»­a bÃ¡t', type: 'affirm' },
  { template: 'They ___ exercise {signal}.', subject: 'They', verb: 'do', vn: 'Há» táº­p thá»ƒ dá»¥c', type: 'affirm' },
  
  // BUY
  { template: 'She ___ a new dress {signal}.', subject: 'She', verb: 'buy', vn: 'CÃ´ áº¥y mua vÃ¡y má»›i', type: 'affirm' },
  { template: 'I ___ some books {signal}.', subject: 'I', verb: 'buy', vn: 'TÃ´i mua vÃ i quyá»ƒn sÃ¡ch', type: 'affirm' },
  { template: 'He ___ a gift {signal}.', subject: 'He', verb: 'buy', vn: 'Anh áº¥y mua quÃ ', type: 'affirm' },
  
  // WRITE
  { template: 'We ___ a letter {signal}.', subject: 'We', verb: 'write', vn: 'ChÃºng tÃ´i viáº¿t thÆ°', type: 'affirm' },
  { template: 'She ___ in her diary {signal}.', subject: 'She', verb: 'write', vn: 'CÃ´ áº¥y viáº¿t nháº­t kÃ½', type: 'affirm' },
  { template: 'I ___ an email {signal}.', subject: 'I', verb: 'write', vn: 'TÃ´i viáº¿t email', type: 'affirm' },
  
  // MEET
  { template: 'I ___ my friend {signal}.', subject: 'I', verb: 'meet', vn: 'TÃ´i gáº·p báº¡n', type: 'affirm' },
  { template: 'She ___ her teacher {signal}.', subject: 'She', verb: 'meet', vn: 'CÃ´ áº¥y gáº·p cÃ´ giÃ¡o', type: 'affirm' },
  { template: 'They ___ at the cafe {signal}.', subject: 'They', verb: 'meet', vn: 'Há» gáº·p nhau á»Ÿ quÃ¡n', type: 'affirm' },
  
  // RUN
  { template: 'He ___ fast {signal}.', subject: 'He', verb: 'run', vn: 'Anh áº¥y cháº¡y nhanh', type: 'affirm' },
  { template: 'I ___ in the morning {signal}.', subject: 'I', verb: 'run', vn: 'TÃ´i cháº¡y buá»•i sÃ¡ng', type: 'affirm' },
  { template: 'They ___ in the park {signal}.', subject: 'They', verb: 'run', vn: 'Há» cháº¡y trong cÃ´ng viÃªn', type: 'affirm' },
  
  // GIVE
  { template: 'I ___ a gift to mom {signal}.', subject: 'I', verb: 'give', vn: 'TÃ´i táº·ng quÃ  cho máº¹', type: 'affirm' },
  { template: 'She ___ me a book {signal}.', subject: 'She', verb: 'give', vn: 'CÃ´ áº¥y cho tÃ´i sÃ¡ch', type: 'affirm' },
  { template: 'He ___ flowers to her {signal}.', subject: 'He', verb: 'give', vn: 'Anh áº¥y táº·ng hoa cho cÃ´ áº¥y', type: 'affirm' },
  
  // TAKE
  { template: 'She ___ the bus {signal}.', subject: 'She', verb: 'take', vn: 'CÃ´ áº¥y Ä‘i xe buÃ½t', type: 'affirm' },
  { template: 'I ___ a shower {signal}.', subject: 'I', verb: 'take', vn: 'TÃ´i táº¯m', type: 'affirm' },
  { template: 'He ___ photos {signal}.', subject: 'He', verb: 'take', vn: 'Anh áº¥y chá»¥p áº£nh', type: 'affirm' },
  
  // COME
  { template: 'We ___ home late {signal}.', subject: 'We', verb: 'come', vn: 'ChÃºng tÃ´i vá» nhÃ  muá»™n', type: 'affirm' },
  { template: 'She ___ to my house {signal}.', subject: 'She', verb: 'come', vn: 'CÃ´ áº¥y Ä‘áº¿n nhÃ  tÃ´i', type: 'affirm' },
  { template: 'They ___ to the party {signal}.', subject: 'They', verb: 'come', vn: 'Há» Ä‘áº¿n bá»¯a tiá»‡c', type: 'affirm' },
  
  // SEE
  { template: 'They ___ a movie {signal}.', subject: 'They', verb: 'see', vn: 'Há» xem phim', type: 'affirm' },
  { template: 'I ___ my grandma {signal}.', subject: 'I', verb: 'see', vn: 'TÃ´i gáº·p bÃ ', type: 'affirm' },
  { template: 'She ___ a bird {signal}.', subject: 'She', verb: 'see', vn: 'CÃ´ áº¥y nhÃ¬n tháº¥y con chim', type: 'affirm' },
  
  // SLEEP
  { template: 'I ___ early {signal}.', subject: 'I', verb: 'sleep', vn: 'TÃ´i ngá»§ sá»›m', type: 'affirm' },
  { template: 'She ___ late {signal}.', subject: 'She', verb: 'sleep', vn: 'CÃ´ áº¥y ngá»§ muá»™n', type: 'affirm' },
  { template: 'The baby ___ well {signal}.', subject: 'The baby', verb: 'sleep', vn: 'Em bÃ© ngá»§ ngon', type: 'affirm' },
  
  // HAVE
  { template: 'I ___ breakfast {signal}.', subject: 'I', verb: 'have', vn: 'TÃ´i Äƒn sÃ¡ng', type: 'affirm' },
  { template: 'She ___ a dog {signal}.', subject: 'She', verb: 'have', vn: 'CÃ´ áº¥y cÃ³ con chÃ³', type: 'affirm' },
  { template: 'We ___ a party {signal}.', subject: 'We', verb: 'have', vn: 'ChÃºng tÃ´i cÃ³ bá»¯a tiá»‡c', type: 'affirm' },
  
  // GET
  { template: 'I ___ a present {signal}.', subject: 'I', verb: 'get', vn: 'TÃ´i Ä‘Æ°á»£c quÃ ', type: 'affirm' },
  { template: 'She ___ good grades {signal}.', subject: 'She', verb: 'get', vn: 'CÃ´ áº¥y Ä‘Æ°á»£c Ä‘iá»ƒm cao', type: 'affirm' },
  { template: 'He ___ up early {signal}.', subject: 'He', verb: 'get', vn: 'Anh áº¥y dáº­y sá»›m', type: 'affirm' },
  
  // FEEL
  { template: 'I ___ happy {signal}.', subject: 'I', verb: 'feel', vn: 'TÃ´i cáº£m tháº¥y vui', type: 'affirm' },
  { template: 'She ___ tired {signal}.', subject: 'She', verb: 'feel', vn: 'CÃ´ áº¥y cáº£m tháº¥y má»‡t', type: 'affirm' },
  { template: 'He ___ sick {signal}.', subject: 'He', verb: 'feel', vn: 'Anh áº¥y cáº£m tháº¥y á»‘m', type: 'affirm' },
  
  // FIND
  { template: 'I ___ my keys {signal}.', subject: 'I', verb: 'find', vn: 'TÃ´i tÃ¬m tháº¥y chÃ¬a khÃ³a', type: 'affirm' },
  { template: 'She ___ a new job {signal}.', subject: 'She', verb: 'find', vn: 'CÃ´ áº¥y tÃ¬m Ä‘Æ°á»£c viá»‡c má»›i', type: 'affirm' },
  { template: 'He ___ the answer {signal}.', subject: 'He', verb: 'find', vn: 'Anh áº¥y tÃ¬m ra Ä‘Ã¡p Ã¡n', type: 'affirm' },
  
  // LOSE
  { template: 'He ___ his phone {signal}.', subject: 'He', verb: 'lose', vn: 'Anh áº¥y máº¥t Ä‘iá»‡n thoáº¡i', type: 'affirm' },
  { template: 'I ___ my wallet {signal}.', subject: 'I', verb: 'lose', vn: 'TÃ´i máº¥t vÃ­', type: 'affirm' },
  { template: 'She ___ her keys {signal}.', subject: 'She', verb: 'lose', vn: 'CÃ´ áº¥y máº¥t chÃ¬a khÃ³a', type: 'affirm' },
  
  // TEACH
  { template: 'She ___ English {signal}.', subject: 'She', verb: 'teach', vn: 'CÃ´ áº¥y dáº¡y tiáº¿ng Anh', type: 'affirm' },
  { template: 'He ___ me math {signal}.', subject: 'He', verb: 'teach', vn: 'Anh áº¥y dáº¡y tÃ´i toÃ¡n', type: 'affirm' },
  
  // THINK
  { template: 'I ___ about you {signal}.', subject: 'I', verb: 'think', vn: 'TÃ´i nghÄ© vá» báº¡n', type: 'affirm' },
  { template: 'She ___ hard {signal}.', subject: 'She', verb: 'think', vn: 'CÃ´ áº¥y suy nghÄ© nhiá»u', type: 'affirm' },
  
  // BRING
  { template: 'I ___ my book {signal}.', subject: 'I', verb: 'bring', vn: 'TÃ´i mang sÃ¡ch', type: 'affirm' },
  { template: 'She ___ food {signal}.', subject: 'She', verb: 'bring', vn: 'CÃ´ áº¥y mang Ä‘á»“ Äƒn', type: 'affirm' },
  
  // WIN
  { template: 'He ___ the game {signal}.', subject: 'He', verb: 'win', vn: 'Anh áº¥y tháº¯ng tráº­n', type: 'affirm' },
  { template: 'She ___ a prize {signal}.', subject: 'She', verb: 'win', vn: 'CÃ´ áº¥y tháº¯ng giáº£i', type: 'affirm' },
  
  // WEAR
  { template: 'She ___ a dress {signal}.', subject: 'She', verb: 'wear', vn: 'CÃ´ áº¥y máº·c vÃ¡y', type: 'affirm' },
  { template: 'He ___ a hat {signal}.', subject: 'He', verb: 'wear', vn: 'Anh áº¥y Ä‘á»™i mÅ©', type: 'affirm' },
  
  // =============== NEGATIVE (CÃ¢u phá»§ Ä‘á»‹nh) ===============
  // GO
  { template: 'I ___ go to school {signal}.', subject: 'I', verb: 'go', vn: 'TÃ´i khÃ´ng Ä‘i há»c', type: 'negative' },
  { template: 'She ___ go to the park {signal}.', subject: 'She', verb: 'go', vn: 'CÃ´ áº¥y khÃ´ng Ä‘i cÃ´ng viÃªn', type: 'negative' },
  { template: 'They ___ go shopping {signal}.', subject: 'They', verb: 'go', vn: 'Há» khÃ´ng Ä‘i mua sáº¯m', type: 'negative' },
  { template: 'He ___ go to work {signal}.', subject: 'He', verb: 'go', vn: 'Anh áº¥y khÃ´ng Ä‘i lÃ m', type: 'negative' },
  
  // EAT
  { template: 'She ___ eat breakfast {signal}.', subject: 'She', verb: 'eat', vn: 'CÃ´ áº¥y khÃ´ng Äƒn sÃ¡ng', type: 'negative' },
  { template: 'I ___ eat meat {signal}.', subject: 'I', verb: 'eat', vn: 'TÃ´i khÃ´ng Äƒn thá»‹t', type: 'negative' },
  { template: 'He ___ eat vegetables {signal}.', subject: 'He', verb: 'eat', vn: 'Anh áº¥y khÃ´ng Äƒn rau', type: 'negative' },
  { template: 'They ___ eat fast food {signal}.', subject: 'They', verb: 'eat', vn: 'Há» khÃ´ng Äƒn Ä‘á»“ Äƒn nhanh', type: 'negative' },
  
  // DRINK
  { template: 'I ___ drink coffee {signal}.', subject: 'I', verb: 'drink', vn: 'TÃ´i khÃ´ng uá»‘ng cÃ  phÃª', type: 'negative' },
  { template: 'She ___ drink soda {signal}.', subject: 'She', verb: 'drink', vn: 'CÃ´ áº¥y khÃ´ng uá»‘ng nÆ°á»›c ngá»t', type: 'negative' },
  { template: 'He ___ drink alcohol {signal}.', subject: 'He', verb: 'drink', vn: 'Anh áº¥y khÃ´ng uá»‘ng rÆ°á»£u', type: 'negative' },
  
  // DO
  { template: 'I ___ do my homework {signal}.', subject: 'I', verb: 'do', vn: 'TÃ´i khÃ´ng lÃ m bÃ i táº­p', type: 'negative' },
  { template: 'She ___ do the dishes {signal}.', subject: 'She', verb: 'do', vn: 'CÃ´ áº¥y khÃ´ng rá»­a bÃ¡t', type: 'negative' },
  { template: 'They ___ do exercise {signal}.', subject: 'They', verb: 'do', vn: 'Há» khÃ´ng táº­p thá»ƒ dá»¥c', type: 'negative' },
  
  // HAVE
  { template: 'I ___ have breakfast {signal}.', subject: 'I', verb: 'have', vn: 'TÃ´i khÃ´ng Äƒn sÃ¡ng', type: 'negative' },
  { template: 'She ___ have time {signal}.', subject: 'She', verb: 'have', vn: 'CÃ´ áº¥y khÃ´ng cÃ³ thá»i gian', type: 'negative' },
  { template: 'We ___ have money {signal}.', subject: 'We', verb: 'have', vn: 'ChÃºng tÃ´i khÃ´ng cÃ³ tiá»n', type: 'negative' },
  
  // SLEEP
  { template: 'I ___ sleep well {signal}.', subject: 'I', verb: 'sleep', vn: 'TÃ´i khÃ´ng ngá»§ ngon', type: 'negative' },
  { template: 'She ___ sleep late {signal}.', subject: 'She', verb: 'sleep', vn: 'CÃ´ áº¥y khÃ´ng ngá»§ muá»™n', type: 'negative' },
  { template: 'He ___ sleep enough {signal}.', subject: 'He', verb: 'sleep', vn: 'Anh áº¥y khÃ´ng ngá»§ Ä‘á»§', type: 'negative' },
  
  // COME
  { template: 'She ___ come to the party {signal}.', subject: 'She', verb: 'come', vn: 'CÃ´ áº¥y khÃ´ng Ä‘áº¿n tiá»‡c', type: 'negative' },
  { template: 'He ___ come home early {signal}.', subject: 'He', verb: 'come', vn: 'Anh áº¥y khÃ´ng vá» nhÃ  sá»›m', type: 'negative' },
  { template: 'They ___ come to school {signal}.', subject: 'They', verb: 'come', vn: 'Há» khÃ´ng Ä‘áº¿n trÆ°á»ng', type: 'negative' },
  
  // SEE
  { template: 'I ___ see the movie {signal}.', subject: 'I', verb: 'see', vn: 'TÃ´i khÃ´ng xem phim', type: 'negative' },
  { template: 'She ___ see him {signal}.', subject: 'She', verb: 'see', vn: 'CÃ´ áº¥y khÃ´ng gáº·p anh áº¥y', type: 'negative' },
  { template: 'They ___ see anything {signal}.', subject: 'They', verb: 'see', vn: 'Há» khÃ´ng tháº¥y gÃ¬', type: 'negative' },
  
  // KNOW
  { template: 'I ___ know the answer {signal}.', subject: 'I', verb: 'know', vn: 'TÃ´i khÃ´ng biáº¿t cÃ¢u tráº£ lá»i', type: 'negative' },
  { template: 'She ___ know him {signal}.', subject: 'She', verb: 'know', vn: 'CÃ´ áº¥y khÃ´ng biáº¿t anh áº¥y', type: 'negative' },
  { template: 'They ___ know the way {signal}.', subject: 'They', verb: 'know', vn: 'Há» khÃ´ng biáº¿t Ä‘Æ°á»ng', type: 'negative' },
  
  // MAKE
  { template: 'I ___ make mistakes {signal}.', subject: 'I', verb: 'make', vn: 'TÃ´i khÃ´ng máº¯c lá»—i', type: 'negative' },
  { template: 'She ___ make dinner {signal}.', subject: 'She', verb: 'make', vn: 'CÃ´ áº¥y khÃ´ng náº¥u bá»¯a tá»‘i', type: 'negative' },
  { template: 'He ___ make noise {signal}.', subject: 'He', verb: 'make', vn: 'Anh áº¥y khÃ´ng lÃ m á»“n', type: 'negative' },
  
  // TAKE
  { template: 'I ___ take the bus {signal}.', subject: 'I', verb: 'take', vn: 'TÃ´i khÃ´ng Ä‘i xe buÃ½t', type: 'negative' },
  { template: 'She ___ take photos {signal}.', subject: 'She', verb: 'take', vn: 'CÃ´ áº¥y khÃ´ng chá»¥p áº£nh', type: 'negative' },
  { template: 'He ___ take a break {signal}.', subject: 'He', verb: 'take', vn: 'Anh áº¥y khÃ´ng nghá»‰ ngÆ¡i', type: 'negative' },
  
  // WRITE
  { template: 'I ___ write letters {signal}.', subject: 'I', verb: 'write', vn: 'TÃ´i khÃ´ng viáº¿t thÆ°', type: 'negative' },
  { template: 'She ___ write emails {signal}.', subject: 'She', verb: 'write', vn: 'CÃ´ áº¥y khÃ´ng viáº¿t email', type: 'negative' },
  
  // READ
  { template: 'I ___ read books {signal}.', subject: 'I', verb: 'read', vn: 'TÃ´i khÃ´ng Ä‘á»c sÃ¡ch', type: 'negative' },
  { template: 'He ___ read newspapers {signal}.', subject: 'He', verb: 'read', vn: 'Anh áº¥y khÃ´ng Ä‘á»c bÃ¡o', type: 'negative' },
  
  // SPEAK
  { template: 'I ___ speak French {signal}.', subject: 'I', verb: 'speak', vn: 'TÃ´i khÃ´ng nÃ³i tiáº¿ng PhÃ¡p', type: 'negative' },
  { template: 'She ___ speak loudly {signal}.', subject: 'She', verb: 'speak', vn: 'CÃ´ áº¥y khÃ´ng nÃ³i to', type: 'negative' },
  
  // BUY
  { template: 'I ___ buy expensive things {signal}.', subject: 'I', verb: 'buy', vn: 'TÃ´i khÃ´ng mua Ä‘á»“ Ä‘áº¯t', type: 'negative' },
  { template: 'She ___ buy clothes {signal}.', subject: 'She', verb: 'buy', vn: 'CÃ´ áº¥y khÃ´ng mua quáº§n Ã¡o', type: 'negative' },
  
  // GIVE
  { template: 'I ___ give up {signal}.', subject: 'I', verb: 'give', vn: 'TÃ´i khÃ´ng bá» cuá»™c', type: 'negative' },
  { template: 'She ___ give money {signal}.', subject: 'She', verb: 'give', vn: 'CÃ´ áº¥y khÃ´ng cho tiá»n', type: 'negative' },
  
  // FIND
  { template: 'I ___ find my keys {signal}.', subject: 'I', verb: 'find', vn: 'TÃ´i khÃ´ng tÃ¬m tháº¥y chÃ¬a khÃ³a', type: 'negative' },
  { template: 'She ___ find the answer {signal}.', subject: 'She', verb: 'find', vn: 'CÃ´ áº¥y khÃ´ng tÃ¬m ra Ä‘Ã¡p Ã¡n', type: 'negative' },
  
  // FEEL
  { template: 'I ___ feel good {signal}.', subject: 'I', verb: 'feel', vn: 'TÃ´i khÃ´ng cáº£m tháº¥y tá»‘t', type: 'negative' },
  { template: 'She ___ feel tired {signal}.', subject: 'She', verb: 'feel', vn: 'CÃ´ áº¥y khÃ´ng tháº¥y má»‡t', type: 'negative' },
  
  // WIN
  { template: 'We ___ win the game {signal}.', subject: 'We', verb: 'win', vn: 'ChÃºng tÃ´i khÃ´ng tháº¯ng', type: 'negative' },
  { template: 'He ___ win the match {signal}.', subject: 'He', verb: 'win', vn: 'Anh áº¥y khÃ´ng tháº¯ng tráº­n', type: 'negative' },
  
  // =============== QUESTION (CÃ¢u há»i) ===============
  // GO
  { template: '___ you go to school {signal}?', subject: 'you', verb: 'go', vn: 'Báº¡n cÃ³ Ä‘i há»c khÃ´ng?', type: 'question' },
  { template: '___ she go to the park {signal}?', subject: 'she', verb: 'go', vn: 'CÃ´ áº¥y cÃ³ Ä‘i cÃ´ng viÃªn khÃ´ng?', type: 'question' },
  { template: '___ they go shopping {signal}?', subject: 'they', verb: 'go', vn: 'Há» cÃ³ Ä‘i mua sáº¯m khÃ´ng?', type: 'question' },
  { template: '___ he go to work {signal}?', subject: 'he', verb: 'go', vn: 'Anh áº¥y cÃ³ Ä‘i lÃ m khÃ´ng?', type: 'question' },
  
  // EAT
  { template: '___ she eat breakfast {signal}?', subject: 'she', verb: 'eat', vn: 'CÃ´ áº¥y cÃ³ Äƒn sÃ¡ng khÃ´ng?', type: 'question' },
  { template: '___ you eat lunch {signal}?', subject: 'you', verb: 'eat', vn: 'Báº¡n cÃ³ Äƒn trÆ°a khÃ´ng?', type: 'question' },
  { template: '___ he eat dinner {signal}?', subject: 'he', verb: 'eat', vn: 'Anh áº¥y cÃ³ Äƒn tá»‘i khÃ´ng?', type: 'question' },
  { template: '___ they eat pizza {signal}?', subject: 'they', verb: 'eat', vn: 'Há» cÃ³ Äƒn pizza khÃ´ng?', type: 'question' },
  
  // DRINK
  { template: '___ you drink milk {signal}?', subject: 'you', verb: 'drink', vn: 'Báº¡n cÃ³ uá»‘ng sá»¯a khÃ´ng?', type: 'question' },
  { template: '___ she drink coffee {signal}?', subject: 'she', verb: 'drink', vn: 'CÃ´ áº¥y cÃ³ uá»‘ng cÃ  phÃª khÃ´ng?', type: 'question' },
  { template: '___ he drink tea {signal}?', subject: 'he', verb: 'drink', vn: 'Anh áº¥y cÃ³ uá»‘ng trÃ  khÃ´ng?', type: 'question' },
  
  // DO
  { template: '___ you do homework {signal}?', subject: 'you', verb: 'do', vn: 'Báº¡n cÃ³ lÃ m bÃ i táº­p khÃ´ng?', type: 'question' },
  { template: '___ she do exercise {signal}?', subject: 'she', verb: 'do', vn: 'CÃ´ áº¥y cÃ³ táº­p thá»ƒ dá»¥c khÃ´ng?', type: 'question' },
  { template: '___ they do the dishes {signal}?', subject: 'they', verb: 'do', vn: 'Há» cÃ³ rá»­a bÃ¡t khÃ´ng?', type: 'question' },
  
  // HAVE
  { template: '___ you have breakfast {signal}?', subject: 'you', verb: 'have', vn: 'Báº¡n cÃ³ Äƒn sÃ¡ng khÃ´ng?', type: 'question' },
  { template: '___ she have a car {signal}?', subject: 'she', verb: 'have', vn: 'CÃ´ áº¥y cÃ³ xe hÆ¡i khÃ´ng?', type: 'question' },
  { template: '___ they have fun {signal}?', subject: 'they', verb: 'have', vn: 'Há» cÃ³ vui khÃ´ng?', type: 'question' },
  
  // SLEEP
  { template: '___ you sleep well {signal}?', subject: 'you', verb: 'sleep', vn: 'Báº¡n cÃ³ ngá»§ ngon khÃ´ng?', type: 'question' },
  { template: '___ she sleep early {signal}?', subject: 'she', verb: 'sleep', vn: 'CÃ´ áº¥y cÃ³ ngá»§ sá»›m khÃ´ng?', type: 'question' },
  { template: '___ he sleep late {signal}?', subject: 'he', verb: 'sleep', vn: 'Anh áº¥y cÃ³ ngá»§ muá»™n khÃ´ng?', type: 'question' },
  
  // COME
  { template: '___ she come to the party {signal}?', subject: 'she', verb: 'come', vn: 'CÃ´ áº¥y cÃ³ Ä‘áº¿n tiá»‡c khÃ´ng?', type: 'question' },
  { template: '___ he come home early {signal}?', subject: 'he', verb: 'come', vn: 'Anh áº¥y cÃ³ vá» sá»›m khÃ´ng?', type: 'question' },
  { template: '___ they come to school {signal}?', subject: 'they', verb: 'come', vn: 'Há» cÃ³ Ä‘áº¿n trÆ°á»ng khÃ´ng?', type: 'question' },
  
  // SEE
  { template: '___ you see the movie {signal}?', subject: 'you', verb: 'see', vn: 'Báº¡n cÃ³ xem phim khÃ´ng?', type: 'question' },
  { template: '___ she see him {signal}?', subject: 'she', verb: 'see', vn: 'CÃ´ áº¥y cÃ³ gáº·p anh áº¥y khÃ´ng?', type: 'question' },
  { template: '___ they see the show {signal}?', subject: 'they', verb: 'see', vn: 'Há» cÃ³ xem show khÃ´ng?', type: 'question' },
  
  // KNOW
  { template: '___ you know the answer {signal}?', subject: 'you', verb: 'know', vn: 'Báº¡n cÃ³ biáº¿t cÃ¢u tráº£ lá»i khÃ´ng?', type: 'question' },
  { template: '___ she know him {signal}?', subject: 'she', verb: 'know', vn: 'CÃ´ áº¥y cÃ³ biáº¿t anh áº¥y khÃ´ng?', type: 'question' },
  { template: '___ they know the truth {signal}?', subject: 'they', verb: 'know', vn: 'Há» cÃ³ biáº¿t sá»± tháº­t khÃ´ng?', type: 'question' },
  
  // MAKE
  { template: '___ you make dinner {signal}?', subject: 'you', verb: 'make', vn: 'Báº¡n cÃ³ náº¥u bá»¯a tá»‘i khÃ´ng?', type: 'question' },
  { template: '___ she make a cake {signal}?', subject: 'she', verb: 'make', vn: 'CÃ´ áº¥y cÃ³ lÃ m bÃ¡nh khÃ´ng?', type: 'question' },
  { template: '___ he make mistakes {signal}?', subject: 'he', verb: 'make', vn: 'Anh áº¥y cÃ³ máº¯c lá»—i khÃ´ng?', type: 'question' },
  
  // TAKE
  { template: '___ you take the bus {signal}?', subject: 'you', verb: 'take', vn: 'Báº¡n cÃ³ Ä‘i xe buÃ½t khÃ´ng?', type: 'question' },
  { template: '___ she take photos {signal}?', subject: 'she', verb: 'take', vn: 'CÃ´ áº¥y cÃ³ chá»¥p áº£nh khÃ´ng?', type: 'question' },
  { template: '___ he take a shower {signal}?', subject: 'he', verb: 'take', vn: 'Anh áº¥y cÃ³ táº¯m khÃ´ng?', type: 'question' },
  
  // WRITE
  { template: '___ you write a letter {signal}?', subject: 'you', verb: 'write', vn: 'Báº¡n cÃ³ viáº¿t thÆ° khÃ´ng?', type: 'question' },
  { template: '___ she write emails {signal}?', subject: 'she', verb: 'write', vn: 'CÃ´ áº¥y cÃ³ viáº¿t email khÃ´ng?', type: 'question' },
  
  // READ
  { template: '___ you read books {signal}?', subject: 'you', verb: 'read', vn: 'Báº¡n cÃ³ Ä‘á»c sÃ¡ch khÃ´ng?', type: 'question' },
  { template: '___ he read newspapers {signal}?', subject: 'he', verb: 'read', vn: 'Anh áº¥y cÃ³ Ä‘á»c bÃ¡o khÃ´ng?', type: 'question' },
  
  // SPEAK
  { template: '___ you speak English {signal}?', subject: 'you', verb: 'speak', vn: 'Báº¡n cÃ³ nÃ³i tiáº¿ng Anh khÃ´ng?', type: 'question' },
  { template: '___ she speak French {signal}?', subject: 'she', verb: 'speak', vn: 'CÃ´ áº¥y cÃ³ nÃ³i tiáº¿ng PhÃ¡p khÃ´ng?', type: 'question' },
  
  // BUY
  { template: '___ you buy a gift {signal}?', subject: 'you', verb: 'buy', vn: 'Báº¡n cÃ³ mua quÃ  khÃ´ng?', type: 'question' },
  { template: '___ she buy clothes {signal}?', subject: 'she', verb: 'buy', vn: 'CÃ´ áº¥y cÃ³ mua quáº§n Ã¡o khÃ´ng?', type: 'question' },
  
  // GIVE
  { template: '___ you give him money {signal}?', subject: 'you', verb: 'give', vn: 'Báº¡n cÃ³ cho anh áº¥y tiá»n khÃ´ng?', type: 'question' },
  { template: '___ she give a present {signal}?', subject: 'she', verb: 'give', vn: 'CÃ´ áº¥y cÃ³ táº·ng quÃ  khÃ´ng?', type: 'question' },
  
  // MEET
  { template: '___ you meet her {signal}?', subject: 'you', verb: 'meet', vn: 'Báº¡n cÃ³ gáº·p cÃ´ áº¥y khÃ´ng?', type: 'question' },
  { template: '___ they meet at school {signal}?', subject: 'they', verb: 'meet', vn: 'Há» cÃ³ gáº·p nhau á»Ÿ trÆ°á»ng khÃ´ng?', type: 'question' },
  
  // RUN
  { template: '___ you run in the morning {signal}?', subject: 'you', verb: 'run', vn: 'Báº¡n cÃ³ cháº¡y buá»•i sÃ¡ng khÃ´ng?', type: 'question' },
  { template: '___ he run fast {signal}?', subject: 'he', verb: 'run', vn: 'Anh áº¥y cÃ³ cháº¡y nhanh khÃ´ng?', type: 'question' },
  
  // SWIM
  { template: '___ you swim {signal}?', subject: 'you', verb: 'swim', vn: 'Báº¡n cÃ³ bÆ¡i khÃ´ng?', type: 'question' },
  { template: '___ she swim well {signal}?', subject: 'she', verb: 'swim', vn: 'CÃ´ áº¥y cÃ³ bÆ¡i giá»i khÃ´ng?', type: 'question' },
  
  // SING
  { template: '___ you sing songs {signal}?', subject: 'you', verb: 'sing', vn: 'Báº¡n cÃ³ hÃ¡t khÃ´ng?', type: 'question' },
  { template: '___ she sing well {signal}?', subject: 'she', verb: 'sing', vn: 'CÃ´ áº¥y cÃ³ hÃ¡t hay khÃ´ng?', type: 'question' },
  
  // WIN
  { template: '___ you win the game {signal}?', subject: 'you', verb: 'win', vn: 'Báº¡n cÃ³ tháº¯ng khÃ´ng?', type: 'question' },
  { template: '___ they win the match {signal}?', subject: 'they', verb: 'win', vn: 'Há» cÃ³ tháº¯ng tráº­n khÃ´ng?', type: 'question' },
  
  // FEEL
  { template: '___ you feel better {signal}?', subject: 'you', verb: 'feel', vn: 'Báº¡n cÃ³ tháº¥y khá»e hÆ¡n khÃ´ng?', type: 'question' },
  { template: '___ she feel happy {signal}?', subject: 'she', verb: 'feel', vn: 'CÃ´ áº¥y cÃ³ tháº¥y vui khÃ´ng?', type: 'question' },
  
  // FIND
  { template: '___ you find your keys {signal}?', subject: 'you', verb: 'find', vn: 'Báº¡n cÃ³ tÃ¬m tháº¥y chÃ¬a khÃ³a khÃ´ng?', type: 'question' },
  { template: '___ she find the answer {signal}?', subject: 'she', verb: 'find', vn: 'CÃ´ áº¥y cÃ³ tÃ¬m ra Ä‘Ã¡p Ã¡n khÃ´ng?', type: 'question' },
  
  // THINK
  { template: '___ you think about it {signal}?', subject: 'you', verb: 'think', vn: 'Báº¡n cÃ³ nghÄ© vá» nÃ³ khÃ´ng?', type: 'question' },
  { template: '___ she think it was good {signal}?', subject: 'she', verb: 'think', vn: 'CÃ´ áº¥y cÃ³ nghÄ© nÃ³ tá»‘t khÃ´ng?', type: 'question' },
  
  // BRING
  { template: '___ you bring your book {signal}?', subject: 'you', verb: 'bring', vn: 'Báº¡n cÃ³ mang sÃ¡ch khÃ´ng?', type: 'question' },
  { template: '___ she bring food {signal}?', subject: 'she', verb: 'bring', vn: 'CÃ´ áº¥y cÃ³ mang Ä‘á»“ Äƒn khÃ´ng?', type: 'question' }
];

function getVerbForms(verbBase) {
  // Find verb in IRREGULAR_VERBS
  for (var i = 0; i < IRREGULAR_VERBS.groups.length; i++) {
    var group = IRREGULAR_VERBS.groups[i];
    for (var j = 0; j < group.verbs.length; j++) {
      var v = group.verbs[j];
      if (v.base === verbBase) {
        return { base: v.base, past: v.past, vn: v.vn };
      }
    }
  }
  // Regular verb fallback
  return { base: verbBase, past: verbBase + 'ed', vn: '' };
}

function getPresentForm(verb, subject) {
  // Add 's' for he/she/it/singular nouns
  var thirdPerson = ['he', 'she', 'it', 'mom', 'dad', 'tom', 'lily'];
  if (thirdPerson.indexOf(subject.toLowerCase()) >= 0) {
    if (verb === 'go' || verb === 'do') return verb + 'es';
    if (verb === 'watch') return 'watches';
    if (verb.endsWith('y')) return verb.slice(0, -1) + 'ies';
    return verb + 's';
  }
  return verb;
}

function generateQuizQuestions(count) {
  var questions = [];
  var usedTemplates = [];
  
  // Get all verbs for wrong answers
  var allVerbs = [];
  IRREGULAR_VERBS.groups.forEach(function(group) {
    group.verbs.forEach(function(verb) {
      allVerbs.push(verb);
    });
  });
  
  for (var i = 0; i < count; i++) {
    // Pick random template
    var templateIndex;
    do {
      templateIndex = Math.floor(Math.random() * SENTENCE_TEMPLATES.length);
    } while (usedTemplates.indexOf(templateIndex) >= 0 && usedTemplates.length < SENTENCE_TEMPLATES.length);
    usedTemplates.push(templateIndex);
    
    var template = SENTENCE_TEMPLATES[templateIndex];
    var verbForms = getVerbForms(template.verb);
    var sentenceType = template.type || 'affirm';
    
    // Randomly choose present or past
    var isPast = Math.random() > 0.5;
    var signalList = isPast ? SIGNAL_WORDS.past : SIGNAL_WORDS.present;
    var signalObj = signalList[Math.floor(Math.random() * signalList.length)];
    
    var correctAnswer, wrongAnswers = [];
    var subject = template.subject.toLowerCase();
    var isThirdPerson = ['he', 'she', 'it', 'mom', 'dad', 'the baby', 'the bird', 'the tree', 'the class'].indexOf(subject) >= 0;
    
    if (sentenceType === 'affirm') {
      // CÃ¢u kháº³ng Ä‘á»‹nh: Ä‘iá»n Ä‘á»™ng tá»«
      correctAnswer = isPast ? verbForms.past : getPresentForm(verbForms.base, template.subject);
      
      // Wrong answers
      var opposite = isPast ? getPresentForm(verbForms.base, template.subject) : verbForms.past;
      if (opposite !== correctAnswer) wrongAnswers.push(opposite);
      
    } else if (sentenceType === 'negative') {
      // CÃ¢u phá»§ Ä‘á»‹nh: Ä‘iá»n don't/doesn't/didn't
      if (isPast) {
        correctAnswer = "didn't";
        wrongAnswers = ["don't", "doesn't", "isn't"];
      } else {
        correctAnswer = isThirdPerson ? "doesn't" : "don't";
        wrongAnswers = isThirdPerson ? ["don't", "didn't", "isn't"] : ["doesn't", "didn't", "aren't"];
      }
      
    } else if (sentenceType === 'question') {
      // CÃ¢u há»i: Ä‘iá»n Do/Does/Did
      if (isPast) {
        correctAnswer = "Did";
        wrongAnswers = ["Do", "Does", "Is"];
      } else {
        correctAnswer = isThirdPerson ? "Does" : "Do";
        wrongAnswers = isThirdPerson ? ["Do", "Did", "Is"] : ["Does", "Did", "Are"];
      }
    }
    
    // Add more wrong answers from other verbs if needed (for affirm type)
    if (sentenceType === 'affirm') {
      var shuffledVerbs = shuffle(allVerbs);
      for (var j = 0; j < shuffledVerbs.length && wrongAnswers.length < 3; j++) {
        var wrongVerb = shuffledVerbs[j];
        if (wrongVerb.base !== template.verb) {
          var wrongForm = isPast ? wrongVerb.past : getPresentForm(wrongVerb.base, template.subject);
          if (wrongForm !== correctAnswer && wrongAnswers.indexOf(wrongForm) < 0) {
            wrongAnswers.push(wrongForm);
          }
        }
      }
    }
    
    // Ensure we have 3 wrong answers
    while (wrongAnswers.length < 3) {
      wrongAnswers.push(verbForms.base + 'ed');
    }
    
    var sentence = template.template.replace('{signal}', signalObj.signal);
    
    questions.push({
      sentence: sentence,
      sentenceVn: template.vn,
      signal: signalObj.signal,
      signalVn: signalObj.vn,
      isPast: isPast,
      verb: verbForms.base,
      verbVn: verbForms.vn,
      correctAnswer: correctAnswer,
      wrongAnswers: wrongAnswers.slice(0, 3),
      subject: template.subject,
      type: sentenceType
    });
  }
  
  return shuffle(questions);
}

function startVerbSentenceQuiz() {
  playSound('click');
  
  var html = '<div class="progress-header" style="margin-bottom:15px">' +
    '<button class="back-btn" onclick="showLearnScreen()">â† Back</button>' +
    '<div style="color:white;font-weight:700;font-size:1.1rem">ğŸ“ Tráº¯c nghiá»‡m</div>' +
    '<div></div></div>' +
    
    '<div class="easy-match-container">' +
    '<div class="easy-match-header">' +
    '<div style="font-size:50px;margin-bottom:10px">ğŸ“</div>' +
    '<div class="easy-match-title">Tráº¯c nghiá»‡m Ä‘á»™ng tá»«</div>' +
    '<div class="easy-match-hint">Chá»n dáº¡ng Ä‘Ãºng cá»§a Ä‘á»™ng tá»« trong cÃ¢u</div>' +
    '</div>' +
    
    '<div class="study-tip-box" style="margin:20px 0">' +
    '<div class="study-tip-icon">ğŸ’¡</div>' +
    '<div class="study-tip-text">' +
    '<strong>Máº¹o:</strong> NhÃ¬n dáº¥u hiá»‡u thá»i gian!<br>' +
    'â˜€ï¸ <strong>every day, always, usually</strong> â†’ dÃ¹ng hiá»‡n táº¡i<br>' +
    'ğŸŒ™ <strong>yesterday, last week, ...ago</strong> â†’ dÃ¹ng quÃ¡ khá»©' +
    '</div></div>' +
    
    '<div class="easy-match-level-select">' +
    '<div class="easy-match-level easy" onclick="startSentenceQuizGame(5)">' +
    '<div class="level-icon">ğŸŒ±</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Nhanh</div>' +
    '<div class="level-desc">5 cÃ¢u há»i</div>' +
    '</div></div>' +
    
    '<div class="easy-match-level medium" onclick="startSentenceQuizGame(10)">' +
    '<div class="level-icon">ğŸŒ¿</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Vá»«a pháº£i</div>' +
    '<div class="level-desc">10 cÃ¢u há»i</div>' +
    '</div></div>' +
    
    '<div class="easy-match-level hard" onclick="startSentenceQuizGame(15)">' +
    '<div class="level-icon">ğŸŒ³</div>' +
    '<div class="level-info">' +
    '<div class="level-name">Thá»­ thÃ¡ch</div>' +
    '<div class="level-desc">15 cÃ¢u há»i</div>' +
    '</div></div>' +
    '</div></div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function startSentenceQuizGame(count) {
  playSound('click');
  
  sentenceQuizState = {
    questions: generateQuizQuestions(count),
    currentIndex: 0,
    score: 0,
    answered: false,
    level: count
  };
  
  renderSentenceQuiz();
}

function renderSentenceQuiz() {
  var state = sentenceQuizState;
  
  if (state.currentIndex >= state.questions.length) {
    showSentenceQuizResult();
    return;
  }
  
  var q = state.questions[state.currentIndex];
  
  // Progress dots
  var dotsHtml = '';
  for (var i = 0; i < state.level; i++) {
    var dotClass = 'dot';
    if (i < state.currentIndex) dotClass += ' done';
    else if (i === state.currentIndex) dotClass += ' active';
    dotsHtml += '<div class="' + dotClass + '"></div>';
  }
  
  // Underline the signal word in sentence
  var displaySentence = q.sentence.replace(q.signal, '<u style="text-decoration:underline;text-decoration-color:#FF9800;text-decoration-thickness:2px;font-weight:700">' + q.signal + '</u>');
  displaySentence = displaySentence.replace('___', '<span class="blank">?</span>');
  
  var html = '<div class="progress-header">' +
    '<button class="back-btn" onclick="startVerbSentenceQuiz()">â† Back</button>' +
    '<div class="progress-dots">' + dotsHtml + '</div>' +
    '<div class="star-count">â­ ' + state.score + '</div>' +
    '</div>' +
    
    '<div class="sentence-quiz-card">' +
    
    // Sentence with blank and underlined signal
    '<div class="sentence-quiz-sentence">' +
    displaySentence +
    '</div>' +
    
    // Sentence meaning
    '<div class="sentence-quiz-meaning">' +
    'ğŸ“– ' + q.sentenceVn +
    '</div>' +
    
    // 4 Choices
    '<div class="sentence-quiz-choices">';
  
  // Create array with 1 correct + 3 wrong, then shuffle
  var allChoices = [
    { answer: q.correctAnswer, isCorrect: true }
  ];
  q.wrongAnswers.forEach(function(wrong) {
    allChoices.push({ answer: wrong, isCorrect: false });
  });
  allChoices = shuffle(allChoices);
  
  // Store correct index for later
  var correctIdx = -1;
  allChoices.forEach(function(choice, idx) {
    if (choice.isCorrect) correctIdx = idx;
    html += '<button class="sentence-choice-btn" id="choice-' + idx + '" ' +
      'onclick="checkSentenceAnswer(' + idx + ', ' + choice.isCorrect + ', ' + correctIdx + ')">' +
      choice.answer +
      '</button>';
  });
  
  // Store correct index in state for feedback
  sentenceQuizState.correctIdx = correctIdx;
  
  html += '</div>' +
    '<div id="sentenceFeedback"></div>' +
    '</div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

function checkSentenceAnswer(choiceIdx, isCorrect) {
  if (sentenceQuizState.answered) return;
  sentenceQuizState.answered = true;
  
  var q = sentenceQuizState.questions[sentenceQuizState.currentIndex];
  var correctIdx = sentenceQuizState.correctIdx;
  
  // Highlight all buttons
  document.querySelectorAll('.sentence-choice-btn').forEach(function(btn, idx) {
    btn.disabled = true;
    if (idx === choiceIdx && isCorrect) {
      btn.classList.add('correct');
    } else if (idx === choiceIdx && !isCorrect) {
      btn.classList.add('wrong');
    }
    if (idx === correctIdx && !isCorrect) {
      btn.classList.add('show-correct');
    }
  });
  
  if (isCorrect) {
    sentenceQuizState.score++;
    playSound('correct');
  } else {
    playSound('wrong');
  }
  
  // Explanation based on type
  var explanation = '';
  if (q.type === 'affirm') {
    explanation = q.isPast ? 
      'ğŸŒ™ <strong>' + q.signal + '</strong> â†’ dÃ¹ng Simple Past: <strong>' + q.correctAnswer + '</strong>' :
      'â˜€ï¸ <strong>' + q.signal + '</strong> â†’ dÃ¹ng hiá»‡n táº¡i: <strong>' + q.correctAnswer + '</strong>';
  } else if (q.type === 'negative') {
    explanation = q.isPast ?
      'ğŸš«ğŸŒ™ Phá»§ Ä‘á»‹nh quÃ¡ khá»© â†’ <strong>didn\'t</strong> + Ä‘á»™ng tá»« gá»‘c' :
      'ğŸš«â˜€ï¸ Phá»§ Ä‘á»‹nh hiá»‡n táº¡i â†’ <strong>' + q.correctAnswer + '</strong> + Ä‘á»™ng tá»« gá»‘c';
  } else if (q.type === 'question') {
    explanation = q.isPast ?
      'â“ğŸŒ™ CÃ¢u há»i quÃ¡ khá»© â†’ <strong>Did</strong> + S + Ä‘á»™ng tá»« gá»‘c?' :
      'â“â˜€ï¸ CÃ¢u há»i hiá»‡n táº¡i â†’ <strong>' + q.correctAnswer + '</strong> + S + Ä‘á»™ng tá»« gá»‘c?';
  }
  
  var feedbackHtml = '<div class="sentence-feedback ' + (isCorrect ? 'correct' : 'wrong') + '">' +
    '<div class="emoji">' + (isCorrect ? 'ğŸ‰' : 'ğŸ’ª') + '</div>' +
    '<div class="message">' + (isCorrect ? 'ChÃ­nh xÃ¡c!' : 'ChÆ°a Ä‘Ãºng rá»“i!') + '</div>' +
    '<div class="explanation">' + explanation + '</div>' +
    '<button class="next-btn" onclick="nextSentenceQuestion()">' +
    (sentenceQuizState.currentIndex < sentenceQuizState.level - 1 ? 'Tiáº¿p theo â†’' : 'Xem káº¿t quáº£ ğŸ†') +
    '</button>' +
    '</div>';
  
  document.getElementById('sentenceFeedback').innerHTML = feedbackHtml;
  
  if (isCorrect && sentenceQuizState.score % 3 === 0) {
    showConfetti();
  }
}

function nextSentenceQuestion() {
  sentenceQuizState.currentIndex++;
  sentenceQuizState.answered = false;
  renderSentenceQuiz();
}

function showSentenceQuizResult() {
  var state = sentenceQuizState;
  var percentage = Math.round((state.score / state.level) * 100);
  
  var emoji, message;
  if (percentage >= 90) { emoji = 'ğŸ†'; message = 'Xuáº¥t sáº¯c! Con giá»i láº¯m!'; }
  else if (percentage >= 70) { emoji = 'â­'; message = 'Tá»‘t láº¯m! Tiáº¿p tá»¥c cá»‘ gáº¯ng!'; }
  else if (percentage >= 50) { emoji = 'ğŸ’ª'; message = 'KhÃ¡ rá»“i! Ã”n thÃªm nhÃ©!'; }
  else { emoji = 'ğŸ“š'; message = 'Cáº§n Ã´n láº¡i nhiá»u hÆ¡n nha!'; }
  
  playSound('complete');
  if (percentage >= 70) showConfetti();
  
  var starsHtml = '';
  var starCount = percentage >= 90 ? 3 : percentage >= 70 ? 2 : percentage >= 50 ? 1 : 0;
  for (var i = 0; i < 3; i++) {
    starsHtml += i < starCount ? 'â­' : 'â˜†';
  }
  
  var html = '<div class="result-content">' +
    '<div class="result-card">' +
    '<div class="result-emoji">' + emoji + '</div>' +
    '<div class="result-title">' + message + '</div>' +
    '<div class="result-stars">' + starsHtml + '</div>' +
    '<div style="font-size:2.5rem;font-weight:800;color:#667eea;margin:15px 0">' + 
    state.score + ' / ' + state.level + '</div>' +
    '<div style="color:#666;margin-bottom:20px">' + percentage + '% chÃ­nh xÃ¡c</div>' +
    '<div class="result-buttons">' +
    '<button class="result-btn primary" onclick="startSentenceQuizGame(' + state.level + ')">ChÆ¡i láº¡i ğŸ”„</button>' +
    '<button class="result-btn secondary" onclick="startVerbSentenceQuiz()">Äá»•i má»©c Ä‘á»™ ğŸ“Š</button>' +
    '<button class="result-btn secondary" onclick="showLearnScreen()">Vá» há»c táº­p ğŸ“š</button>' +
    '</div></div></div>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}
</script>
</body>
</html>
