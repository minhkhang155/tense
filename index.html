<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ğŸ¦‰ Fun English - Há»c vui má»—i ngÃ y!</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦‰</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Nunito', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .app-container { max-width: 500px; margin: 0 auto; min-height: 100vh; }
    
    /* Backgrounds for different themes */
    .bg-sunny { background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 100%); }
    .bg-night { background: linear-gradient(180deg, #2C3E50 0%, #4A569D 100%); }
    .bg-park { background: linear-gradient(180deg, #87CEEB 0%, #90EE90 100%); }
    .bg-home { background: linear-gradient(180deg, #FFB6C1 0%, #FFECD2 100%); }
    .bg-school { background: linear-gradient(180deg, #87CEEB 0%, #DDA0DD 100%); }
    .bg-fun { background: linear-gradient(180deg, #667eea 0%, #764ba2 100%); }
    
    .screen { display: none; min-height: 100vh; padding: 20px; }
    .screen.active { display: block; }
    
    /* Sound toggle */
    .sound-toggle {
      position: fixed; top: 15px; right: 15px; width: 45px; height: 45px;
      border-radius: 50%; border: none; background: rgba(255,255,255,0.9);
      font-size: 1.3rem; cursor: pointer; z-index: 100;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    
    /* HOME SCREEN */
    .home-content { text-align: center; padding-top: 30px; }
    .mascot-large { font-size: 100px; animation: bounce 2s ease infinite; }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    .app-title {
      font-size: 2.2rem; font-weight: 800; color: white;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2); margin: 15px 0 5px;
    }
    .app-tagline { color: rgba(255,255,255,0.9); font-size: 1.1rem; margin-bottom: 30px; }
    
    .topic-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    .topic-card {
      background: white; border-radius: 20px; padding: 20px 15px;
      text-align: center; cursor: pointer; transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border: 3px solid transparent;
    }
    .topic-card:hover { transform: translateY(-5px); }
    .topic-card:active { transform: scale(0.95); }
    .topic-card .topic-icon { font-size: 45px; margin-bottom: 8px; }
    .topic-card .topic-name { font-size: 1rem; font-weight: 700; color: #333; }
    .topic-card.daily { border-color: #4CAF50; }
    .topic-card.yesterday { border-color: #FF9800; }
    .topic-card.stories { border-color: #E91E63; }
    .topic-card.games { border-color: #9C27B0; }
    
    .streak-banner {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #5D4037; padding: 12px 20px; border-radius: 15px;
      margin-top: 25px; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 10px;
    }
    
    /* STORY SCREEN */
    .story-scene {
      background: white; border-radius: 25px; padding: 25px;
      margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      min-height: 400px; position: relative;
    }
    .scene-image {
      font-size: 80px; text-align: center; margin-bottom: 20px;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .scene-text {
      font-size: 1.4rem; text-align: center; color: #333;
      line-height: 1.6; margin-bottom: 25px;
    }
    .scene-text .highlight {
      background: linear-gradient(180deg, transparent 60%, #FFEB3B 60%);
      padding: 0 5px; font-weight: 700;
    }
    .scene-text .highlight-green {
      background: linear-gradient(180deg, transparent 60%, #A5D6A7 60%);
      padding: 0 5px; font-weight: 700;
    }
    .scene-text .highlight-orange {
      background: linear-gradient(180deg, transparent 60%, #FFCC80 60%);
      padding: 0 5px; font-weight: 700;
    }
    
    .scene-question {
      background: #FFF9C4; padding: 15px 20px; border-radius: 15px;
      text-align: center; font-size: 1.2rem; color: #5D4037;
      margin-bottom: 20px;
    }
    
    .choice-buttons { display: flex; flex-direction: column; gap: 12px; }
    .choice-btn {
      padding: 18px 25px; font-size: 1.2rem; font-weight: 600;
      border: 3px solid #E0E0E0; border-radius: 15px; background: white;
      cursor: pointer; font-family: 'Nunito', sans-serif; transition: all 0.2s;
      text-align: left;
    }
    .choice-btn:hover { border-color: #2196F3; background: #E3F2FD; }
    .choice-btn.correct {
      border-color: #4CAF50; background: #E8F5E9;
      animation: pulse 0.5s ease;
    }
    .choice-btn.wrong {
      border-color: #F44336; background: #FFEBEE;
      animation: shake 0.5s ease;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .feedback-box {
      margin-top: 20px; padding: 20px; border-radius: 15px;
      text-align: center; animation: fadeIn 0.3s ease;
    }
    .feedback-box.correct { background: #E8F5E9; }
    .feedback-box.wrong { background: #FFF3E0; }
    .feedback-emoji { font-size: 50px; margin-bottom: 10px; }
    .feedback-text { font-size: 1.1rem; color: #333; margin-bottom: 15px; }
    .feedback-tip {
      background: white; padding: 12px 15px; border-radius: 10px;
      font-size: 1rem; color: #666; margin-bottom: 15px;
    }
    
    .next-btn {
      width: 100%; padding: 15px; font-size: 1.2rem; font-weight: 700;
      border: none; border-radius: 50px; cursor: pointer;
      font-family: 'Nunito', sans-serif; transition: all 0.2s;
      background: linear-gradient(135deg, #667eea, #764ba2); color: white;
    }
    .next-btn:hover { transform: translateY(-2px); }
    
    /* Progress */
    .progress-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 15px;
    }
    .back-btn {
      background: rgba(255,255,255,0.9); border: none; padding: 10px 18px;
      border-radius: 25px; font-weight: 700; cursor: pointer;
      font-family: 'Nunito', sans-serif; color: #333;
    }
    .progress-dots { display: flex; gap: 8px; }
    .dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: rgba(255,255,255,0.4);
    }
    .dot.active { background: white; }
    .dot.done { background: #4CAF50; }
    .star-count {
      background: rgba(255,255,255,0.9); padding: 8px 15px;
      border-radius: 20px; font-weight: 700; color: #FF9800;
    }
    
    /* RESULT SCREEN */
    .result-content { text-align: center; padding-top: 40px; }
    .result-card {
      background: white; border-radius: 25px; padding: 35px 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    .result-emoji { font-size: 80px; margin-bottom: 15px; }
    .result-title { font-size: 1.8rem; font-weight: 800; color: #333; margin-bottom: 10px; }
    .result-stars { font-size: 45px; margin: 15px 0; }
    .result-message { font-size: 1.1rem; color: #666; margin-bottom: 25px; }
    .result-buttons { display: flex; flex-direction: column; gap: 12px; }
    .result-btn {
      padding: 15px 25px; font-size: 1.1rem; font-weight: 700;
      border: none; border-radius: 50px; cursor: pointer;
      font-family: 'Nunito', sans-serif;
    }
    .result-btn.primary {
      background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white;
    }
    .result-btn.secondary {
      background: #F5F5F5; color: #333;
    }
    
    /* LEARN SCREEN - Visual Patterns */
    .pattern-card {
      background: white; border-radius: 20px; padding: 25px;
      margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .pattern-title {
      display: flex; align-items: center; gap: 10px;
      font-size: 1.3rem; font-weight: 700; color: #333; margin-bottom: 20px;
    }
    .pattern-title .icon { font-size: 30px; }
    
    .example-row {
      display: flex; align-items: center; gap: 15px;
      padding: 15px; margin-bottom: 10px; border-radius: 12px;
      background: #F5F5F5;
    }
    .example-row .emoji { font-size: 35px; }
    .example-row .sentence { font-size: 1.1rem; color: #333; }
    .example-row .sentence strong { color: #4CAF50; }
    .example-row .sentence .past { color: #FF9800; }
    
    .tip-bubble {
      background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
      padding: 15px 20px; border-radius: 15px;
      display: flex; align-items: flex-start; gap: 12px;
      margin-top: 15px;
    }
    .tip-bubble .bulb { font-size: 25px; }
    .tip-bubble .tip-text { font-size: 1rem; color: #1565C0; }
    
    /* Visual comparison */
    .compare-box {
      display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
      margin: 20px 0;
    }
    .compare-side {
      padding: 20px 15px; border-radius: 15px; text-align: center;
    }
    .compare-side.now { background: #E8F5E9; }
    .compare-side.past { background: #FFF3E0; }
    .compare-side .label {
      font-weight: 700; margin-bottom: 10px; font-size: 1rem;
    }
    .compare-side.now .label { color: #2E7D32; }
    .compare-side.past .label { color: #E65100; }
    .compare-side .time-words {
      display: flex; flex-wrap: wrap; gap: 6px; justify-content: center;
      margin-bottom: 12px;
    }
    .time-word {
      background: white; padding: 5px 12px; border-radius: 20px;
      font-size: 0.85rem; font-weight: 600;
    }
    .compare-side.now .time-word { color: #4CAF50; }
    .compare-side.past .time-word { color: #FF9800; }
    .compare-side .example {
      background: white; padding: 10px; border-radius: 10px;
      font-size: 0.95rem; color: #333;
    }
    
    /* Word cards for irregular verbs */
    .word-pairs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .word-pair {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      background: #F5F5F5; padding: 12px; border-radius: 12px;
    }
    .word-pair .now { color: #4CAF50; font-weight: 700; }
    .word-pair .arrow { color: #999; }
    .word-pair .past { color: #FF9800; font-weight: 700; }
    .word-pair .meaning { color: #999; font-size: 0.85rem; }
    
    /* Matching game */
    .match-instruction {
      text-align: center; color: white; font-size: 1.1rem;
      margin-bottom: 20px; padding: 15px;
      background: rgba(255,255,255,0.2); border-radius: 15px;
    }
    .match-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    }
    .match-card {
      padding: 18px 10px; border-radius: 15px; font-size: 1.1rem;
      font-weight: 700; cursor: pointer; text-align: center;
      font-family: 'Nunito', sans-serif; border: none;
      transition: all 0.2s;
    }
    .match-card.type-now { background: #E8F5E9; color: #2E7D32; }
    .match-card.type-past { background: #FFF3E0; color: #E65100; }
    .match-card.selected { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .match-card.matched { opacity: 0.5; cursor: default; }
    
    .match-score {
      text-align: center; margin-top: 20px;
      background: white; padding: 15px; border-radius: 15px;
      font-size: 1.2rem; font-weight: 700;
    }
    
    /* Flashcards */
    .flashcard-container { perspective: 1000px; margin: 20px 0; }
    .flashcard {
      width: 100%; height: 200px; cursor: pointer;
      position: relative; transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    .flashcard.flipped { transform: rotateY(180deg); }
    .flashcard-face {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden; border-radius: 20px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 20px;
    }
    .flashcard-front { background: linear-gradient(135deg, #E8F5E9, #C8E6C9); }
    .flashcard-back {
      background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
      transform: rotateY(180deg);
    }
    .flashcard-word { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
    .flashcard-front .flashcard-word { color: #2E7D32; }
    .flashcard-back .flashcard-word { color: #E65100; }
    .flashcard-label { font-size: 1rem; color: #666; }
    .flashcard-meaning { font-size: 1.1rem; color: #666; margin-top: 10px; }
    .flashcard-hint { font-size: 0.9rem; color: #999; margin-top: 15px; }
    
    .flashcard-nav {
      display: flex; justify-content: center; gap: 15px; margin-top: 20px;
    }
    .flashcard-btn {
      padding: 12px 25px; border-radius: 25px; font-weight: 700;
      cursor: pointer; font-family: 'Nunito', sans-serif; border: none;
      background: white; color: #333;
    }
    .flashcard-btn:hover { background: #F5F5F5; }
    
    /* Confetti */
    .confetti-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1000;
    }
    .confetti {
      position: absolute; width: 10px; height: 10px;
      animation: confettiFall 3s linear forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    /* Responsive */
    @media (max-width: 400px) {
      .app-title { font-size: 1.8rem; }
      .scene-text { font-size: 1.2rem; }
      .choice-btn { font-size: 1rem; padding: 15px 20px; }
    }
  </style>
</head>
<body>
  <div class="app-container bg-fun" id="appContainer">
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>
    <div id="confettiContainer" class="confetti-container"></div>
    
    <!-- HOME SCREEN -->
    <div id="homeScreen" class="screen active">
      <div class="home-content">
        <div class="mascot-large">ğŸ¦‰</div>
        <h1 class="app-title">Fun English!</h1>
        <p class="app-tagline">Há»c tiáº¿ng Anh vui váº» má»—i ngÃ y</p>
        
        <div class="topic-grid">
          <div class="topic-card daily" onclick="startTopic('daily')">
            <div class="topic-icon">â˜€ï¸</div>
            <div class="topic-name">Every Day</div>
          </div>
          <div class="topic-card yesterday" onclick="startTopic('yesterday')">
            <div class="topic-icon">ğŸŒ™</div>
            <div class="topic-name">Yesterday</div>
          </div>
          <div class="topic-card stories" onclick="startTopic('stories')">
            <div class="topic-icon">ğŸ“–</div>
            <div class="topic-name">Mix Stories</div>
          </div>
          <div class="topic-card" onclick="showLearnScreen()" style="border-color:#4CAF50">
            <div class="topic-icon">ğŸ“š</div>
            <div class="topic-name">Há»c kiáº¿n thá»©c</div>
          </div>
          <div class="topic-card games" onclick="startTopic('games')">
            <div class="topic-icon">ğŸ®</div>
            <div class="topic-name">Word Games</div>
          </div>
        </div>
        
        <div class="streak-banner" id="streakBanner">
          <span>ğŸ”¥</span>
          <span id="streakText">Báº¯t Ä‘áº§u há»c nÃ o!</span>
        </div>
      </div>
    </div>
    
    <!-- STORY SCREEN -->
    <div id="storyScreen" class="screen"></div>
    
    <!-- RESULT SCREEN -->
    <div id="resultScreen" class="screen"></div>
    
    <!-- LEARN SCREEN -->
    <div id="learnScreen" class="screen"></div>
    
    <!-- GAME SCREEN -->
    <div id="gameScreen" class="screen"></div>
  </div>

<script>
// ============ DATA - Cambridge Style ============
// ============ DATA - Cambridge Style (All Signal Words) ============
var STORIES = {
  daily: [
    // Story 1: Every Day signals
    {
      bg: 'bg-sunny',
      scenes: [
        {
          image: 'ğŸŒ…ğŸ‘§',
          text: 'Lily <span class="highlight-green">wakes up</span> at 7 <span class="highlight">every day</span>.',
          question: 'Lily ___ up at 7 every day.',
          choices: ['wakes â˜€ï¸', 'woke ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! "every day" â†’ wakes',
          tip: 'â˜€ï¸ every day = má»—i ngÃ y â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸ¬',
          text: 'She <span class="highlight-green">doesn\'t eat</span> candy <span class="highlight">every day</span>.',
          question: 'She ___ eat candy every day.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! every day + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« every day â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ«',
          text: '"<span class="highlight-green">Does she go</span> to school <span class="highlight">every day</span>?"',
          question: '___ she go to school every day?',
          choices: ['Does â“', 'Did â“'],
          correct: 0,
          feedback: 'Perfect! every day + cÃ¢u há»i â†’ Does',
          tip: 'â“ every day â†’ Does...?'
        },
        {
          image: 'ğŸ¦·ğŸ‘¦',
          text: 'Tom <span class="highlight-green">brushes</span> his teeth <span class="highlight">every morning</span>.',
          question: 'Tom ___ his teeth every morning.',
          choices: ['brushes â˜€ï¸', 'brushed ğŸŒ™'],
          correct: 0,
          feedback: 'Wonderful! "every morning" â†’ brushes',
          tip: 'â˜€ï¸ every morning = má»—i sÃ¡ng â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«â˜•',
          text: 'He <span class="highlight-green">doesn\'t drink</span> coffee <span class="highlight">every morning</span>.',
          question: 'He ___ drink coffee every morning.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Excellent! every morning + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« every morning â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ³',
          text: '"<span class="highlight-green">Does Mom cook</span> <span class="highlight">every morning</span>?"',
          question: '___ Mom cook every morning?',
          choices: ['Does â“', 'Did â“'],
          correct: 0,
          feedback: 'Great! every morning + cÃ¢u há»i â†’ Does',
          tip: 'â“ every morning â†’ Does...?'
        }
      ]
    },
    // Story 2: Every Night / Every Week
    {
      bg: 'bg-night',
      scenes: [
        {
          image: 'ğŸ“–ğŸ‘§',
          text: 'Lily <span class="highlight-green">reads</span> books <span class="highlight">every night</span>.',
          question: 'Lily ___ books every night.',
          choices: ['reads â˜€ï¸', 'read ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! "every night" â†’ reads',
          tip: 'â˜€ï¸ every night = má»—i tá»‘i â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸ“º',
          text: 'She <span class="highlight-green">doesn\'t watch</span> TV <span class="highlight">every night</span>.',
          question: 'She ___ watch TV every night.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! every night + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« every night â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ˜´',
          text: '"<span class="highlight-green">Does she sleep</span> early <span class="highlight">every night</span>?"',
          question: '___ she sleep early every night?',
          choices: ['Does â“', 'Did â“'],
          correct: 0,
          feedback: 'Perfect! every night + cÃ¢u há»i â†’ Does',
          tip: 'â“ every night â†’ Does...?'
        },
        {
          image: 'âš½ğŸ‘¦',
          text: 'Tom <span class="highlight-green">plays</span> football <span class="highlight">every week</span>.',
          question: 'Tom ___ football every week.',
          choices: ['plays â˜€ï¸', 'played ğŸŒ™'],
          correct: 0,
          feedback: 'Wonderful! "every week" â†’ plays',
          tip: 'â˜€ï¸ every week = má»—i tuáº§n â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸŠ',
          text: 'He <span class="highlight-green">doesn\'t swim</span> <span class="highlight">every week</span>.',
          question: 'He ___ swim every week.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Excellent! every week + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« every week â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ¾',
          text: '"<span class="highlight-green">Do they play</span> tennis <span class="highlight">every week</span>?"',
          question: '___ they play tennis every week?',
          choices: ['Do â“', 'Did â“'],
          correct: 0,
          feedback: 'Great! every week + they â†’ Do',
          tip: 'â“ every week â†’ Do...?'
        }
      ]
    },
    // Story 3: Always / Usually
    {
      bg: 'bg-home',
      scenes: [
        {
          image: 'ğŸğŸ‘§',
          text: 'Lily <span class="highlight">always</span> <span class="highlight-green">eats</span> fruit.',
          question: 'Lily always ___ fruit.',
          choices: ['eats â˜€ï¸', 'ate ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! "always" â†’ eats',
          tip: 'â˜€ï¸ always = luÃ´n luÃ´n â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸ­',
          text: 'She <span class="highlight">always</span> <span class="highlight-green">doesn\'t eat</span> too much candy.',
          question: 'She ___ eat too much candy.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! always + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« always â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ“š',
          text: '"<span class="highlight-green">Does she always study</span> hard?"',
          question: '___ she always study hard?',
          choices: ['Does â“', 'Did â“'],
          correct: 0,
          feedback: 'Perfect! always + cÃ¢u há»i â†’ Does',
          tip: 'â“ always â†’ Does...?'
        },
        {
          image: 'ğŸš¶ğŸ‘¦',
          text: 'Tom <span class="highlight">usually</span> <span class="highlight-green">walks</span> to school.',
          question: 'Tom usually ___ to school.',
          choices: ['walks â˜€ï¸', 'walked ğŸŒ™'],
          correct: 0,
          feedback: 'Wonderful! "usually" â†’ walks',
          tip: 'â˜€ï¸ usually = thÆ°á»ng â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸšŒ',
          text: 'He <span class="highlight">usually</span> <span class="highlight-green">doesn\'t take</span> the bus.',
          question: 'He usually ___ take the bus.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Excellent! usually + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« usually â†’ doesn\'t'
        },
        {
          image: 'â“ğŸƒ',
          text: '"<span class="highlight-green">Does he usually run</span> in the morning?"',
          question: '___ he usually run in the morning?',
          choices: ['Does â“', 'Did â“'],
          correct: 0,
          feedback: 'Great! usually + cÃ¢u há»i â†’ Does',
          tip: 'â“ usually â†’ Does...?'
        }
      ]
    },
    // Story 4: Often / Sometimes
    {
      bg: 'bg-park',
      scenes: [
        {
          image: 'ğŸ®ğŸ‘§',
          text: 'Lily <span class="highlight">often</span> <span class="highlight-green">plays</span> games.',
          question: 'Lily often ___ games.',
          choices: ['plays â˜€ï¸', 'played ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! "often" â†’ plays',
          tip: 'â˜€ï¸ often = thÆ°á»ng xuyÃªn â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸ˜¢',
          text: 'She <span class="highlight">often</span> <span class="highlight-green">doesn\'t cry</span>. She\'s brave!',
          question: 'She often ___ cry.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! often + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« often â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ¨',
          text: '"<span class="highlight-green">Does she often draw</span> pictures?"',
          question: '___ she often draw pictures?',
          choices: ['Does â“', 'Did â“'],
          correct: 0,
          feedback: 'Perfect! often + cÃ¢u há»i â†’ Does',
          tip: 'â“ often â†’ Does...?'
        },
        {
          image: 'ğŸ¦ğŸ‘¦',
          text: 'Tom <span class="highlight">sometimes</span> <span class="highlight-green">eats</span> ice cream.',
          question: 'Tom sometimes ___ ice cream.',
          choices: ['eats â˜€ï¸', 'ate ğŸŒ™'],
          correct: 0,
          feedback: 'Wonderful! "sometimes" â†’ eats',
          tip: 'â˜€ï¸ sometimes = Ä‘Ã´i khi â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸš«ğŸ¸',
          text: 'He <span class="highlight">sometimes</span> <span class="highlight-green">doesn\'t practice</span> guitar.',
          question: 'He sometimes ___ practice guitar.',
          choices: ['doesn\'t ğŸš«', 'didn\'t ğŸš«'],
          correct: 0,
          feedback: 'Excellent! sometimes + phá»§ Ä‘á»‹nh â†’ doesn\'t',
          tip: 'ğŸš« sometimes â†’ doesn\'t'
        },
        {
          image: 'â“ğŸ¬',
          text: '"<span class="highlight-green">Do you sometimes watch</span> movies?"',
          question: '___ you sometimes watch movies?',
          choices: ['Do â“', 'Did â“'],
          correct: 0,
          feedback: 'Great! sometimes + you â†’ Do',
          tip: 'â“ sometimes â†’ Do...?'
        }
      ]
    }
  ],
  yesterday: [
    // Story 1: Yesterday
    {
      bg: 'bg-night',
      scenes: [
        {
          image: 'ğŸŒ™ğŸ‘§',
          text: 'Lily <span class="highlight-orange">woke up</span> late <span class="highlight-orange">yesterday</span>.',
          question: '___, Lily woke up late.',
          choices: ['Yesterday ğŸŒ™', 'Every day â˜€ï¸'],
          correct: 0,
          feedback: 'Yes! "yesterday" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ yesterday = hÃ´m qua â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ«',
          text: 'She <span class="highlight-orange">didn\'t go</span> to school <span class="highlight-orange">yesterday</span>.',
          question: 'Yesterday, she ___ go to school.',
          choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! yesterday + phá»§ Ä‘á»‹nh â†’ didn\'t',
          tip: 'ğŸš« yesterday â†’ didn\'t'
        },
        {
          image: 'â“ğŸ›ï¸',
          text: '"<span class="highlight-orange">Did she sleep</span> well <span class="highlight-orange">yesterday</span>?"',
          question: '___ she sleep well yesterday?',
          choices: ['Did â“', 'Does â“'],
          correct: 0,
          feedback: 'Perfect! yesterday + cÃ¢u há»i â†’ Did',
          tip: 'â“ yesterday â†’ Did...?'
        },
        {
          image: 'ğŸ•ğŸ‘¦',
          text: 'Tom <span class="highlight-orange">ate</span> pizza <span class="highlight-orange">yesterday</span>.',
          question: 'Yesterday, Tom ___ pizza.',
          choices: ['ate ğŸŒ™', 'eats â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! yesterday â†’ ate',
          tip: 'ğŸŒ™ yesterday â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ¥—',
          text: 'He <span class="highlight-orange">didn\'t eat</span> salad <span class="highlight-orange">yesterday</span>.',
          question: 'Yesterday, he didn\'t ___ salad.',
          choices: ['eat ğŸš«', 'ate ğŸš«'],
          correct: 0,
          feedback: 'Excellent! Sau didn\'t â†’ eat (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ didn\'t + eat (KHÃ”NG pháº£i ate!)'
        },
        {
          image: 'â“ğŸ®',
          text: '"<span class="highlight-orange">Did he play</span> games <span class="highlight-orange">yesterday</span>?"',
          question: 'Did he ___ games yesterday?',
          choices: ['play â“', 'played â“'],
          correct: 0,
          feedback: 'Great! Sau Did â†’ play (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ Did + play (KHÃ”NG pháº£i played!)'
        }
      ]
    },
    // Story 2: Last night
    {
      bg: 'bg-night',
      scenes: [
        {
          image: 'ğŸ“ºğŸ‘¨â€ğŸ‘©â€ğŸ‘§',
          text: 'We <span class="highlight-orange">watched</span> a movie <span class="highlight-orange">last night</span>.',
          question: '___, we watched a movie.',
          choices: ['Last night ğŸŒ™', 'Every night â˜€ï¸'],
          correct: 0,
          feedback: 'Yes! "last night" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ last night = tá»‘i qua â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ“–',
          text: 'Lily <span class="highlight-orange">didn\'t read</span> books <span class="highlight-orange">last night</span>.',
          question: 'Last night, Lily ___ read books.',
          choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! last night + phá»§ Ä‘á»‹nh â†’ didn\'t',
          tip: 'ğŸš« last night â†’ didn\'t'
        },
        {
          image: 'â“ğŸ˜´',
          text: '"<span class="highlight-orange">Did you sleep</span> early <span class="highlight-orange">last night</span>?"',
          question: '___ you sleep early last night?',
          choices: ['Did â“', 'Do â“'],
          correct: 0,
          feedback: 'Perfect! last night + cÃ¢u há»i â†’ Did',
          tip: 'â“ last night â†’ Did...?'
        },
        {
          image: 'ğŸğŸ‘¨',
          text: 'Dad <span class="highlight-orange">cooked</span> pasta <span class="highlight-orange">last night</span>.',
          question: 'Last night, Dad ___ pasta.',
          choices: ['cooked ğŸŒ™', 'cooks â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! last night â†’ cooked',
          tip: 'ğŸŒ™ last night â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ°',
          text: 'We <span class="highlight-orange">didn\'t have</span> dessert <span class="highlight-orange">last night</span>.',
          question: 'Last night, we didn\'t ___ dessert.',
          choices: ['have ğŸš«', 'had ğŸš«'],
          correct: 0,
          feedback: 'Excellent! Sau didn\'t â†’ have (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ didn\'t + have (KHÃ”NG pháº£i had!)'
        },
        {
          image: 'â“ğŸ¬',
          text: '"<span class="highlight-orange">Did they come</span> over <span class="highlight-orange">last night</span>?"',
          question: 'Did they ___ over last night?',
          choices: ['come â“', 'came â“'],
          correct: 0,
          feedback: 'Great! Sau Did â†’ come (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ Did + come (KHÃ”NG pháº£i came!)'
        }
      ]
    },
    // Story 3: Last week / Last month
    {
      bg: 'bg-school',
      scenes: [
        {
          image: 'ğŸ“ğŸ‘§',
          text: 'Lily <span class="highlight-orange">had</span> a test <span class="highlight-orange">last week</span>.',
          question: '___, Lily had a test.',
          choices: ['Last week ğŸŒ™', 'Every week â˜€ï¸'],
          correct: 0,
          feedback: 'Yes! "last week" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ last week = tuáº§n trÆ°á»›c â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ˜°',
          text: 'She <span class="highlight-orange">didn\'t fail</span> the test <span class="highlight-orange">last week</span>.',
          question: 'Last week, she ___ fail the test.',
          choices: ['didn\'t ğŸš«', 'doesn\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! last week + phá»§ Ä‘á»‹nh â†’ didn\'t',
          tip: 'ğŸš« last week â†’ didn\'t'
        },
        {
          image: 'â“ğŸ’¯',
          text: '"<span class="highlight-orange">Did she get</span> 100 points <span class="highlight-orange">last week</span>?"',
          question: '___ she get 100 points last week?',
          choices: ['Did â“', 'Does â“'],
          correct: 0,
          feedback: 'Perfect! last week + cÃ¢u há»i â†’ Did',
          tip: 'â“ last week â†’ Did...?'
        },
        {
          image: 'ğŸ‚ğŸ‘¦',
          text: 'Tom <span class="highlight-orange">celebrated</span> his birthday <span class="highlight-orange">last month</span>.',
          question: '___, Tom celebrated his birthday.',
          choices: ['Last month ğŸŒ™', 'Every month â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! "last month" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ last month = thÃ¡ng trÆ°á»›c â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ',
          text: 'He <span class="highlight-orange">didn\'t get</span> a bike <span class="highlight-orange">last month</span>.',
          question: 'Last month, he didn\'t ___ a bike.',
          choices: ['get ğŸš«', 'got ğŸš«'],
          correct: 0,
          feedback: 'Excellent! Sau didn\'t â†’ get (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ didn\'t + get (KHÃ”NG pháº£i got!)'
        },
        {
          image: 'â“ğŸ‰',
          text: '"<span class="highlight-orange">Did friends come</span> to the party <span class="highlight-orange">last month</span>?"',
          question: 'Did friends ___ to the party last month?',
          choices: ['come â“', 'came â“'],
          correct: 0,
          feedback: 'Great! Sau Did â†’ come (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ Did + come (KHÃ”NG pháº£i came!)'
        }
      ]
    },
    // Story 4: Last year / ...ago / in 2023
    {
      bg: 'bg-park',
      scenes: [
        {
          image: 'âœˆï¸ğŸ‘¨â€ğŸ‘©â€ğŸ‘§',
          text: 'We <span class="highlight-orange">went</span> to Japan <span class="highlight-orange">last year</span>.',
          question: '___, we went to Japan.',
          choices: ['Last year ğŸŒ™', 'Every year â˜€ï¸'],
          correct: 0,
          feedback: 'Yes! "last year" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ last year = nÄƒm ngoÃ¡i â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«ğŸ”ï¸',
          text: 'We <span class="highlight-orange">didn\'t climb</span> a mountain <span class="highlight-orange">last year</span>.',
          question: 'Last year, we ___ climb a mountain.',
          choices: ['didn\'t ğŸš«', 'don\'t ğŸš«'],
          correct: 0,
          feedback: 'Great! last year + phá»§ Ä‘á»‹nh â†’ didn\'t',
          tip: 'ğŸš« last year â†’ didn\'t'
        },
        {
          image: 'â“ğŸŒŠ',
          text: '"<span class="highlight-orange">Did you swim</span> in the sea <span class="highlight-orange">last year</span>?"',
          question: '___ you swim in the sea last year?',
          choices: ['Did â“', 'Do â“'],
          correct: 0,
          feedback: 'Perfect! last year + cÃ¢u há»i â†’ Did',
          tip: 'â“ last year â†’ Did...?'
        },
        {
          image: 'ğŸ“ğŸ‘§',
          text: 'Lily <span class="highlight-orange">started</span> school <span class="highlight-orange">2 years ago</span>.',
          question: '2 years ___, Lily started school.',
          choices: ['ago ğŸŒ™', 'every â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! "ago" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ ...ago = cÃ¡ch Ä‘Ã¢y... â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸ•ğŸ‘¦',
          text: 'Tom <span class="highlight-orange">got</span> a dog <span class="highlight-orange">in 2023</span>.',
          question: '___, Tom got a dog.',
          choices: ['In 2023 ğŸŒ™', 'Every year â˜€ï¸'],
          correct: 0,
          feedback: 'Excellent! "in 2023" â†’ quÃ¡ khá»©',
          tip: 'ğŸŒ™ in 2023 = nÄƒm 2023 â†’ quÃ¡ khá»©'
        },
        {
          image: 'â“ğŸ ',
          text: '"<span class="highlight-orange">Did they move</span> house <span class="highlight-orange">3 years ago</span>?"',
          question: 'Did they ___ house 3 years ago?',
          choices: ['move â“', 'moved â“'],
          correct: 0,
          feedback: 'Great! Sau Did â†’ move (dáº¡ng gá»‘c)',
          tip: 'âš ï¸ Did + move (KHÃ”NG pháº£i moved!)'
        }
      ]
    }
  ],
  stories: [
    // Story 1: Every day vs Yesterday
    {
      bg: 'bg-home',
      scenes: [
        {
          image: 'â˜€ï¸ğŸ‘§',
          text: 'Lily <span class="highlight-green">eats</span> breakfast <span class="highlight">every day</span>.',
          question: 'Every day â†’ Lily ___ breakfast.',
          choices: ['eats â˜€ï¸', 'ate ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! every day â†’ eats',
          tip: 'â˜€ï¸ every day â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸŒ™ğŸ‘§',
          text: '<span class="highlight-orange">Yesterday</span>, she <span class="highlight-orange">ate</span> pancakes!',
          question: 'Yesterday â†’ she ___ pancakes.',
          choices: ['ate ğŸŒ™', 'eats â˜€ï¸'],
          correct: 0,
          feedback: 'Great! yesterday â†’ ate',
          tip: 'ğŸŒ™ yesterday â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«â˜€ï¸',
          text: 'She <span class="highlight-green">doesn\'t drink</span> coffee <span class="highlight">every morning</span>.',
          question: 'Every morning â†’ she ___ drink coffee.',
          choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'],
          correct: 0,
          feedback: 'Perfect! every morning â†’ doesn\'t',
          tip: 'â˜€ï¸ every morning â†’ doesn\'t'
        },
        {
          image: 'ğŸš«ğŸŒ™',
          text: '<span class="highlight-orange">Last night</span>, she <span class="highlight-orange">didn\'t drink</span> milk.',
          question: 'Last night â†’ she ___ drink milk.',
          choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! last night â†’ didn\'t',
          tip: 'ğŸŒ™ last night â†’ didn\'t'
        },
        {
          image: 'â“â˜€ï¸',
          text: '"<span class="highlight-green">Does</span> she go to school <span class="highlight">every day</span>?"',
          question: 'Every day â†’ ___ she go to school?',
          choices: ['Does â˜€ï¸', 'Did ğŸŒ™'],
          correct: 0,
          feedback: 'Excellent! every day â†’ Does',
          tip: 'â˜€ï¸ every day â†’ Does...?'
        },
        {
          image: 'â“ğŸŒ™',
          text: '"<span class="highlight-orange">Did</span> she go to school <span class="highlight-orange">yesterday</span>?"',
          question: 'Yesterday â†’ ___ she go to school?',
          choices: ['Did ğŸŒ™', 'Does â˜€ï¸'],
          correct: 0,
          feedback: 'Great! yesterday â†’ Did',
          tip: 'ğŸŒ™ yesterday â†’ Did...?'
        }
      ]
    },
    // Story 2: Always/Usually vs Last week
    {
      bg: 'bg-park',
      scenes: [
        {
          image: 'âš½â˜€ï¸',
          text: 'Tom <span class="highlight">always</span> <span class="highlight-green">plays</span> football on Saturday.',
          question: 'Always â†’ Tom ___ football.',
          choices: ['plays â˜€ï¸', 'played ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! always â†’ plays',
          tip: 'â˜€ï¸ always â†’ hiá»‡n táº¡i'
        },
        {
          image: 'âš½ğŸŒ™',
          text: '<span class="highlight-orange">Last Saturday</span>, he <span class="highlight-orange">played</span> in a big match.',
          question: 'Last Saturday â†’ he ___ in a big match.',
          choices: ['played ğŸŒ™', 'plays â˜€ï¸'],
          correct: 0,
          feedback: 'Great! last Saturday â†’ played',
          tip: 'ğŸŒ™ last Saturday â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«â˜€ï¸',
          text: 'He <span class="highlight">usually</span> <span class="highlight-green">doesn\'t lose</span>.',
          question: 'Usually â†’ he ___ lose.',
          choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'],
          correct: 0,
          feedback: 'Perfect! usually â†’ doesn\'t',
          tip: 'â˜€ï¸ usually â†’ doesn\'t'
        },
        {
          image: 'ğŸš«ğŸŒ™',
          text: 'But <span class="highlight-orange">last week</span>, he <span class="highlight-orange">didn\'t win</span>.',
          question: 'Last week â†’ he ___ win.',
          choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! last week â†’ didn\'t',
          tip: 'ğŸŒ™ last week â†’ didn\'t'
        },
        {
          image: 'â“â˜€ï¸',
          text: '"<span class="highlight-green">Does</span> he <span class="highlight">often</span> score goals?"',
          question: 'Often â†’ ___ he score goals?',
          choices: ['Does â˜€ï¸', 'Did ğŸŒ™'],
          correct: 0,
          feedback: 'Excellent! often â†’ Does',
          tip: 'â˜€ï¸ often â†’ Does...?'
        },
        {
          image: 'â“ğŸŒ™',
          text: '"<span class="highlight-orange">Did</span> he score <span class="highlight-orange">last month</span>?"',
          question: 'Last month â†’ ___ he score?',
          choices: ['Did ğŸŒ™', 'Does â˜€ï¸'],
          correct: 0,
          feedback: 'Great! last month â†’ Did',
          tip: 'ğŸŒ™ last month â†’ Did...?'
        }
      ]
    },
    // Story 3: Sometimes vs ...ago
    {
      bg: 'bg-home',
      scenes: [
        {
          image: 'ğŸ®â˜€ï¸',
          text: 'Lily <span class="highlight">sometimes</span> <span class="highlight-green">plays</span> video games.',
          question: 'Sometimes â†’ Lily ___ video games.',
          choices: ['plays â˜€ï¸', 'played ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! sometimes â†’ plays',
          tip: 'â˜€ï¸ sometimes â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸ®ğŸŒ™',
          text: 'She <span class="highlight-orange">played</span> a new game <span class="highlight-orange">2 days ago</span>.',
          question: '2 days ago â†’ she ___ a new game.',
          choices: ['played ğŸŒ™', 'plays â˜€ï¸'],
          correct: 0,
          feedback: 'Great! ...ago â†’ played',
          tip: 'ğŸŒ™ ...ago â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«â˜€ï¸',
          text: 'She <span class="highlight">sometimes</span> <span class="highlight-green">doesn\'t do</span> homework.',
          question: 'Sometimes â†’ she ___ do homework.',
          choices: ['doesn\'t â˜€ï¸', 'didn\'t ğŸŒ™'],
          correct: 0,
          feedback: 'Perfect! sometimes â†’ doesn\'t',
          tip: 'â˜€ï¸ sometimes â†’ doesn\'t'
        },
        {
          image: 'ğŸš«ğŸŒ™',
          text: '<span class="highlight-orange">A week ago</span>, she <span class="highlight-orange">didn\'t finish</span> her project.',
          question: 'A week ago â†’ she ___ finish her project.',
          choices: ['didn\'t ğŸŒ™', 'doesn\'t â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! ...ago â†’ didn\'t',
          tip: 'ğŸŒ™ ...ago â†’ didn\'t'
        },
        {
          image: 'â“â˜€ï¸',
          text: '"<span class="highlight-green">Does</span> she <span class="highlight">often</span> help Mom?"',
          question: 'Often â†’ ___ she help Mom?',
          choices: ['Does â˜€ï¸', 'Did ğŸŒ™'],
          correct: 0,
          feedback: 'Excellent! often â†’ Does',
          tip: 'â˜€ï¸ often â†’ Does...?'
        },
        {
          image: 'â“ğŸŒ™',
          text: '"<span class="highlight-orange">Did</span> she help <span class="highlight-orange">in 2023</span>?"',
          question: 'In 2023 â†’ ___ she help?',
          choices: ['Did ğŸŒ™', 'Does â˜€ï¸'],
          correct: 0,
          feedback: 'Great! in 2023 â†’ Did',
          tip: 'ğŸŒ™ in 2023 â†’ Did...?'
        }
      ]
    },
    // Story 4: All signals mixed
    {
      bg: 'bg-school',
      scenes: [
        {
          image: 'ğŸ«',
          text: 'We <span class="highlight-green">go</span> to school <span class="highlight">every day</span>.',
          question: 'every day / yesterday â†’ We ___ to school.',
          choices: ['go (every day) â˜€ï¸', 'went (yesterday) ğŸŒ™'],
          correct: 0,
          feedback: 'Yes! every day â†’ go',
          tip: 'â˜€ï¸ every day â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸ«ğŸŒ™',
          text: 'We <span class="highlight-orange">went</span> on a field trip <span class="highlight-orange">last Friday</span>.',
          question: 'last Friday â†’ We ___ on a field trip.',
          choices: ['went ğŸŒ™', 'go â˜€ï¸'],
          correct: 0,
          feedback: 'Great! last Friday â†’ went',
          tip: 'ğŸŒ™ last... â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸ“š',
          text: 'The teacher <span class="highlight">always</span> <span class="highlight-green">gives</span> homework.',
          question: 'always â†’ The teacher ___ homework.',
          choices: ['gives â˜€ï¸', 'gave ğŸŒ™'],
          correct: 0,
          feedback: 'Perfect! always â†’ gives',
          tip: 'â˜€ï¸ always â†’ hiá»‡n táº¡i'
        },
        {
          image: 'ğŸ“šğŸŒ™',
          text: 'She <span class="highlight-orange">gave</span> us a lot <span class="highlight-orange">yesterday</span>.',
          question: 'yesterday â†’ She ___ us a lot.',
          choices: ['gave ğŸŒ™', 'gives â˜€ï¸'],
          correct: 0,
          feedback: 'Wonderful! yesterday â†’ gave',
          tip: 'ğŸŒ™ yesterday â†’ quÃ¡ khá»©'
        },
        {
          image: 'ğŸš«',
          text: 'I <span class="highlight">usually</span> <span class="highlight-green">don\'t forget</span> my books.',
          question: 'usually â†’ I ___ forget my books.',
          choices: ['don\'t â˜€ï¸', 'didn\'t ğŸŒ™'],
          correct: 0,
          feedback: 'Excellent! usually â†’ don\'t',
          tip: 'â˜€ï¸ usually â†’ don\'t'
        },
        {
          image: 'ğŸš«ğŸŒ™',
          text: 'But I <span class="highlight-orange">didn\'t bring</span> my pencil <span class="highlight-orange">3 days ago</span>.',
          question: '3 days ago â†’ I ___ bring my pencil.',
          choices: ['didn\'t ğŸŒ™', 'don\'t â˜€ï¸'],
          correct: 0,
          feedback: 'Great! ...ago â†’ didn\'t',
          tip: 'ğŸŒ™ ...ago â†’ didn\'t'
        }
      ]
    }
  ]
};
var WORD_GAMES = {
  matching: [
    { now: 'go', past: 'went', meaning: 'Ä‘i' },
    { now: 'eat', past: 'ate', meaning: 'Äƒn' },
    { now: 'see', past: 'saw', meaning: 'tháº¥y' },
    { now: 'have', past: 'had', meaning: 'cÃ³' },
    { now: 'make', past: 'made', meaning: 'lÃ m' },
    { now: 'come', past: 'came', meaning: 'Ä‘áº¿n' },
    { now: 'take', past: 'took', meaning: 'láº¥y' },
    { now: 'give', past: 'gave', meaning: 'cho' },
    { now: 'run', past: 'ran', meaning: 'cháº¡y' },
    { now: 'swim', past: 'swam', meaning: 'bÆ¡i' },
    { now: 'drink', past: 'drank', meaning: 'uá»‘ng' },
    { now: 'sing', past: 'sang', meaning: 'hÃ¡t' },
    { now: 'sleep', past: 'slept', meaning: 'ngá»§' },
    { now: 'write', past: 'wrote', meaning: 'viáº¿t' },
    { now: 'read', past: 'read', meaning: 'Ä‘á»c' },
    { now: 'buy', past: 'bought', meaning: 'mua' },
    { now: 'get', past: 'got', meaning: 'Ä‘Æ°á»£c' },
    { now: 'sit', past: 'sat', meaning: 'ngá»“i' },
    { now: 'stand', past: 'stood', meaning: 'Ä‘á»©ng' },
    { now: 'fly', past: 'flew', meaning: 'bay' },
    { now: 'do', past: 'did', meaning: 'lÃ m' },
    { now: 'say', past: 'said', meaning: 'nÃ³i' },
    { now: 'tell', past: 'told', meaning: 'ká»ƒ' },
    { now: 'think', past: 'thought', meaning: 'nghÄ©' },
    { now: 'know', past: 'knew', meaning: 'biáº¿t' },
    { now: 'put', past: 'put', meaning: 'Ä‘áº·t' },
    { now: 'cut', past: 'cut', meaning: 'cáº¯t' },
    { now: 'draw', past: 'drew', meaning: 'váº½' },
    { now: 'grow', past: 'grew', meaning: 'lá»›n lÃªn' },
    { now: 'throw', past: 'threw', meaning: 'nÃ©m' },
    { now: 'catch', past: 'caught', meaning: 'báº¯t' },
    { now: 'teach', past: 'taught', meaning: 'dáº¡y' },
    { now: 'bring', past: 'brought', meaning: 'mang' },
    { now: 'find', past: 'found', meaning: 'tÃ¬m tháº¥y' },
    { now: 'feel', past: 'felt', meaning: 'cáº£m tháº¥y' },
    { now: 'leave', past: 'left', meaning: 'rá»i Ä‘i' },
    { now: 'meet', past: 'met', meaning: 'gáº·p' },
    { now: 'send', past: 'sent', meaning: 'gá»­i' },
    { now: 'build', past: 'built', meaning: 'xÃ¢y' },
    { now: 'wear', past: 'wore', meaning: 'máº·c' }
  ]
};

// ============ STATE ============
var soundEnabled = true;
var currentTopic = '';
var currentStory = 0;
var currentScene = 0;
var stars = 0;
var totalQuestions = 0;
var correctAnswers = 0;

// Matching game state
var matchCards = [];
var selectedCard = null;
var matchedPairs = [];

// Flashcard state
var flashcardIndex = 0;
var isFlipped = false;

// ============ SOUND ============
function playSound(type) {
  if (!soundEnabled) return;
  try {
    var ctx = new (window.AudioContext || window.webkitAudioContext)();
    var osc = ctx.createOscillator();
    var gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    
    if (type === 'correct') {
      osc.frequency.setValueAtTime(523, ctx.currentTime);
      osc.frequency.setValueAtTime(659, ctx.currentTime + 0.1);
      osc.frequency.setValueAtTime(784, ctx.currentTime + 0.2);
      gain.gain.setValueAtTime(0.3, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.4);
    } else if (type === 'wrong') {
      osc.frequency.setValueAtTime(330, ctx.currentTime);
      osc.frequency.setValueAtTime(294, ctx.currentTime + 0.15);
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.3);
    } else if (type === 'click') {
      osc.frequency.setValueAtTime(800, ctx.currentTime);
      gain.gain.setValueAtTime(0.1, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.05);
    } else if (type === 'complete') {
      [523, 659, 784, 1047].forEach(function(freq, i) {
        var o = ctx.createOscillator();
        var g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);
        o.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.15);
        g.gain.setValueAtTime(0.2, ctx.currentTime + i * 0.15);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.15 + 0.2);
        o.start(ctx.currentTime + i * 0.15);
        o.stop(ctx.currentTime + i * 0.15 + 0.2);
      });
    } else if (type === 'flip') {
      osc.frequency.setValueAtTime(600, ctx.currentTime);
      osc.frequency.setValueAtTime(900, ctx.currentTime + 0.05);
      gain.gain.setValueAtTime(0.15, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
      osc.start(ctx.currentTime);
      osc.stop(ctx.currentTime + 0.1);
    }
  } catch(e) {}
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
}

// ============ CONFETTI ============
function showConfetti() {
  var container = document.getElementById('confettiContainer');
  container.innerHTML = '';
  var colors = ['#FFD700','#FF6B6B','#4CAF50','#2196F3','#E91E63'];
  for (var i = 0; i < 30; i++) {
    var c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + '%';
    c.style.background = colors[Math.floor(Math.random() * colors.length)];
    c.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    c.style.animationDelay = Math.random() * 0.5 + 's';
    container.appendChild(c);
  }
  setTimeout(function() { container.innerHTML = ''; }, 3000);
}

// ============ NAVIGATION ============
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(function(s) {
    s.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}

function goHome() {
  document.getElementById('appContainer').className = 'app-container bg-fun';
  showScreen('homeScreen');
}

// ============ SHUFFLE ============
function shuffle(arr) {
  var a = arr.slice();
  for (var i = a.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var t = a[i]; a[i] = a[j]; a[j] = t;
  }
  return a;
}

// ============ LEARN SCREEN ============
function showLearnScreen() {
  playSound('click');
  document.getElementById('appContainer').className = 'app-container bg-sunny';
  
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div style="color:white;font-weight:700;font-size:1.2rem">ğŸ“š Há»c kiáº¿n thá»©c</div>' +
    '<div></div></div>' +
    
    // === Dáº¤U HIá»†U NHáº¬N BIáº¾T ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">ğŸ”</span> Dáº¥u hiá»‡u nháº­n biáº¿t</div>' +
    '<div class="compare-box">' +
    '<div class="compare-side now">' +
    '<div class="label">â˜€ï¸ HIá»†N Táº I</div>' +
    '<div class="time-words">' +
    '<span class="time-word">every day</span>' +
    '<span class="time-word">every morning</span>' +
    '<span class="time-word">every night</span>' +
    '<span class="time-word">every week</span>' +
    '<span class="time-word">always</span>' +
    '<span class="time-word">usually</span>' +
    '<span class="time-word">often</span>' +
    '<span class="time-word">sometimes</span>' +
    '</div>' +
    '</div>' +
    '<div class="compare-side past">' +
    '<div class="label">ğŸŒ™ QUÃ KHá»¨</div>' +
    '<div class="time-words">' +
    '<span class="time-word">yesterday</span>' +
    '<span class="time-word">last night</span>' +
    '<span class="time-word">last week</span>' +
    '<span class="time-word">last month</span>' +
    '<span class="time-word">last year</span>' +
    '<span class="time-word">...ago</span>' +
    '<span class="time-word">in 2023</span>' +
    '</div>' +
    '</div></div>' +
    '<div class="tip-bubble"><span class="bulb">ğŸ’¡</span>' +
    '<span class="tip-text"><strong>Máº¹o nhá»›:</strong><br>' +
    'ğŸ‘‰ Tháº¥y <strong>"every"</strong> â†’ Hiá»‡n táº¡i<br>' +
    'ğŸ‘‰ Tháº¥y <strong>"yesterday/last/ago"</strong> â†’ QuÃ¡ khá»©</span></div>' +
    '</div>' +
    
    // === CÃ‚U KHáº²NG Äá»ŠNH ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">âœ…</span> CÃ¢u kháº³ng Ä‘á»‹nh</div>' +
    '<div style="background:#E8F5E9;padding:15px;border-radius:12px;margin-bottom:15px">' +
    '<div style="font-weight:700;color:#2E7D32;margin-bottom:10px">â˜€ï¸ Hiá»‡n táº¡i:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <strong>goes</strong> to school every day.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <strong>plays</strong> football every weekend.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <strong>eat</strong> breakfast every morning.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px;font-size:0.9rem">' +
    'âš ï¸ <strong>He/She/It</strong> â†’ thÃªm <strong>s/es</strong> (goes, plays, watches)' +
    '</div></div>' +
    '<div style="background:#FFF3E0;padding:15px;border-radius:12px">' +
    '<div style="font-weight:700;color:#E65100;margin-bottom:10px">ğŸŒ™ QuÃ¡ khá»©:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <span class="past">went</span> to school yesterday.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <span class="past">played</span> football last week.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <span class="past">ate</span> pizza last night.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px;font-size:0.9rem">' +
    'âš ï¸ Äá»™ng tá»« Ä‘á»•i sang dáº¡ng quÃ¡ khá»© (went, played, ate...)' +
    '</div></div>' +
    '</div>' +
    
    // === CÃ‚U PHá»¦ Äá»ŠNH ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">ğŸš«</span> CÃ¢u phá»§ Ä‘á»‹nh (KhÃ´ng lÃ m gÃ¬)</div>' +
    '<div style="background:#E8F5E9;padding:15px;border-radius:12px;margin-bottom:15px">' +
    '<div style="font-weight:700;color:#2E7D32;margin-bottom:10px">â˜€ï¸ Hiá»‡n táº¡i:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <strong>doesn\'t go</strong> to school on Sunday.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <strong>doesn\'t like</strong> vegetables.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <strong>don\'t eat</strong> meat.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem;margin-bottom:5px">ğŸ“Œ <strong>I/You/We/They</strong> â†’ <span style="background:#FFCDD2;padding:2px 6px;border-radius:4px">don\'t</span> + Ä‘á»™ng tá»« gá»‘c</div>' +
    '<div style="font-size:0.9rem">ğŸ“Œ <strong>He/She/It</strong> â†’ <span style="background:#FFCDD2;padding:2px 6px;border-radius:4px">doesn\'t</span> + Ä‘á»™ng tá»« gá»‘c</div>' +
    '</div></div>' +
    '<div style="background:#FFF3E0;padding:15px;border-radius:12px">' +
    '<div style="font-weight:700;color:#E65100;margin-bottom:10px">ğŸŒ™ QuÃ¡ khá»©:</div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘§</span><span class="sentence">She <span class="past">didn\'t go</span> to school yesterday.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘¦</span><span class="sentence">He <span class="past">didn\'t watch</span> TV last night.</span></div>' +
    '<div class="example-row"><span class="emoji">ğŸ‘«</span><span class="sentence">They <span class="past">didn\'t play</span> games yesterday.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem">ğŸ“Œ <strong>Táº¥t cáº£</strong> â†’ <span style="background:#FFCC80;padding:2px 6px;border-radius:4px">didn\'t</span> + Ä‘á»™ng tá»« <strong>Gá»C</strong></div>' +
    '</div></div>' +
    '<div class="tip-bubble" style="background:#FFEBEE"><span class="bulb">âš ï¸</span>' +
    '<span class="tip-text"><strong>Quan trá»ng:</strong> Sau don\'t / doesn\'t / didn\'t â†’ Ä‘á»™ng tá»« giá»¯ nguyÃªn dáº¡ng Gá»C!<br>' +
    'âŒ She doesn\'t <s>goes</s> â†’ âœ… She doesn\'t <strong>go</strong><br>' +
    'âŒ He didn\'t <s>went</s> â†’ âœ… He didn\'t <strong>go</strong></span></div>' +
    '</div>' +
    
    // === CÃ‚U Há»I ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">â“</span> CÃ¢u há»i (CÃ³ lÃ m khÃ´ng?)</div>' +
    '<div style="background:#E8F5E9;padding:15px;border-radius:12px;margin-bottom:15px">' +
    '<div style="font-weight:700;color:#2E7D32;margin-bottom:10px">â˜€ï¸ Hiá»‡n táº¡i:</div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><strong>Do you</strong> like pizza? - Yes, I do!</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><strong>Does she</strong> go to school? - Yes, she does!</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><strong>Do they</strong> play games? - No, they don\'t.</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem;margin-bottom:5px">ğŸ“Œ <span style="background:#BBDEFB;padding:2px 6px;border-radius:4px">Do</span> + I/you/we/they + Ä‘á»™ng tá»« gá»‘c?</div>' +
    '<div style="font-size:0.9rem">ğŸ“Œ <span style="background:#BBDEFB;padding:2px 6px;border-radius:4px">Does</span> + he/she/it + Ä‘á»™ng tá»« gá»‘c?</div>' +
    '</div></div>' +
    '<div style="background:#FFF3E0;padding:15px;border-radius:12px">' +
    '<div style="font-weight:700;color:#E65100;margin-bottom:10px">ğŸŒ™ QuÃ¡ khá»©:</div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><span class="past">Did you</span> go to school yesterday? - Yes, I did!</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><span class="past">Did she</span> eat pizza? - No, she didn\'t.</span></div>' +
    '<div class="example-row"><span class="emoji">â“</span><span class="sentence"><span class="past">Did they</span> watch TV? - Yes, they did!</span></div>' +
    '<div style="background:white;padding:10px;border-radius:8px;margin-top:10px">' +
    '<div style="font-size:0.9rem">ğŸ“Œ <span style="background:#FFCC80;padding:2px 6px;border-radius:4px">Did</span> + táº¥t cáº£ + Ä‘á»™ng tá»« <strong>Gá»C</strong>?</div>' +
    '</div></div>' +
    '<div class="tip-bubble" style="background:#E3F2FD"><span class="bulb">âš ï¸</span>' +
    '<span class="tip-text"><strong>Quan trá»ng:</strong> Sau Do / Does / Did â†’ Ä‘á»™ng tá»« giá»¯ nguyÃªn dáº¡ng Gá»C!<br>' +
    'âŒ Does she <s>goes</s>? â†’ âœ… Does she <strong>go</strong>?<br>' +
    'âŒ Did you <s>went</s>? â†’ âœ… Did you <strong>go</strong>?</span></div>' +
    '</div>' +
    
    // === Báº¢NG TÃ“M Táº®T ===
    '<div class="pattern-card">' +
    '<div class="pattern-title"><span class="icon">ğŸ“‹</span> Báº£ng tÃ³m táº¯t</div>' +
    '<table style="width:100%;border-collapse:collapse;font-size:0.9rem">' +
    '<tr style="background:#E3F2FD"><th style="padding:10px;border:1px solid #ddd"></th><th style="padding:10px;border:1px solid #ddd">â˜€ï¸ Hiá»‡n táº¡i</th><th style="padding:10px;border:1px solid #ddd">ğŸŒ™ QuÃ¡ khá»©</th></tr>' +
    '<tr><td style="padding:10px;border:1px solid #ddd;font-weight:700">Dáº¥u hiá»‡u</td><td style="padding:10px;border:1px solid #ddd">every day, always</td><td style="padding:10px;border:1px solid #ddd">yesterday, last...</td></tr>' +
    '<tr style="background:#E8F5E9"><td style="padding:10px;border:1px solid #ddd;font-weight:700">âœ… She</td><td style="padding:10px;border:1px solid #ddd">She <strong>goes</strong></td><td style="padding:10px;border:1px solid #ddd">She <strong>went</strong></td></tr>' +
    '<tr style="background:#FFEBEE"><td style="padding:10px;border:1px solid #ddd;font-weight:700">ğŸš« She</td><td style="padding:10px;border:1px solid #ddd">She <strong>doesn\'t go</strong></td><td style="padding:10px;border:1px solid #ddd">She <strong>didn\'t go</strong></td></tr>' +
    '<tr style="background:#E3F2FD"><td style="padding:10px;border:1px solid #ddd;font-weight:700">â“ She</td><td style="padding:10px;border:1px solid #ddd"><strong>Does</strong> she <strong>go</strong>?</td><td style="padding:10px;border:1px solid #ddd"><strong>Did</strong> she <strong>go</strong>?</td></tr>' +
    '<tr style="background:#E8F5E9"><td style="padding:10px;border:1px solid #ddd;font-weight:700">âœ… They</td><td style="padding:10px;border:1px solid #ddd">They <strong>go</strong></td><td style="padding:10px;border:1px solid #ddd">They <strong>went</strong></td></tr>' +
    '<tr style="background:#FFEBEE"><td style="padding:10px;border:1px solid #ddd;font-weight:700">ğŸš« They</td><td style="padding:10px;border:1px solid #ddd">They <strong>don\'t go</strong></td><td style="padding:10px;border:1px solid #ddd">They <strong>didn\'t go</strong></td></tr>' +
    '<tr style="background:#E3F2FD"><td style="padding:10px;border:1px solid #ddd;font-weight:700">â“ They</td><td style="padding:10px;border:1px solid #ddd"><strong>Do</strong> they <strong>go</strong>?</td><td style="padding:10px;border:1px solid #ddd"><strong>Did</strong> they <strong>go</strong>?</td></tr>' +
    '</table>' +
    '</div>' +
    
    // === QUY Táº®C VÃ€NG ===
    '<div class="pattern-card" style="background:linear-gradient(135deg,#FFF9C4,#FFECB3)">' +
    '<div class="pattern-title"><span class="icon">â­</span> QUY Táº®C VÃ€NG</div>' +
    '<div style="text-align:center;padding:15px">' +
    '<p style="font-size:1.2rem;font-weight:700;color:#F57F17;margin-bottom:15px">' +
    'Sau <span style="background:#FF8A65;color:white;padding:5px 12px;border-radius:8px">don\'t / doesn\'t / didn\'t</span></p>' +
    '<p style="font-size:1.2rem;font-weight:700;color:#F57F17;margin-bottom:15px">' +
    'Sau <span style="background:#64B5F6;color:white;padding:5px 12px;border-radius:8px">Do / Does / Did</span></p>' +
    '<p style="font-size:1.5rem;font-weight:800;color:#E65100">' +
    'â†’ Äá»™ng tá»« luÃ´n á»Ÿ <span style="background:#FFEB3B;padding:5px 15px;border-radius:8px">Dáº NG Gá»C</span>!</p>' +
    '</div></div>' +
    
    '<button class="next-btn" onclick="goHome()" style="margin-top:20px">ğŸ  Vá» trang chá»§</button>';
  
  document.getElementById('learnScreen').innerHTML = html;
  showScreen('learnScreen');
}

// ============ TOPIC START ============
function startTopic(topic) {
  playSound('click');
  currentTopic = topic;
  
  if (topic === 'games') {
    showGameMenu();
  } else if (STORIES[topic]) {
    currentStory = Math.floor(Math.random() * STORIES[topic].length);
    currentScene = 0;
    stars = 0;
    correctAnswers = 0;
    totalQuestions = STORIES[topic][currentStory].scenes.length;
    showStory();
  }
}

// ============ STORY ============
function showStory() {
  var story = STORIES[currentTopic][currentStory];
  var scene = story.scenes[currentScene];
  
  document.getElementById('appContainer').className = 'app-container ' + story.bg;
  
  var dotsHtml = '';
  for (var i = 0; i < story.scenes.length; i++) {
    var dotClass = 'dot';
    if (i < currentScene) dotClass += ' done';
    else if (i === currentScene) dotClass += ' active';
    dotsHtml += '<div class="' + dotClass + '"></div>';
  }
  
  var html = '<div class="progress-header">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div class="progress-dots">' + dotsHtml + '</div>' +
    '<div class="star-count">â­ ' + stars + '</div>' +
    '</div>' +
    '<div class="story-scene">' +
    '<div class="scene-image">' + scene.image + '</div>' +
    '<div class="scene-text">' + scene.text + '</div>' +
    '<div class="scene-question">' + scene.question + '</div>' +
    '<div class="choice-buttons">';
  
  scene.choices.forEach(function(choice, i) {
    html += '<button class="choice-btn" id="choice' + i + '" onclick="checkAnswer(' + i + ')">' + choice + '</button>';
  });
  
  html += '</div><div id="feedbackArea"></div></div>';
  
  document.getElementById('storyScreen').innerHTML = html;
  showScreen('storyScreen');
}

function checkAnswer(index) {
  var story = STORIES[currentTopic][currentStory];
  var scene = story.scenes[currentScene];
  var correct = index === scene.correct;
  
  // Disable all buttons
  document.querySelectorAll('.choice-btn').forEach(function(btn, i) {
    btn.disabled = true;
    if (i === scene.correct) btn.classList.add('correct');
    if (i === index && !correct) btn.classList.add('wrong');
  });
  
  if (correct) {
    stars++;
    correctAnswers++;
    playSound('correct');
    if (stars % 3 === 0) showConfetti();
  } else {
    playSound('wrong');
  }
  
  var feedbackHtml = '<div class="feedback-box ' + (correct ? 'correct' : 'wrong') + '">' +
    '<div class="feedback-emoji">' + (correct ? 'ğŸ‰' : 'ğŸ’ª') + '</div>' +
    '<div class="feedback-text">' + scene.feedback + '</div>' +
    '<div class="feedback-tip">' + scene.tip + '</div>' +
    '<button class="next-btn" onclick="nextScene()">' +
    (currentScene < story.scenes.length - 1 ? 'Next â†’' : 'Finish! ğŸ†') +
    '</button></div>';
  
  document.getElementById('feedbackArea').innerHTML = feedbackHtml;
}

function nextScene() {
  var story = STORIES[currentTopic][currentStory];
  
  if (currentScene < story.scenes.length - 1) {
    currentScene++;
    showStory();
  } else {
    showResult();
  }
}

// ============ RESULT ============
function showResult() {
  playSound('complete');
  showConfetti();
  
  var percentage = Math.round((correctAnswers / totalQuestions) * 100);
  var starCount = Math.min(3, Math.floor(percentage / 33) + (percentage > 0 ? 1 : 0));
  var starsHtml = '';
  for (var i = 0; i < 3; i++) {
    starsHtml += i < starCount ? 'â­' : 'â˜†';
  }
  
  var emoji = percentage >= 80 ? 'ğŸ†' : percentage >= 50 ? 'ğŸŒŸ' : 'ğŸ’ª';
  var message = percentage >= 80 ? 'Excellent! Con giá»i láº¯m!' : 
                percentage >= 50 ? 'Good job! Tiáº¿p tá»¥c nhÃ©!' : 
                'Keep trying! Cá»‘ gáº¯ng lÃªn nÃ o!';
  
  document.getElementById('appContainer').className = 'app-container bg-fun';
  
  var html = '<div class="result-content"><div class="result-card">' +
    '<div class="result-emoji">' + emoji + '</div>' +
    '<div class="result-title">Well Done!</div>' +
    '<div class="result-stars">' + starsHtml + '</div>' +
    '<div class="result-message">' + message + '</div>' +
    '<div class="result-buttons">' +
    '<button class="result-btn primary" onclick="startTopic(\'' + currentTopic + '\')">Play Again ğŸ”„</button>' +
    '<button class="result-btn secondary" onclick="goHome()">Home ğŸ </button>' +
    '</div></div></div>';
  
  document.getElementById('resultScreen').innerHTML = html;
  showScreen('resultScreen');
}

// ============ GAME MENU ============
function showGameMenu() {
  document.getElementById('appContainer').className = 'app-container bg-fun';
  
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="goHome()">â† Home</button>' +
    '<div style="color:white;font-weight:700;font-size:1.2rem">ğŸ® Word Games</div>' +
    '<div></div></div>' +
    
    '<div class="topic-grid">' +
    '<div class="topic-card" onclick="startMatchingGame()" style="border-color:#9C27B0">' +
    '<div class="topic-icon">ğŸ¯</div>' +
    '<div class="topic-name">Matching</div>' +
    '</div>' +
    '<div class="topic-card" onclick="startFlashcards()" style="border-color:#FF9800">' +
    '<div class="topic-icon">ğŸ´</div>' +
    '<div class="topic-name">Flashcards</div>' +
    '</div>' +
    '</div>' +
    
    // Visual learning section
    '<div class="pattern-card" style="margin-top:20px">' +
    '<div class="pattern-title"><span class="icon">ğŸ’¡</span> Nhá»› nhanh!</div>' +
    '<div class="compare-box">' +
    '<div class="compare-side now">' +
    '<div class="label">â˜€ï¸ Hiá»‡n táº¡i</div>' +
    '<div class="time-words"><span class="time-word">every day</span><span class="time-word">always</span></div>' +
    '<div class="example">I <strong>go</strong> to school.</div>' +
    '</div>' +
    '<div class="compare-side past">' +
    '<div class="label">ğŸŒ™ QuÃ¡ khá»©</div>' +
    '<div class="time-words"><span class="time-word">yesterday</span><span class="time-word">last week</span></div>' +
    '<div class="example">I <strong style="color:#E65100">went</strong> to school.</div>' +
    '</div></div>' +
    '<div class="tip-bubble"><span class="bulb">ğŸ’¡</span>' +
    '<span class="tip-text">Tháº¥y <strong>every</strong> â†’ dÃ¹ng tá»« hiá»‡n táº¡i<br>' +
    'Tháº¥y <strong>yesterday/last</strong> â†’ dÃ¹ng tá»« quÃ¡ khá»©!</span></div>' +
    '</div>';
  
  document.getElementById('gameScreen').innerHTML = html;
  showScreen('gameScreen');
}

// ============ MATCHING GAME ============
function startMatchingGame() {
  playSound('click');
  
  var words = shuffle(WORD_GAMES.matching).slice(0, 6);
  matchCards = [];
  selectedCard = null;
  matchedPairs = [];
  
  words.forEach(function(w, i) {
    matchCards.push({ id: 'now-' + i, text: w.now, type: 'now', pairId: i });
    matchCards.push({ id: 'past-' + i, text: w.past, type: 'past', pairId: i });
  });
  matchCards = shuffle(matchCards);
  
  renderMatchingGame();
}

function renderMatchingGame() {
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="showGameMenu()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ¯ Match the pairs!</div>' +
    '<div></div></div>' +
    
    '<div class="match-instruction">ğŸŸ¢ Chá»n tá»« hiá»‡n táº¡i â†’ ğŸŸ  Chá»n tá»« quÃ¡ khá»© cá»§a nÃ³!</div>' +
    
    '<div class="match-grid">';
  
  matchCards.forEach(function(card) {
    var isSelected = selectedCard && selectedCard.id === card.id;
    var isMatched = matchedPairs.indexOf(card.pairId) >= 0;
    html += '<button class="match-card type-' + card.type + 
      (isSelected ? ' selected' : '') + 
      (isMatched ? ' matched' : '') + '" ' +
      (isMatched ? 'disabled' : 'onclick="selectMatchCard(\'' + card.id + '\')"') + '>' +
      card.text + '</button>';
  });
  
  html += '</div>' +
    '<div class="match-score">âœ… ' + matchedPairs.length + ' / 6</div>';
  
  if (matchedPairs.length >= 6) {
    html += '<div style="text-align:center;margin-top:20px">' +
      '<div style="font-size:50px;margin-bottom:10px">ğŸ‰</div>' +
      '<div style="color:white;font-size:1.3rem;font-weight:700;margin-bottom:15px">Excellent!</div>' +
      '<button class="next-btn" onclick="startMatchingGame()">Play Again ğŸ”„</button></div>';
  }
  
  document.getElementById('gameScreen').innerHTML = html;
  showScreen('gameScreen');
}

function selectMatchCard(cardId) {
  playSound('click');
  
  var card = matchCards.find(function(c) { return c.id === cardId; });
  
  if (!selectedCard) {
    selectedCard = card;
    renderMatchingGame();
  } else {
    if (selectedCard.id === card.id) {
      selectedCard = null;
      renderMatchingGame();
      return;
    }
    
    if (selectedCard.pairId === card.pairId && selectedCard.type !== card.type) {
      matchedPairs.push(card.pairId);
      playSound('correct');
      if (matchedPairs.length >= 6) {
        playSound('complete');
        showConfetti();
      }
    } else {
      playSound('wrong');
    }
    selectedCard = null;
    renderMatchingGame();
  }
}

// ============ FLASHCARDS ============
function startFlashcards() {
  playSound('click');
  flashcardIndex = 0;
  isFlipped = false;
  renderFlashcards();
}

function renderFlashcards() {
  var words = WORD_GAMES.matching;
  var word = words[flashcardIndex];
  
  var html = '<div class="progress-header" style="margin-bottom:20px">' +
    '<button class="back-btn" onclick="showGameMenu()">â† Back</button>' +
    '<div style="color:white;font-weight:700">ğŸ´ ' + (flashcardIndex + 1) + ' / ' + words.length + '</div>' +
    '<div></div></div>' +
    
    '<div style="color:white;text-align:center;margin-bottom:15px;font-size:1.1rem">' +
    'ğŸ‘† Cháº¡m tháº» Ä‘á»ƒ láº­t!</div>' +
    
    '<div class="flashcard-container">' +
    '<div class="flashcard' + (isFlipped ? ' flipped' : '') + '" onclick="flipCard()">' +
    '<div class="flashcard-face flashcard-front">' +
    '<div class="flashcard-label">â˜€ï¸ Hiá»‡n táº¡i</div>' +
    '<div class="flashcard-word">' + word.now + '</div>' +
    '<div class="flashcard-meaning">(' + word.meaning + ')</div>' +
    '<div class="flashcard-hint">ğŸ‘† Cháº¡m Ä‘á»ƒ xem tá»« quÃ¡ khá»©</div>' +
    '</div>' +
    '<div class="flashcard-face flashcard-back">' +
    '<div class="flashcard-label">ğŸŒ™ QuÃ¡ khá»©</div>' +
    '<div class="flashcard-word">' + word.past + '</div>' +
    '<div class="flashcard-meaning">' + word.now + ' â†’ ' + word.past + '</div>' +
    '</div></div></div>' +
    
    '<div class="flashcard-nav">' +
    '<button class="flashcard-btn" onclick="prevFlashcard()">â† TrÆ°á»›c</button>' +
    '<button class="flashcard-btn" onclick="shuffleFlashcards()">ğŸ”€ Trá»™n</button>' +
    '<button class="flashcard-btn" onclick="nextFlashcard()">Sau â†’</button>' +
    '</div>' +
    
    '<div class="pattern-card" style="margin-top:25px">' +
    '<div class="example-row">' +
    '<span class="emoji">â˜€ï¸</span>' +
    '<span class="sentence">I <strong>' + word.now + '</strong> every day. (Hiá»‡n táº¡i)</span>' +
    '</div>' +
    '<div class="example-row">' +
    '<span class="emoji">ğŸŒ™</span>' +
    '<span class="sentence">I <span class="past">' + word.past + '</span> yesterday. (QuÃ¡ khá»©)</span>' +
    '</div></div>';
  
  document.getElementById('gameScreen').innerHTML = html;
  showScreen('gameScreen');
}

function flipCard() {
  playSound('flip');
  isFlipped = !isFlipped;
  renderFlashcards();
}

function prevFlashcard() {
  isFlipped = false;
  flashcardIndex = flashcardIndex > 0 ? flashcardIndex - 1 : WORD_GAMES.matching.length - 1;
  renderFlashcards();
}

function nextFlashcard() {
  isFlipped = false;
  flashcardIndex = flashcardIndex < WORD_GAMES.matching.length - 1 ? flashcardIndex + 1 : 0;
  renderFlashcards();
}

function shuffleFlashcards() {
  WORD_GAMES.matching = shuffle(WORD_GAMES.matching);
  flashcardIndex = 0;
  isFlipped = false;
  renderFlashcards();
}
</script>
</body>
</html>
